<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lesson 03 -- Negative Numbers</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #1e2128;
    --card: #272d38;
    --border: #333a48;
    --text: #d4cfc4;
    --text-dim: #8a8678;
    --accent: #6366f1;
    --green: #22c55e;
    --pink: #ec4899;
    --orange: #f59e0b;
    --red: #ef4444;
  }

  html { font-size: 16px; }

  body {
    font-family: 'JetBrains Mono', monospace;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
    padding: 1rem;
  }

  /* ── Progress Bar ── */
  .progress-bar {
    display: flex;
    gap: 4px;
    margin-bottom: 1.5rem;
    padding: 0 0.5rem;
  }
  .progress-segment {
    flex: 1;
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    transition: background 0.4s ease;
    cursor: pointer;
  }
  .progress-segment.active { background: var(--accent); }
  .progress-segment.complete { background: var(--green); }

  /* ── Header ── */
  .lesson-header {
    text-align: center;
    margin-bottom: 2rem;
    padding: 1.5rem;
  }
  .lesson-header h1 {
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--text);
    letter-spacing: -0.5px;
  }
  .lesson-header .subtitle {
    color: var(--text-dim);
    font-size: 0.85rem;
    margin-top: 0.3rem;
    font-weight: 300;
  }

  /* ── Cards ── */
  details {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 1.25rem;
    overflow: hidden;
    transition: border-color 0.3s ease;
  }
  details[open] { border-color: var(--accent); }
  details:focus-within { outline: 2px solid var(--accent); outline-offset: 2px; }

  summary {
    padding: 1rem 1.25rem;
    cursor: pointer;
    font-weight: 600;
    font-size: 1rem;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    user-select: none;
    list-style: none;
    transition: background 0.2s ease;
  }
  summary::-webkit-details-marker { display: none; }
  summary::before {
    content: '';
    display: inline-block;
    width: 8px;
    height: 8px;
    border-right: 2px solid var(--accent);
    border-bottom: 2px solid var(--accent);
    transform: rotate(-45deg);
    transition: transform 0.3s ease;
    flex-shrink: 0;
  }
  details[open] > summary::before { transform: rotate(45deg); }
  summary:hover { background: rgba(99, 102, 241, 0.06); }

  .section-num {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--accent);
    color: #fff;
    font-size: 0.75rem;
    font-weight: 700;
    flex-shrink: 0;
  }

  .card-body {
    padding: 0 1.25rem 1.5rem;
  }

  /* ── Insight Box ── */
  .insight {
    background: rgba(99, 102, 241, 0.08);
    border-left: 3px solid var(--accent);
    padding: 1rem 1.25rem;
    border-radius: 0 6px 6px 0;
    margin: 1.25rem 0;
    font-size: 0.85rem;
    line-height: 1.7;
    color: var(--text);
  }
  .insight strong { color: var(--accent); }

  /* ── Labels / Tags ── */
  .label {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 3px 8px;
    border-radius: 4px;
    margin-bottom: 0.75rem;
  }
  .label--temp { background: rgba(99, 102, 241, 0.15); color: var(--accent); }
  .label--numline { background: rgba(34, 197, 94, 0.15); color: var(--green); }
  .label--ops { background: rgba(236, 72, 153, 0.15); color: var(--pink); }

  /* ── Temperature Display ── */
  .temp-display {
    text-align: center;
    margin: 1rem 0;
  }
  .temp-value {
    font-size: 2.5rem;
    font-weight: 700;
    transition: color 0.3s ease;
  }
  .temp-value.negative { color: var(--accent); }
  .temp-value.zero { color: var(--orange); }
  .temp-value.positive { color: var(--green); }
  .temp-desc {
    font-size: 0.8rem;
    color: var(--text-dim);
    margin-top: 0.25rem;
    min-height: 1.4em;
  }

  /* ── Thermometer Area ── */
  .thermo-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 1rem 0;
    touch-action: none;
  }
  .thermo-svg {
    cursor: ns-resize;
  }

  /* ── Number Line ── */
  .numline-container {
    margin: 1.5rem 0;
    text-align: center;
  }
  .numline-svg {
    max-width: 100%;
    height: auto;
  }
  .numline-pos {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 0.5rem;
    text-align: center;
  }
  .numline-controls {
    display: flex;
    gap: 0.75rem;
    justify-content: center;
    margin-top: 1rem;
    flex-wrap: wrap;
  }

  /* ── Buttons ── */
  button {
    font-family: 'JetBrains Mono', monospace;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    padding: 0.5rem 1.25rem;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.2s ease;
  }
  button:active { transform: scale(0.97); }

  .btn-green { background: var(--green); color: #000; }
  .btn-green:hover { background: #16a34a; }
  .btn-pink { background: var(--pink); color: #fff; }
  .btn-pink:hover { background: #db2777; }
  .btn-accent { background: var(--accent); color: #fff; }
  .btn-accent:hover { background: #4f46e5; }
  .btn-orange { background: var(--orange); color: #000; }
  .btn-orange:hover { background: #d97706; }
  .btn-outline {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text);
  }
  .btn-outline:hover { border-color: var(--accent); color: var(--accent); }
  .btn-outline.active { border-color: var(--accent); background: rgba(99,102,241,0.15); color: var(--accent); }
  .btn-reset { background: var(--border); color: var(--text-dim); font-size: 0.75rem; }
  .btn-reset:hover { background: #444; }

  /* ── Section 2: Operations ── */
  .op-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
    margin: 1rem 0;
  }
  .slider-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    flex: 1;
    min-width: 120px;
  }
  .slider-group label {
    font-size: 0.75rem;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .slider-group .slider-val {
    font-size: 1.4rem;
    font-weight: 700;
    color: var(--accent);
    min-width: 3ch;
    text-align: center;
  }
  input[type="range"] {
    -webkit-appearance: none;
    width: 100%;
    max-width: 180px;
    height: 6px;
    background: var(--border);
    border-radius: 3px;
    outline: none;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
    border: 2px solid var(--bg);
  }

  .op-buttons {
    display: flex;
    gap: 0.4rem;
    justify-content: center;
    flex-wrap: wrap;
    margin: 0.75rem 0;
  }
  .op-btn {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    border-radius: 8px;
    background: var(--border);
    color: var(--text);
    border: 2px solid transparent;
    transition: all 0.2s;
  }
  .op-btn:hover { border-color: var(--accent); }
  .op-btn.selected { border-color: var(--accent); background: rgba(99,102,241,0.2); color: var(--accent); }

  .op-result {
    text-align: center;
    margin: 1rem 0;
    font-size: 1.2rem;
    font-weight: 600;
    min-height: 2em;
  }
  .op-result .expr { color: var(--text-dim); }
  .op-result .equals { color: var(--orange); margin: 0 0.5rem; }
  .op-result .answer { color: var(--green); }
  .op-explanation {
    text-align: center;
    font-size: 0.8rem;
    color: var(--text-dim);
    min-height: 1.4em;
    margin-bottom: 0.75rem;
  }

  /* ── Sign Grid ── */
  .sign-grid-title {
    text-align: center;
    font-size: 0.8rem;
    color: var(--text-dim);
    margin: 1.5rem 0 0.5rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .sign-grid {
    display: grid;
    grid-template-columns: 60px 1fr 1fr;
    grid-template-rows: 40px 1fr 1fr;
    gap: 2px;
    max-width: 300px;
    margin: 0 auto 1rem;
    font-size: 0.85rem;
  }
  .sign-grid .corner { background: transparent; }
  .sign-grid .header {
    background: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    border-radius: 4px;
  }
  .sign-grid .cell {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    border-radius: 4px;
    font-weight: 700;
    font-size: 1.1rem;
    transition: all 0.3s;
  }
  .cell-pos { background: rgba(34, 197, 94, 0.12); color: var(--green); }
  .cell-neg { background: rgba(236, 72, 153, 0.12); color: var(--pink); }
  .sign-grid .cell.highlighted {
    outline: 2px solid var(--orange);
    outline-offset: -2px;
    transform: scale(1.05);
  }

  /* ── Section 3: Practice ── */
  .practice-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .practice-score {
    font-size: 0.85rem;
    color: var(--text-dim);
  }
  .practice-score span { color: var(--green); font-weight: 700; }
  .practice-progress {
    font-size: 0.8rem;
    color: var(--text-dim);
  }

  .problem-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.5rem;
    text-align: center;
    margin: 1rem 0;
  }
  .problem-number {
    font-size: 0.7rem;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 0.75rem;
  }
  .problem-expression {
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 1rem;
  }
  .problem-expression .qmark { color: var(--orange); }

  .answer-row {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
  }
  .answer-input {
    font-family: 'JetBrains Mono', monospace;
    background: var(--card);
    border: 2px solid var(--border);
    border-radius: 6px;
    color: var(--text);
    font-size: 1.2rem;
    font-weight: 600;
    padding: 0.5rem 1rem;
    width: 120px;
    text-align: center;
    outline: none;
    transition: border-color 0.3s;
  }
  .answer-input:focus { border-color: var(--accent); }
  .answer-input.correct { border-color: var(--green); color: var(--green); }
  .answer-input.incorrect { border-color: var(--red); color: var(--red); }

  .feedback {
    margin-top: 1rem;
    font-size: 0.9rem;
    font-weight: 600;
    min-height: 1.6em;
  }
  .feedback.correct { color: var(--green); }
  .feedback.incorrect { color: var(--red); }

  .practice-complete {
    text-align: center;
    padding: 2rem;
  }
  .practice-complete .final-score {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--green);
    margin-bottom: 0.5rem;
  }
  .practice-complete .final-label {
    color: var(--text-dim);
    font-size: 0.85rem;
  }

  /* ── Animations ── */
  @keyframes arrowDraw {
    from { stroke-dashoffset: 300; }
    to { stroke-dashoffset: 0; }
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .fade-in { animation: fadeIn 0.3s ease forwards; }

  /* ── Responsive ── */
  @media (max-width: 600px) {
    body { padding: 0.5rem; }
    .lesson-header h1 { font-size: 1.2rem; }
    .temp-value { font-size: 2rem; }
    .problem-expression { font-size: 1.3rem; }
    summary { font-size: 0.9rem; padding: 0.85rem 1rem; }
    .card-body { padding: 0 1rem 1.25rem; }
  }
</style>
</head>
<body>

<!-- ════════════════════ PROGRESS BAR ════════════════════ -->
<div class="progress-bar" role="progressbar" aria-label="Lesson progress">
  <div class="progress-segment" data-section="1" title="Section 1: Direction, Not Just Size"></div>
  <div class="progress-segment" data-section="2" title="Section 2: The Sign Rules"></div>
  <div class="progress-segment" data-section="3" title="Section 3: Practice Problems"></div>
</div>

<!-- ════════════════════ HEADER ════════════════════ -->
<header class="lesson-header">
  <h1>Lesson 03 -- Negative Numbers</h1>
  <div class="subtitle">Week 1 / Number Foundations / VPT Prep</div>
</header>

<!-- ════════════════════ SECTION 1 ════════════════════ -->
<details id="section1" open>
  <summary>
    <span class="section-num">1</span>
    Direction, Not Just Size
  </summary>
  <div class="card-body">

    <span class="label label--temp">Thermometer</span>
    <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">
      Drag the mercury level up and down to explore the full temperature range.
    </p>

    <div class="temp-display">
      <div class="temp-value positive" id="tempValue">72 F</div>
      <div class="temp-desc" id="tempDesc">Positive -- above the reference</div>
    </div>

    <div class="thermo-container" id="thermoContainer">
      <svg class="thermo-svg" id="thermoSvg" width="120" height="340" viewBox="0 0 120 340" aria-label="Interactive thermometer from -20F to 120F">
        <!-- Thermometer tube -->
        <defs>
          <linearGradient id="tubeGrad" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#1a1e26"/>
            <stop offset="50%" stop-color="#272d38"/>
            <stop offset="100%" stop-color="#1a1e26"/>
          </linearGradient>
          <clipPath id="tubeClip">
            <rect x="45" y="20" width="30" height="270" rx="15"/>
            <circle cx="60" cy="310" r="24"/>
          </clipPath>
        </defs>

        <!-- Tube background -->
        <rect x="45" y="20" width="30" height="270" rx="15" fill="url(#tubeGrad)" stroke="var(--border)" stroke-width="1.5"/>
        <circle cx="60" cy="310" r="24" fill="url(#tubeGrad)" stroke="var(--border)" stroke-width="1.5"/>

        <!-- Mercury fill -->
        <g clip-path="url(#tubeClip)">
          <rect id="mercuryFill" x="45" y="155" width="30" height="180" fill="var(--pink)"/>
          <circle cx="60" cy="310" r="24" fill="var(--pink)"/>
        </g>

        <!-- Bulb highlight -->
        <circle cx="53" cy="305" r="6" fill="rgba(255,255,255,0.1)"/>

        <!-- Tick marks and labels -->
        <!-- 120F -->
        <line x1="78" y1="24" x2="90" y2="24" stroke="var(--text-dim)" stroke-width="1"/>
        <text x="94" y="28" fill="var(--text-dim)" font-size="10" font-family="JetBrains Mono">120</text>
        <!-- 100F -->
        <line x1="78" y1="62" x2="88" y2="62" stroke="var(--text-dim)" stroke-width="1"/>
        <text x="94" y="66" fill="var(--text-dim)" font-size="10" font-family="JetBrains Mono">100</text>
        <!-- 80F -->
        <line x1="78" y1="100" x2="88" y2="100" stroke="var(--text-dim)" stroke-width="1"/>
        <text x="94" y="104" fill="var(--text-dim)" font-size="10" font-family="JetBrains Mono">80</text>
        <!-- 60F -->
        <line x1="78" y1="139" x2="88" y2="139" stroke="var(--text-dim)" stroke-width="1"/>
        <text x="94" y="143" fill="var(--text-dim)" font-size="10" font-family="JetBrains Mono">60</text>
        <!-- 40F -->
        <line x1="78" y1="177" x2="88" y2="177" stroke="var(--text-dim)" stroke-width="1"/>
        <text x="94" y="181" fill="var(--text-dim)" font-size="10" font-family="JetBrains Mono">40</text>
        <!-- 20F -->
        <line x1="78" y1="215" x2="88" y2="215" stroke="var(--text-dim)" stroke-width="1"/>
        <text x="94" y="219" fill="var(--text-dim)" font-size="10" font-family="JetBrains Mono">20</text>
        <!-- 0F (freezing marker) -->
        <line x1="32" y1="253" x2="88" y2="253" stroke="var(--orange)" stroke-width="1.5" stroke-dasharray="4,3"/>
        <text x="6" y="257" fill="var(--orange)" font-size="11" font-weight="600" font-family="JetBrains Mono">0</text>
        <text x="94" y="257" fill="var(--orange)" font-size="10" font-weight="600" font-family="JetBrains Mono">0</text>
        <!-- -20F -->
        <line x1="78" y1="291" x2="88" y2="291" stroke="var(--text-dim)" stroke-width="1"/>
        <text x="92" y="295" fill="var(--text-dim)" font-size="10" font-family="JetBrains Mono">-20</text>

        <!-- Small ticks every 10 degrees -->
        <line x1="78" y1="43" x2="84" y2="43" stroke="var(--border)" stroke-width="0.75"/>
        <line x1="78" y1="81" x2="84" y2="81" stroke="var(--border)" stroke-width="0.75"/>
        <line x1="78" y1="120" x2="84" y2="120" stroke="var(--border)" stroke-width="0.75"/>
        <line x1="78" y1="158" x2="84" y2="158" stroke="var(--border)" stroke-width="0.75"/>
        <line x1="78" y1="196" x2="84" y2="196" stroke="var(--border)" stroke-width="0.75"/>
        <line x1="78" y1="234" x2="84" y2="234" stroke="var(--border)" stroke-width="0.75"/>
        <line x1="78" y1="272" x2="84" y2="272" stroke="var(--border)" stroke-width="0.75"/>

        <!-- Drag handle indicator -->
        <rect id="dragHandle" x="47" y="152" width="26" height="6" rx="3" fill="rgba(255,255,255,0.3)"/>
      </svg>
    </div>

    <div class="insight">
      <strong>Key insight:</strong> Negative numbers are not "less than nothing." They are just
      the other direction. Temperature goes below zero. Elevation goes below sea level. Bank accounts
      go into debt. <strong>Negative = opposite direction from positive.</strong>
    </div>

    <hr style="border:none; border-top:1px solid var(--border); margin:1.5rem 0;">

    <span class="label label--numline">Number Line</span>
    <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">
      Use the buttons to move along the number line. Watch the arrow show direction of movement.
    </p>

    <div class="numline-pos">Position: <span id="nlPos1">0</span></div>

    <div class="numline-container">
      <svg id="numline1" class="numline-svg" width="680" height="100" viewBox="0 0 680 100">
        <!-- Number line axis -->
        <line x1="20" y1="50" x2="660" y2="50" stroke="var(--text-dim)" stroke-width="1.5"/>
        <!-- Arrow tips on axis -->
        <polygon points="658,46 668,50 658,54" fill="var(--text-dim)"/>
        <polygon points="22,46 12,50 22,54" fill="var(--text-dim)"/>
      </svg>
    </div>

    <div class="numline-controls">
      <button class="btn-green" onclick="moveOnLine1(3)">+ 3</button>
      <button class="btn-pink" onclick="moveOnLine1(-3)">- 3</button>
      <button class="btn-reset" onclick="resetLine1()">Reset</button>
    </div>

  </div>
</details>

<!-- ════════════════════ SECTION 2 ════════════════════ -->
<details id="section2">
  <summary>
    <span class="section-num">2</span>
    The Sign Rules -- Visually
  </summary>
  <div class="card-body">

    <span class="label label--ops">Operation Explorer</span>
    <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:1rem;">
      Pick two numbers and an operation. Watch the number line animate the result.
    </p>

    <div class="op-controls">
      <div class="slider-group">
        <label>First Number</label>
        <div class="slider-val" id="aVal">3</div>
        <input type="range" id="aSlider" min="-10" max="10" value="3" step="1">
      </div>
      <div class="slider-group">
        <label>Operation</label>
        <div class="op-buttons" id="opButtons">
          <button class="op-btn selected" data-op="+" title="Add">+</button>
          <button class="op-btn" data-op="-" title="Subtract">-</button>
          <button class="op-btn" data-op="*" title="Multiply">x</button>
          <button class="op-btn" data-op="/" title="Divide">/</button>
        </div>
      </div>
      <div class="slider-group">
        <label>Second Number</label>
        <div class="slider-val" id="bVal">-4</div>
        <input type="range" id="bSlider" min="-10" max="10" value="-4" step="1">
      </div>
    </div>

    <div class="op-explanation" id="opExplanation"></div>

    <div class="op-result" id="opResult"></div>

    <div class="numline-container">
      <svg id="numline2" class="numline-svg" width="680" height="110" viewBox="0 0 680 110">
        <line x1="20" y1="60" x2="660" y2="60" stroke="var(--text-dim)" stroke-width="1.5"/>
        <polygon points="658,56 668,60 658,64" fill="var(--text-dim)"/>
        <polygon points="22,56 12,60 22,64" fill="var(--text-dim)"/>
      </svg>
    </div>

    <div style="text-align:center; margin-top:0.5rem;">
      <button class="btn-accent" onclick="animateOp()">Animate</button>
    </div>

    <div class="insight" style="margin-top:1.5rem;">
      <strong>The double-flip rule:</strong> Subtracting a negative is like turning around twice --
      you end up going forward. <code>5 - (-3)</code> means "start at 5, turn to go left (subtract),
      then flip again (negative) -- you go right." Result: <strong>8</strong>.
    </div>

    <hr style="border:none; border-top:1px solid var(--border); margin:1.5rem 0;">

    <div class="sign-grid-title">Multiplication Sign Rules</div>
    <div class="sign-grid" id="signGrid">
      <div class="corner"></div>
      <div class="header" style="color:var(--green);">+ second</div>
      <div class="header" style="color:var(--pink);">- second</div>
      <div class="header" style="color:var(--green);">+ first</div>
      <div class="cell cell-pos" data-signs="pp">+</div>
      <div class="cell cell-neg" data-signs="pn">-</div>
      <div class="header" style="color:var(--pink);">- first</div>
      <div class="cell cell-neg" data-signs="np">-</div>
      <div class="cell cell-pos" data-signs="nn">+</div>
    </div>

    <div class="insight">
      <strong>Pattern:</strong> Same signs = positive (green). Different signs = negative (pink).
      Negative times negative = positive because <strong>flipping twice returns to the original direction</strong>.
      Think of it as: reversing a reversal gets you back to forward.
    </div>

  </div>
</details>

<!-- ════════════════════ SECTION 3 ════════════════════ -->
<details id="section3">
  <summary>
    <span class="section-num">3</span>
    Practice Problems
  </summary>
  <div class="card-body">

    <div class="practice-header">
      <div class="practice-score">Score: <span id="scoreDisplay">0 / 0</span></div>
      <div class="practice-progress" id="practiceProgress">Problem 1 of 10</div>
    </div>

    <div id="problemArea">
      <div class="problem-card" id="problemCard">
        <div class="problem-number" id="problemNumber">Problem 1</div>
        <div class="problem-expression" id="problemExpr"></div>
        <div class="answer-row">
          <input type="text" class="answer-input" id="answerInput" placeholder="?" autocomplete="off" inputmode="numeric">
          <button class="btn-accent" id="submitBtn" onclick="checkAnswer()">Check</button>
        </div>
        <div class="feedback" id="feedback"></div>
      </div>

      <div class="numline-container">
        <svg id="numline3" class="numline-svg" width="680" height="100" viewBox="0 0 680 100">
          <line x1="20" y1="50" x2="660" y2="50" stroke="var(--text-dim)" stroke-width="1.5"/>
          <polygon points="658,46 668,50 658,54" fill="var(--text-dim)"/>
          <polygon points="22,46 12,50 22,54" fill="var(--text-dim)"/>
        </svg>
      </div>
    </div>

    <div class="practice-complete" id="practiceComplete" style="display:none;">
      <div class="final-score" id="finalScore"></div>
      <div class="final-label">Correct out of 10</div>
      <button class="btn-accent" style="margin-top:1.5rem;" onclick="resetPractice()">Try Again</button>
    </div>

  </div>
</details>

<script>
/* ══════════════════════════════════════════════════════════
   SECTION 1 — Thermometer
   ══════════════════════════════════════════════════════════ */

const thermoSvg = document.getElementById('thermoSvg');
const mercuryFill = document.getElementById('mercuryFill');
const dragHandle = document.getElementById('dragHandle');
const tempValueEl = document.getElementById('tempValue');
const tempDescEl = document.getElementById('tempDesc');

// Thermometer mapping: y=24 -> 120F, y=291 -> -20F
// Range: 267px for 140 degrees
const THERMO_TOP = 24;
const THERMO_BOT = 291;
const TEMP_MAX = 120;
const TEMP_MIN = -20;

function yToTemp(y) {
  const clamped = Math.max(THERMO_TOP, Math.min(THERMO_BOT, y));
  const ratio = (clamped - THERMO_TOP) / (THERMO_BOT - THERMO_TOP);
  return Math.round(TEMP_MAX - ratio * (TEMP_MAX - TEMP_MIN));
}

function tempToY(temp) {
  const ratio = (TEMP_MAX - temp) / (TEMP_MAX - TEMP_MIN);
  return THERMO_TOP + ratio * (THERMO_BOT - THERMO_TOP);
}

function updateThermo(temp) {
  const y = tempToY(temp);
  mercuryFill.setAttribute('y', y);
  mercuryFill.setAttribute('height', 335 - y);
  dragHandle.setAttribute('y', y - 3);

  // Color
  let cls, color;
  if (temp < 0) {
    cls = 'negative'; color = 'var(--accent)';
    tempDescEl.textContent = 'Below zero -- negative territory';
  } else if (temp === 0) {
    cls = 'zero'; color = 'var(--orange)';
    tempDescEl.textContent = 'The freezing point -- our reference';
  } else {
    cls = 'positive'; color = 'var(--green)';
    tempDescEl.textContent = 'Positive -- above the reference';
  }
  tempValueEl.className = 'temp-value ' + cls;
  tempValueEl.textContent = temp + ' F';

  // Mercury color shift
  if (temp < 0) {
    mercuryFill.setAttribute('fill', 'var(--accent)');
  } else if (temp < 32) {
    mercuryFill.setAttribute('fill', 'var(--orange)');
  } else {
    mercuryFill.setAttribute('fill', 'var(--pink)');
  }
}

// Drag logic
let dragging = false;

function getSvgY(e) {
  const rect = thermoSvg.getBoundingClientRect();
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
  const scaleY = 340 / rect.height;
  return (clientY - rect.top) * scaleY;
}

thermoSvg.addEventListener('mousedown', (e) => { dragging = true; handleThermoDrag(e); });
thermoSvg.addEventListener('touchstart', (e) => { dragging = true; handleThermoDrag(e); }, {passive: false});
window.addEventListener('mousemove', (e) => { if (dragging) handleThermoDrag(e); });
window.addEventListener('touchmove', (e) => { if (dragging) { e.preventDefault(); handleThermoDrag(e); } }, {passive: false});
window.addEventListener('mouseup', () => { dragging = false; });
window.addEventListener('touchend', () => { dragging = false; });

function handleThermoDrag(e) {
  const y = getSvgY(e);
  const temp = yToTemp(y);
  updateThermo(temp);
}

// Initial state
updateThermo(72);


/* ══════════════════════════════════════════════════════════
   SECTION 1 — Number Line 1
   ══════════════════════════════════════════════════════════ */

const numline1 = document.getElementById('numline1');
let pos1 = 0;

function drawNumberLine(svg, yAxis, range, highlightPos, id) {
  // Clear old dynamic elements
  svg.querySelectorAll('.dynamic').forEach(el => el.remove());

  const min = range[0], max = range[1];
  const width = 640;
  const startX = 20;

  for (let i = min; i <= max; i++) {
    const x = startX + ((i - min) / (max - min)) * width;

    // Tick
    const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    tick.setAttribute('x1', x);
    tick.setAttribute('y1', yAxis - 6);
    tick.setAttribute('x2', x);
    tick.setAttribute('y2', yAxis + 6);
    tick.setAttribute('stroke', i === 0 ? '#f59e0b' : '#555');
    tick.setAttribute('stroke-width', i === 0 ? '2' : '1');
    tick.classList.add('dynamic');
    svg.appendChild(tick);

    // Label
    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    label.setAttribute('x', x);
    label.setAttribute('y', yAxis + 22);
    label.setAttribute('text-anchor', 'middle');
    label.setAttribute('fill', i === 0 ? '#f59e0b' : '#8a8678');
    label.setAttribute('font-size', '11');
    label.setAttribute('font-family', 'JetBrains Mono');
    label.textContent = i;
    label.classList.add('dynamic');
    svg.appendChild(label);
  }

  // Position marker
  if (highlightPos >= min && highlightPos <= max) {
    const px = startX + ((highlightPos - min) / (max - min)) * width;
    const marker = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    marker.setAttribute('cx', px);
    marker.setAttribute('cy', yAxis);
    marker.setAttribute('r', '8');
    marker.setAttribute('fill', 'var(--accent)');
    marker.classList.add('dynamic');
    svg.appendChild(marker);

    const markerLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    markerLabel.setAttribute('x', px);
    markerLabel.setAttribute('y', yAxis - 16);
    markerLabel.setAttribute('text-anchor', 'middle');
    markerLabel.setAttribute('fill', 'var(--accent)');
    markerLabel.setAttribute('font-size', '13');
    markerLabel.setAttribute('font-weight', '700');
    markerLabel.setAttribute('font-family', 'JetBrains Mono');
    markerLabel.textContent = highlightPos;
    markerLabel.classList.add('dynamic');
    svg.appendChild(markerLabel);
  }
}

function animateArrow(svg, yAxis, range, fromVal, toVal, color) {
  svg.querySelectorAll('.arrow').forEach(el => el.remove());

  const min = range[0], max = range[1];
  const width = 640;
  const startX = 20;

  const clampedFrom = Math.max(min, Math.min(max, fromVal));
  const clampedTo = Math.max(min, Math.min(max, toVal));

  const x1 = startX + ((clampedFrom - min) / (max - min)) * width;
  const x2 = startX + ((clampedTo - min) / (max - min)) * width;

  if (x1 === x2) return;

  const arrowY = yAxis - 28;
  const length = Math.abs(x2 - x1);

  // Arrow shaft
  const shaft = document.createElementNS('http://www.w3.org/2000/svg', 'line');
  shaft.setAttribute('x1', x1);
  shaft.setAttribute('y1', arrowY);
  shaft.setAttribute('x2', x2);
  shaft.setAttribute('y2', arrowY);
  shaft.setAttribute('stroke', color);
  shaft.setAttribute('stroke-width', '3');
  shaft.setAttribute('stroke-linecap', 'round');
  shaft.setAttribute('stroke-dasharray', length);
  shaft.setAttribute('stroke-dashoffset', length);
  shaft.classList.add('arrow');
  svg.appendChild(shaft);

  // Arrow head
  const dir = x2 > x1 ? 1 : -1;
  const headSize = 8;
  const head = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
  const hx = x2;
  const hy = arrowY;
  head.setAttribute('points',
    `${hx},${hy - headSize} ${hx + dir * headSize},${hy} ${hx},${hy + headSize}`
  );
  head.setAttribute('fill', color);
  head.setAttribute('opacity', '0');
  head.classList.add('arrow');
  svg.appendChild(head);

  // Animate
  const duration = 500;
  const start = performance.now();

  function tick(now) {
    const t = Math.min(1, (now - start) / duration);
    const eased = 1 - Math.pow(1 - t, 3); // ease-out cubic
    shaft.setAttribute('stroke-dashoffset', length * (1 - eased));
    if (t > 0.7) {
      head.setAttribute('opacity', String((t - 0.7) / 0.3));
    }
    if (t < 1) requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
}

function moveOnLine1(delta) {
  const oldPos = pos1;
  pos1 = Math.max(-10, Math.min(10, pos1 + delta));
  document.getElementById('nlPos1').textContent = pos1;
  drawNumberLine(numline1, 50, [-10, 10], pos1);
  const color = delta > 0 ? '#22c55e' : '#ec4899';
  animateArrow(numline1, 50, [-10, 10], oldPos, pos1, color);
}

function resetLine1() {
  pos1 = 0;
  document.getElementById('nlPos1').textContent = 0;
  numline1.querySelectorAll('.arrow').forEach(el => el.remove());
  drawNumberLine(numline1, 50, [-10, 10], 0);
}

drawNumberLine(numline1, 50, [-10, 10], 0);


/* ══════════════════════════════════════════════════════════
   SECTION 2 — Operations Explorer
   ══════════════════════════════════════════════════════════ */

const aSlider = document.getElementById('aSlider');
const bSlider = document.getElementById('bSlider');
const aValEl = document.getElementById('aVal');
const bValEl = document.getElementById('bVal');
const opResultEl = document.getElementById('opResult');
const opExplEl = document.getElementById('opExplanation');
const numline2 = document.getElementById('numline2');
let currentOp = '+';

// Op buttons
document.querySelectorAll('.op-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.op-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    currentOp = btn.dataset.op;
    updateOpDisplay();
  });
});

aSlider.addEventListener('input', () => { aValEl.textContent = aSlider.value; updateOpDisplay(); });
bSlider.addEventListener('input', () => { bValEl.textContent = bSlider.value; updateOpDisplay(); });

function getOpResult(a, b, op) {
  switch(op) {
    case '+': return a + b;
    case '-': return a - b;
    case '*': return a * b;
    case '/': return b === 0 ? undefined : a / b;
  }
}

function getOpSymbol(op) {
  return op === '*' ? ' x ' : op === '/' ? ' / ' : ' ' + op + ' ';
}

function formatNum(n) {
  if (n === undefined) return 'undefined';
  if (!Number.isInteger(n)) return n.toFixed(2);
  return String(n);
}

function getExplanation(a, b, op) {
  if (op === '+') {
    if (b >= 0) return 'Adding a positive: move right on the number line.';
    return 'Adding a negative: move left on the number line.';
  }
  if (op === '-') {
    if (b >= 0) return 'Subtracting a positive: move left on the number line.';
    return 'Subtracting a negative: the double-flip -- minus a minus goes RIGHT.';
  }
  if (op === '*' || op === '/') {
    const signA = a >= 0 ? '+' : '-';
    const signB = b >= 0 ? '+' : '-';
    if (signA === signB) return 'Same signs: result is positive.';
    return 'Different signs: result is negative.';
  }
  return '';
}

function updateOpDisplay() {
  const a = parseInt(aSlider.value);
  const b = parseInt(bSlider.value);
  const result = getOpResult(a, b, currentOp);
  const sym = getOpSymbol(currentOp);

  // Color the slider values
  aValEl.style.color = a < 0 ? 'var(--pink)' : a === 0 ? 'var(--orange)' : 'var(--green)';
  bValEl.style.color = b < 0 ? 'var(--pink)' : b === 0 ? 'var(--orange)' : 'var(--green)';

  const aStr = a < 0 ? '(' + a + ')' : String(a);
  const bStr = b < 0 ? '(' + b + ')' : String(b);

  if (result === undefined) {
    opResultEl.innerHTML = '<span class="expr">' + aStr + sym + bStr + '</span><span class="equals">=</span><span style="color:var(--red)">undefined (division by zero)</span>';
  } else {
    opResultEl.innerHTML = '<span class="expr">' + aStr + sym + bStr + '</span><span class="equals">=</span><span class="answer">' + formatNum(result) + '</span>';
  }

  opExplEl.textContent = getExplanation(a, b, currentOp);

  // Highlight sign grid
  highlightSignGrid(a, b, currentOp);
}

function highlightSignGrid(a, b, op) {
  document.querySelectorAll('.sign-grid .cell').forEach(c => c.classList.remove('highlighted'));
  if (op !== '*' && op !== '/') return;
  const sa = a >= 0 ? 'p' : 'n';
  const sb = b >= 0 ? 'p' : 'n';
  const target = document.querySelector('.sign-grid .cell[data-signs="' + sa + sb + '"]');
  if (target) target.classList.add('highlighted');
}

function animateOp() {
  const a = parseInt(aSlider.value);
  const b = parseInt(bSlider.value);
  const result = getOpResult(a, b, currentOp);
  if (result === undefined) return;

  // Determine number line range
  const values = [a, result, 0];
  let min = Math.min(...values) - 2;
  let max = Math.max(...values) + 2;
  min = Math.max(-20, Math.min(-2, min));
  max = Math.min(30, Math.max(2, max));

  // For +/-, show arrow from a to result
  if (currentOp === '+' || currentOp === '-') {
    drawNumberLine(numline2, 60, [min, max], a);
    setTimeout(() => {
      const color = result >= a ? '#22c55e' : '#ec4899';
      animateArrow(numline2, 60, [min, max], a, result, color);
      // After animation, update marker
      setTimeout(() => {
        drawNumberLine(numline2, 60, [min, max], result);
        // Keep the arrow visible
      }, 600);
    }, 100);

    // For subtraction of negative, show double-flip
    if (currentOp === '-' && b < 0) {
      opExplEl.textContent = 'Double-flip: subtract -> go left, but negative -> flip right!';
    }
  } else {
    // For * and /, just show the result on the line
    const rValues = [0, result];
    let rmin = Math.min(...rValues) - 2;
    let rmax = Math.max(...rValues) + 2;
    rmin = Math.max(-30, Math.min(-2, rmin));
    rmax = Math.min(30, Math.max(2, rmax));
    drawNumberLine(numline2, 60, [rmin, rmax], 0);
    setTimeout(() => {
      const color = result >= 0 ? '#22c55e' : '#ec4899';
      animateArrow(numline2, 60, [rmin, rmax], 0, result, color);
      setTimeout(() => {
        drawNumberLine(numline2, 60, [rmin, rmax], result);
      }, 600);
    }, 100);
  }
}

// Initialize section 2
drawNumberLine(numline2, 60, [-15, 15], 0);
updateOpDisplay();


/* ══════════════════════════════════════════════════════════
   SECTION 3 — Practice Problems
   ══════════════════════════════════════════════════════════ */

const problems = [
  { expr: '7 + (-4)',        answer: 3,   display: '7 + (-4) = <span class="qmark">?</span>' },
  { expr: '-6 + 9',          answer: 3,   display: '-6 + 9 = <span class="qmark">?</span>' },
  { expr: '-3 - 5',          answer: -8,  display: '-3 - 5 = <span class="qmark">?</span>' },
  { expr: '-4 - (-7)',       answer: 3,   display: '-4 - (-7) = <span class="qmark">?</span>' },
  { expr: '0 - (-8)',        answer: 8,   display: '0 - (-8) = <span class="qmark">?</span>' },
  { expr: '(-5) x 3',       answer: -15, display: '(-5) x 3 = <span class="qmark">?</span>' },
  { expr: '(-4) x (-6)',    answer: 24,  display: '(-4) x (-6) = <span class="qmark">?</span>' },
  { expr: '(-18) / 3',      answer: -6,  display: '(-18) / 3 = <span class="qmark">?</span>' },
  { expr: '(-2)^3',          answer: -8,  display: '(-2)<sup>3</sup> = <span class="qmark">?</span>' },
  { expr: '-3 + 2 x (-4)',  answer: -11, display: '-3 + 2 x (-4) = <span class="qmark">?</span>' },
];

let currentProblem = 0;
let score = 0;
let answered = 0;

const problemExprEl = document.getElementById('problemExpr');
const problemNumEl = document.getElementById('problemNumber');
const answerInput = document.getElementById('answerInput');
const feedbackEl = document.getElementById('feedback');
const scoreEl = document.getElementById('scoreDisplay');
const progressEl = document.getElementById('practiceProgress');
const submitBtn = document.getElementById('submitBtn');
const numline3 = document.getElementById('numline3');

function loadProblem() {
  if (currentProblem >= problems.length) {
    showComplete();
    return;
  }
  const p = problems[currentProblem];
  problemNumEl.textContent = 'Problem ' + (currentProblem + 1);
  problemExprEl.innerHTML = p.display;
  answerInput.value = '';
  answerInput.className = 'answer-input';
  answerInput.disabled = false;
  feedbackEl.textContent = '';
  feedbackEl.className = 'feedback';
  submitBtn.textContent = 'Check';
  submitBtn.onclick = checkAnswer;
  progressEl.textContent = 'Problem ' + (currentProblem + 1) + ' of 10';

  // Draw clean number line for context
  drawPracticeNumberLine(0, null);
  answerInput.focus();
}

function drawPracticeNumberLine(highlight, arrowTo) {
  // Adaptive range based on current problem answer
  const p = problems[currentProblem] || problems[0];
  const ans = p.answer;
  const absMax = Math.max(Math.abs(ans) + 3, 12);
  const min = -absMax;
  const max = absMax;

  drawNumberLine(numline3, 50, [min, max], highlight);
  if (arrowTo !== null && arrowTo !== highlight) {
    const color = arrowTo >= highlight ? '#22c55e' : '#ec4899';
    setTimeout(() => animateArrow(numline3, 50, [min, max], highlight, arrowTo, color), 200);
    setTimeout(() => drawNumberLine(numline3, 50, [min, max], arrowTo), 800);
  }
}

function checkAnswer() {
  const p = problems[currentProblem];
  const userAnswer = parseFloat(answerInput.value.trim());

  if (isNaN(userAnswer)) {
    feedbackEl.textContent = 'Enter a number.';
    feedbackEl.className = 'feedback incorrect';
    return;
  }

  answered++;

  if (userAnswer === p.answer) {
    score++;
    answerInput.className = 'answer-input correct';
    feedbackEl.textContent = 'Correct!';
    feedbackEl.className = 'feedback correct';
  } else {
    answerInput.className = 'answer-input incorrect';
    feedbackEl.textContent = 'Not quite. The answer is ' + p.answer + '.';
    feedbackEl.className = 'feedback incorrect';
  }

  scoreEl.innerHTML = '<span>' + score + '</span> / ' + answered;
  answerInput.disabled = true;

  // Animate the solution on the number line
  animateSolution(p);

  // Change button to "Next"
  submitBtn.textContent = currentProblem < problems.length - 1 ? 'Next' : 'Finish';
  submitBtn.onclick = () => {
    currentProblem++;
    loadProblem();
  };
}

function animateSolution(p) {
  const ans = p.answer;
  const absMax = Math.max(Math.abs(ans) + 3, 12);
  const min = -absMax;
  const max = absMax;

  // For addition/subtraction type problems, show start -> result
  // We parse the problem to determine start and movement
  const expr = p.expr;

  // Simple heuristic: find the first number as start position
  // and animate to the answer
  let startPos = 0;

  // Try to extract first number
  const firstNumMatch = expr.match(/^(-?\d+)/);
  if (firstNumMatch) {
    startPos = parseInt(firstNumMatch[1]);
  } else if (expr.startsWith('(')) {
    const parenMatch = expr.match(/^\((-?\d+)\)/);
    if (parenMatch) startPos = parseInt(parenMatch[1]);
  }

  // Clamp to range
  startPos = Math.max(min, Math.min(max, startPos));
  const endPos = Math.max(min, Math.min(max, ans));

  drawNumberLine(numline3, 50, [min, max], startPos);

  if (startPos !== endPos) {
    const color = endPos >= startPos ? '#22c55e' : '#ec4899';
    setTimeout(() => animateArrow(numline3, 50, [min, max], startPos, endPos, color), 200);
    setTimeout(() => drawNumberLine(numline3, 50, [min, max], endPos), 800);
  }
}

function showComplete() {
  document.getElementById('problemArea').style.display = 'none';
  const completeEl = document.getElementById('practiceComplete');
  completeEl.style.display = 'block';
  document.getElementById('finalScore').textContent = score + ' / 10';
  progressEl.textContent = 'Complete!';
}

function resetPractice() {
  currentProblem = 0;
  score = 0;
  answered = 0;
  scoreEl.innerHTML = '0 / 0';
  document.getElementById('problemArea').style.display = 'block';
  document.getElementById('practiceComplete').style.display = 'none';
  loadProblem();
}

// Enter key to submit
answerInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    if (submitBtn.textContent === 'Check') {
      checkAnswer();
    } else {
      currentProblem++;
      loadProblem();
    }
  }
});

loadProblem();


/* ══════════════════════════════════════════════════════════
   PROGRESS BAR TRACKING
   ══════════════════════════════════════════════════════════ */

const sections = [
  document.getElementById('section1'),
  document.getElementById('section2'),
  document.getElementById('section3')
];
const progressSegments = document.querySelectorAll('.progress-segment');

// Track which sections have been opened (viewed)
const viewed = new Set();

function updateProgress() {
  sections.forEach((section, i) => {
    const seg = progressSegments[i];
    if (section.open) {
      viewed.add(i);
      seg.classList.add('active');
    }
    if (viewed.has(i) && !section.open) {
      seg.classList.remove('active');
      seg.classList.add('complete');
    }
    if (section.open) {
      seg.classList.remove('complete');
      seg.classList.add('active');
    }
  });
}

sections.forEach(section => {
  section.addEventListener('toggle', updateProgress);
});

// Clicking a progress segment opens that section
progressSegments.forEach((seg, i) => {
  seg.addEventListener('click', () => {
    // Close all, open target
    sections.forEach((s, j) => {
      if (j === i) { s.open = true; }
      else { s.open = false; }
    });
    sections[i].scrollIntoView({ behavior: 'smooth', block: 'start' });
    updateProgress();
  });
});

// Initialize
updateProgress();

</script>
</body>
</html>
