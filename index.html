<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Riner Research Hub â€” Prime Gravity</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#0a0a1a;--card:#111128;--card-border:#1a1a3a;--text:#e0e0f0;--text-dim:#8888aa;
--accent1:#6366f1;--accent2:#a855f7;--accent3:#ec4899;--green:#22c55e;--orange:#f59e0b;
/* Chalkboard palette */
--chalk:#d4cfc4;--chalk-dim:rgba(212,207,196,.35);--chalk-faint:rgba(212,207,196,.15);
--board:#2b2f3a;--board-light:#343a46;--board-dark:#1e2128;
}
html,body{width:100%;height:100%;overflow:hidden;font-family:'JetBrains Mono',monospace;background:var(--board-dark);color:var(--text)}

/* â”€â”€ SVG noise filter (referenced by chalkboard) â”€â”€ */
#chalk-noise{position:absolute;width:0;height:0}

/* â”€â”€ Chalkboard Background (fallback behind video) â”€â”€ */
#chalkboard{
  position:fixed;inset:0;z-index:0;
  background-color: var(--board);
}

/* YouTube Background */
#yt-bg{position:fixed;inset:0;z-index:0;overflow:hidden;background:transparent}
#yt-bg iframe{position:absolute;top:50%;left:50%;min-width:200vh;min-height:60vw;width:200vh;height:120vh;transform:translate(-50%,-50%);pointer-events:none}

/* â”€â”€ Chalk Formulas â”€â”€ */
#chalk-formulas{
  position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;
}
.chalk-eq{
  position:absolute;
  font-family:'JetBrains Mono',monospace;
  color:var(--chalk);
  white-space:nowrap;
  user-select:none;
  pointer-events:none;
  text-shadow:0 0 4px rgba(212,207,196,.15);
  line-height:1;
}

/* Overlays */
#scanlines{position:fixed;inset:0;z-index:1;pointer-events:none;
background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.04) 2px,rgba(0,0,0,.04) 4px)}
#vignette{position:fixed;inset:0;z-index:1;pointer-events:none;
background:radial-gradient(ellipse at center,transparent 40%,rgba(0,0,0,.5) 100%)}

/* Status Bar */
#status-bar{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;justify-content:space-between;align-items:center;
padding:8px 20px;background:rgba(30,33,40,.88);backdrop-filter:blur(8px);border-bottom:1px solid rgba(212,207,196,.12);font-size:12px;letter-spacing:1px}
#status-bar .left{display:flex;align-items:center;gap:8px;color:var(--chalk);font-weight:700;text-transform:uppercase}
#status-bar .right{display:flex;align-items:center;gap:16px;color:rgba(212,207,196,.5);font-size:11px}
.pulse-dot{width:8px;height:8px;border-radius:50%;background:var(--green);animation:pulse 2s ease-in-out infinite;display:inline-block}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 4px var(--green)}50%{opacity:.4;box-shadow:0 0 8px var(--green)}}

/* â”€â”€ SIDEBAR â”€â”€ */
#sidebar{
  position:fixed;left:0;top:36px;bottom:0;z-index:50;
  width:56px;
  background:rgba(30,33,40,.65);
  backdrop-filter:blur(6px);
  border-right:1px solid rgba(212,207,196,.08);
  display:flex;flex-direction:column;align-items:center;
  padding:12px 0;gap:4px;
  transition:width .3s ease;
  overflow:hidden;
}
/* Chalk-dust edge on the right border */
#sidebar::after{
  content:'';position:absolute;right:-1px;top:0;bottom:0;width:3px;
  background:linear-gradient(180deg,
    transparent 0%,
    rgba(212,207,196,.06) 10%,
    rgba(212,207,196,.1) 25%,
    rgba(212,207,196,.04) 40%,
    rgba(212,207,196,.08) 55%,
    rgba(212,207,196,.03) 70%,
    rgba(212,207,196,.07) 85%,
    transparent 100%
  );
  pointer-events:none;
}
#sidebar:hover{width:200px}
#sidebar:hover .nav-label{opacity:1}

.nav-item{
  display:flex;align-items:center;gap:10px;
  width:calc(100% - 12px);padding:8px 12px;margin:0 6px;
  border-radius:8px;cursor:pointer;
  text-decoration:none;color:rgba(212,207,196,.5);
  transition:all .2s;white-space:nowrap;overflow:hidden;
  font-size:13px;
}
.nav-item:hover{
  background:rgba(212,207,196,.08);color:var(--chalk);
}
.nav-item .nav-icon{
  font-size:20px;flex-shrink:0;width:28px;text-align:center;
}
.nav-label{
  opacity:0;transition:opacity .2s;font-size:11px;font-weight:500;
  color:rgba(212,207,196,.7);
}
.nav-item:hover .nav-label{color:var(--chalk)}

.nav-divider{
  width:30px;height:1px;background:rgba(212,207,196,.1);margin:6px 0;
}

/* â”€â”€ Floating Windows â”€â”€ */
.float-win{
  position:fixed;z-index:200;
  background:rgba(10,10,26,.95);
  border:1px solid var(--accent1);
  border-radius:10px;
  box-shadow:0 8px 32px rgba(0,0,0,.6);
  display:flex;flex-direction:column;
  min-width:320px;min-height:240px;
  overflow:hidden;
  backdrop-filter:blur(12px);
}
.float-win .win-titlebar{
  display:flex;align-items:center;justify-content:space-between;
  padding:6px 10px;
  background:rgba(17,17,40,.9);
  border-bottom:1px solid var(--card-border);
  cursor:grab;user-select:none;
  flex-shrink:0;
}
.float-win .win-titlebar:active{cursor:grabbing}
.float-win .win-title{font-size:11px;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase}
.float-win .win-btns{display:flex;gap:4px}
.float-win .win-btn{
  width:24px;height:24px;border-radius:4px;border:1px solid var(--card-border);
  background:rgba(17,17,40,.8);color:var(--text-dim);font-size:12px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .15s;
}
.float-win .win-btn:hover{border-color:var(--accent1);color:var(--text)}
.float-win .win-btn.close:hover{border-color:var(--accent3);color:var(--accent3)}
.float-win iframe{flex:1;border:none;width:100%;height:100%;border-radius:0 0 9px 9px}
.float-win .win-resize{
  position:absolute;bottom:0;right:0;width:16px;height:16px;cursor:nwse-resize;
}
.float-win .win-resize::after{
  content:'';position:absolute;bottom:3px;right:3px;
  width:8px;height:8px;
  border-right:2px solid var(--text-dim);border-bottom:2px solid var(--text-dim);
  opacity:.4;
}

/* â”€â”€ Controls â”€â”€ */
#controls{position:fixed;bottom:14px;right:14px;z-index:100;display:flex;gap:8px;align-items:flex-end}
.ctrl-btn{width:36px;height:36px;border-radius:6px;background:rgba(30,33,40,.85);border:1px solid rgba(212,207,196,.12);
color:rgba(212,207,196,.5);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;
backdrop-filter:blur(6px);transition:all .2s}
.ctrl-btn:hover{border-color:rgba(212,207,196,.3);color:var(--chalk)}

#scene-list,#radio-list{position:absolute;bottom:44px;right:0;background:rgba(30,33,40,.92);border:1px solid rgba(212,207,196,.12);
border-radius:6px;padding:6px 0;display:none;min-width:220px;backdrop-filter:blur(10px)}
#scene-list.open,#radio-list.open{display:block}
.scene-item,.radio-item{padding:8px 14px;font-size:11px;cursor:pointer;color:rgba(212,207,196,.5);transition:all .15s;white-space:nowrap}
.scene-item:hover,.scene-item.active,.radio-item:hover,.radio-item.active{color:var(--chalk);background:rgba(212,207,196,.08)}
.radio-item .radio-sub{font-size:9px;color:rgba(212,207,196,.35);margin-top:2px}
.radio-item.playing{color:var(--green)}
.radio-item.playing::before{content:'â–¶ ';color:var(--green)}

/* â”€â”€ Welcome Panel â”€â”€ */
#welcome-panel{
  position:fixed;z-index:300;
  top:50%;left:50%;transform:translate(-50%,-50%);
  width:min(580px,90vw);
  background:rgba(10,10,26,.97);
  border:1px solid var(--accent1);
  border-radius:10px;
  box-shadow:0 8px 48px rgba(99,102,241,.25),0 0 80px rgba(99,102,241,.08);
  backdrop-filter:blur(14px);
  display:none;flex-direction:column;
  overflow:hidden;
  animation:welcomeFadeIn .5s ease forwards;
}
@keyframes welcomeFadeIn{from{opacity:0;transform:translate(-50%,-50%) scale(.96)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}
#welcome-panel .win-titlebar{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 12px;
  background:rgba(17,17,40,.9);
  border-bottom:1px solid var(--card-border);
  cursor:grab;user-select:none;
}
#welcome-panel .win-title{font-size:11px;color:var(--accent1);letter-spacing:1px;text-transform:uppercase;font-weight:700}
#welcome-panel .welcome-body{padding:24px 28px;overflow-y:auto;max-height:70vh}
#welcome-panel .welcome-body h2{font-size:16px;color:var(--text);margin-bottom:8px;line-height:1.4}
#welcome-panel .welcome-body .subtitle{font-size:12px;color:var(--text-dim);margin-bottom:16px;line-height:1.5}
#welcome-panel .welcome-body .equation{
  font-size:14px;color:var(--accent2);text-align:center;
  padding:12px;margin:14px 0;
  background:rgba(168,85,247,.08);border:1px solid rgba(168,85,247,.2);border-radius:6px;
  font-weight:500;letter-spacing:.5px;
}
#welcome-panel .welcome-body ul{list-style:none;padding:0;margin:14px 0}
#welcome-panel .welcome-body ul li{
  font-size:12px;color:var(--text-dim);padding:5px 0;padding-left:18px;position:relative;line-height:1.5;
}
#welcome-panel .welcome-body ul li::before{content:'â–¸';position:absolute;left:0;color:var(--accent1)}
#welcome-panel .welcome-body .welcome-actions{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap}
#welcome-panel .welcome-body .welcome-btn{
  padding:8px 18px;border-radius:6px;font-size:12px;font-family:inherit;
  cursor:pointer;border:1px solid var(--accent1);transition:all .2s;
  text-decoration:none;display:inline-flex;align-items:center;gap:6px;
}
#welcome-panel .welcome-body .welcome-btn.primary{
  background:var(--accent1);color:#fff;border-color:var(--accent1);
}
#welcome-panel .welcome-body .welcome-btn.primary:hover{background:#4f46e5}
#welcome-panel .welcome-body .welcome-btn.secondary{
  background:transparent;color:var(--accent1);
}
#welcome-panel .welcome-body .welcome-btn.secondary:hover{background:rgba(99,102,241,.12)}
#welcome-panel .welcome-body .doi{font-size:10px;color:var(--text-dim);margin-top:12px;opacity:.7}

/* â”€â”€ Paper Ticker â”€â”€ */
#paper-ticker{display:inline-block;overflow:hidden;max-width:320px;white-space:nowrap;vertical-align:middle}
#paper-ticker .ticker-track{
  display:inline-block;white-space:nowrap;
  animation:tickerScroll 40s linear infinite;
}
@keyframes tickerScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
#paper-ticker .ticker-track span{color:var(--green);margin-right:6px}

/* â”€â”€ Responsive â”€â”€ */
@media(max-width:600px){
  #sidebar{width:48px}
  #sidebar:hover{width:180px}
  .nav-item .nav-icon{font-size:18px}
  #status-bar{font-size:10px;padding:6px 10px}
  #status-bar .right span:not(:last-child){display:none}
  .chalk-eq{display:none}
}
</style>
</head>
<body>

<!-- SVG filter for chalkboard grain texture -->
<svg id="chalk-noise" xmlns="http://www.w3.org/2000/svg">
  <filter id="chalkGrain">
    <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch" result="noise"/>
    <feColorMatrix type="saturate" values="0" in="noise" result="gray"/>
    <feBlend in="SourceGraphic" in2="gray" mode="multiply"/>
  </filter>
</svg>

<!-- Chalkboard Background -->
<div id="chalkboard"></div>

<!-- Chalk Physics Formulas -->
<div id="chalk-formulas"></div>

<!-- YouTube Background (hidden, JS still functional) -->
<div id="yt-bg"><div id="yt-player"></div></div>
<div id="scanlines"></div>
<div id="vignette"></div>

<!-- Status Bar -->
<div id="status-bar">
<div class="left">â—† RINER RESEARCH HUB</div>
<div class="right">
<span><span class="pulse-dot"></span> SYSTEMS NOMINAL</span>
<span id="day-count">DAY 0</span>
<span>PAPERS 7</span>
<span id="paper-ticker"></span>
<span id="utc-clock">00:00:00 UTC</span>
</div>
</div>

<!-- Sidebar -->
<nav id="sidebar"></nav>

<!-- Floating windows container -->
<div id="windows"></div>

<!-- Welcome Panel -->
<div id="welcome-panel">
<div class="win-titlebar">
<span class="win-title"><span class="pulse-dot" style="margin-right:6px"></span> Paper 7 â€” Now Live</span>
<div class="win-btns">
<button class="win-btn close" onclick="document.getElementById('welcome-panel').style.display='none'" title="Close">&times;</button>
</div>
</div>
<div class="welcome-body">
<h2>Emergence of General Relativity from the Prime Number Structure of the Riemann Zeta Function</h2>
<p class="subtitle">The Schwarzschild metric emerges naturally when spacetime geometry is parameterized by the Riemann zeta function &#950;(s).</p>
<div class="equation">&#950;(s) &times; 1/&#950;(s) = 1 &nbsp;&rarr;&nbsp; g<sub>tt</sub> &middot; g<sub>rr</sub> = &minus;1</div>
<ul>
<li>GPS satellite timing accuracy reproduced to &lt;1% from prime-zeta coupling</li>
<li>Bosonic string gravity recovered via &#950;-regularized partition functions</li>
<li>Holographic principle emerges from prime-counting density at the boundary</li>
<li>4 testable predictions: modified dispersion, prime-frequency GW signatures, lab BEC shifts, CMB correlations</li>
</ul>
<div class="welcome-actions">
<a href="https://zenodo.org/records/18751909" target="_blank" class="welcome-btn primary">Read the Paper</a>
<a href="simulators/metric.html" class="welcome-btn secondary" onclick="event.preventDefault();document.getElementById('welcome-panel').style.display='none';openWindow('simulators/metric.html','Prime Metric')">Explore the Metric</a>
</div>
<p class="doi">DOI: 10.5281/zenodo.18751909</p>
</div>
</div>

<!-- Controls -->
<div id="controls">
<button class="ctrl-btn" onclick="openWindow('tools/calculator.html','Calculator')" title="Scientific Calculator">ðŸ§®</button>
<div style="position:relative">
<button class="ctrl-btn" id="radio-btn" onclick="toggleRadioList()" title="Space Radio">ðŸ“»</button>
<div id="radio-list"></div>
</div>
<button class="ctrl-btn" id="audio-btn" onclick="toggleAudio()" title="Toggle Video Audio">ðŸ”‡</button>
<div style="position:relative">
<button class="ctrl-btn" onclick="toggleSceneList()" title="Change Scene">ðŸŽ¬</button>
<div id="scene-list"></div>
</div>
</div>
<audio id="radio-player" crossorigin="anonymous"></audio>

<script>
// â”€â”€ CHALK FORMULAS â”€â”€
// Physics equations scattered across the chalkboard background
(function(){
const formulas = [
  // CJ's research
  { eq:'Î¶(s) Ã— 1/Î¶(s) = 1', x:8, y:12, size:18, angle:-2, opacity:.18 },
  { eq:'g_tt Â· g_rr = âˆ’1', x:72, y:8, size:16, angle:1.5, opacity:.14 },
  { eq:'s(r) = 1 + (r/r_s)Â³', x:35, y:85, size:14, angle:-1, opacity:.12 },
  { eq:'Ï€(x) ~ x / ln(x)', x:78, y:88, size:13, angle:2, opacity:.1 },
  { eq:'Î£ pâ»Ë¢ = ln Î¶(s)', x:15, y:55, size:15, angle:-1.5, opacity:.13 },
  // Classical GR & QFT
  { eq:'R_Î¼Î½ âˆ’ Â½g_Î¼Î½ R = 8Ï€GT_Î¼Î½', x:55, y:18, size:15, angle:0.8, opacity:.12 },
  { eq:'dsÂ² = âˆ’cÂ²dtÂ² + drÂ² + rÂ²dÎ©Â²', x:20, y:30, size:14, angle:-0.5, opacity:.1 },
  { eq:'âˆ‚_Î¼ F^Î¼Î½ = J^Î½', x:82, y:42, size:16, angle:1.2, opacity:.14 },
  { eq:'S = âˆ« L dâ´x', x:65, y:72, size:17, angle:-1.8, opacity:.15 },
  { eq:'âˆ‡Â²Ïˆ + kÂ²Ïˆ = 0', x:10, y:75, size:13, angle:0.5, opacity:.11 },
  // Quantum mechanics
  { eq:'iâ„ âˆ‚Ïˆ/âˆ‚t = Ä¤Ïˆ', x:45, y:60, size:16, angle:-1, opacity:.13 },
  { eq:'âŸ¨x|pâŸ© = e^(ipx/â„)', x:88, y:25, size:12, angle:1, opacity:.09 },
  { eq:'[xÌ‚, pÌ‚] = iâ„', x:30, y:45, size:14, angle:2.5, opacity:.11 },
  // Thermodynamics & statistical
  { eq:'S = k_B ln Î©', x:68, y:55, size:15, angle:-0.8, opacity:.12 },
  { eq:'E = mcÂ²', x:50, y:92, size:20, angle:0.3, opacity:.08 },
  // More number theory / zeta
  { eq:'Î¶(s) = Î£ nâ»Ë¢', x:5, y:92, size:12, angle:1.2, opacity:.1 },
  { eq:'âˆ® AÂ·dl = Î¦_B', x:90, y:70, size:13, angle:-2, opacity:.1 },
  { eq:'det(g_Î¼Î½) â‰  0', x:42, y:38, size:12, angle:0.6, opacity:.09 },
  { eq:'Î“^Î»_Î¼Î½ = Â½g^Î»Ïƒ(âˆ‚_Î¼ g_Î½Ïƒ + âˆ‚_Î½ g_Î¼Ïƒ âˆ’ âˆ‚_Ïƒ g_Î¼Î½)', x:15, y:68, size:11, angle:-0.3, opacity:.08 },
  { eq:'Î± = 3', x:58, y:82, size:22, angle:-1.5, opacity:.1 },
];

const container = document.getElementById('chalk-formulas');
formulas.forEach(f => {
  const el = document.createElement('div');
  el.className = 'chalk-eq';
  el.textContent = f.eq;
  el.style.cssText = `
    left:${f.x}%;top:${f.y}%;
    font-size:${f.size}px;
    opacity:${f.opacity};
    transform:rotate(${f.angle}deg);
    font-weight:${f.size > 16 ? 400 : 300};
  `;
  container.appendChild(el);
});
})();

const SCENES=[
{id:'jTCf8eZyZFg',name:'Chalkboard Ambience'},
{id:'Dvwaq1rwioQ',name:'Enceladus Outpost'},
{id:'WjY0s0ALnRU',name:'Space Ambience I'},
{id:'1fDP9T9Cagg',name:'Space Ambience II'},
{id:'hSwcHHPcw2o',name:'Winter Mission Outpost'},
{id:'9wGczUUnczc',name:'Lofi Vibes'},
{id:'ACdxsbGVeNE',name:'Lofi Vibes II'}
];

const NAV=[
{icon:'ðŸŒŒ',label:'GR from Primes',href:'https://zenodo.org/records/18751909'},
{icon:'ðŸ“',label:'Prime Metric',href:'simulators/metric.html'},
{icon:'ðŸ•³ï¸',label:'Black Hole Primes',href:'simulators/blackhole-simulator.html'},
{icon:'ðŸ“„',label:'Publications',href:'pages/publications.html'},
{divider:true},
{icon:'ðŸŒ€',label:'Big Picture',href:'pages/big-picture.html'},
{icon:'ðŸ“¡',label:'Research Feed',href:'pages/research-feed.html'},
{icon:'ðŸŽ¨',label:'Visualizations',href:'pages/visualizations.html'},
{divider:true},
{icon:'ðŸ”§',label:'Projects',href:'pages/projects.html'},
{icon:'ðŸ§®',label:'Daily Practice',href:'pages/daily-practice.html'},
{icon:'ðŸ“Š',label:'Math Journey',href:'pages/math-journey.html'},
{divider:true},
{icon:'ðŸ’¡',label:'Speculative',href:'pages/speculative.html'},
{icon:'ðŸ—ºï¸',label:'Log & Roadmap',href:'pages/log-roadmap.html'},
{icon:'ðŸ“',label:'Paper Editor',href:'tools/editor.html'},
{icon:'ðŸª',label:'Expedition',href:'simulators/expedition.html'},
];

let player,currentScene=0,isMuted=true;
let winZ=200,winCount=0,winOffset=0;

// YouTube API
const tag=document.createElement('script');
tag.src='https://www.youtube.com/iframe_api';
document.head.appendChild(tag);

window.onYouTubeIframeAPIReady=function(){
player=new YT.Player('yt-player',{
videoId:SCENES[0].id,
playerVars:{autoplay:1,mute:1,controls:0,showinfo:0,modestbranding:1,rel:0,
loop:1,playlist:SCENES[0].id,playsinline:1,disablekb:1,fs:0,iv_load_policy:3,
origin:window.location.origin},
events:{onReady:function(e){e.target.playVideo()},
onStateChange:function(e){
// If video pauses unexpectedly (e.g. from iframe focus), resume it
if(e.data===YT.PlayerState.PAUSED){
setTimeout(()=>{try{e.target.playVideo()}catch(ex){}},200);
}
}}
});
};
// Keep video playing even when iframes steal focus
setInterval(()=>{
if(player&&player.getPlayerState&&player.getPlayerState()===YT.PlayerState.PAUSED){
try{player.playVideo()}catch(e){}
}
},2000);

function switchScene(i){
currentScene=i;
if(player&&player.loadVideoById){
player.loadVideoById({videoId:SCENES[i].id,suggestedQuality:'hd1080'});
setTimeout(()=>{try{player.setLoop(true)}catch(e){}},1000);
}
document.querySelectorAll('.scene-item').forEach((el,j)=>el.classList.toggle('active',j===i));
}

function toggleAudio(){
if(!player)return;
isMuted=!isMuted;
if(isMuted){player.mute()}else{player.unMute()}
document.getElementById('audio-btn').textContent=isMuted?'ðŸ”‡':'ðŸ”Š';
}

function toggleSceneList(){document.getElementById('scene-list').classList.toggle('open')}

// Build scene list
const sl=document.getElementById('scene-list');
SCENES.forEach((s,i)=>{
const d=document.createElement('div');
d.className='scene-item'+(i===0?' active':'');
d.textContent=s.name;
d.onclick=()=>{switchScene(i);toggleSceneList()};
sl.appendChild(d);
});

// Build sidebar
const sidebar=document.getElementById('sidebar');
NAV.forEach(item=>{
if(item.divider){
const d=document.createElement('div');
d.className='nav-divider';
sidebar.appendChild(d);
return;
}
const a=document.createElement('div');
a.className='nav-item';
a.innerHTML=`<span class="nav-icon">${item.icon}</span><span class="nav-label">${item.label}</span>`;
a.onclick=()=>{
if(item.href.startsWith('http')){window.open(item.href,'_blank')}
else{openWindow(item.href,item.label)}
};
sidebar.appendChild(a);
});

// Floating windows
const winsEl=document.getElementById('windows');

function openWindow(href,title){
href+=(href.includes('?')?'&':'?')+'_t='+Date.now();
winCount++;winZ++;winOffset=(winOffset+30)%150;
const w=Math.min(560,window.innerWidth-200);
const h=Math.min(420,window.innerHeight-160);
const x=Math.max(70,120+winOffset);
const y=Math.max(50,80+winOffset);
const win=document.createElement('div');
win.className='float-win';
win.id='win-'+winCount;
win.style.cssText=`left:${x}px;top:${y}px;width:${w}px;height:${h}px;z-index:${winZ}`;
const iframeId='iframe-'+winCount;
win.innerHTML=`
<div class="win-titlebar" data-win="${win.id}">
<span class="win-title">${title}</span>
<div class="win-btns">
<button class="win-btn" onclick="maxWin('${win.id}')" title="Maximize">&#9633;</button>
<button class="win-btn close" onclick="closeWin('${win.id}')" title="Close">&times;</button>
</div>
</div>
<iframe id="${iframeId}" src="${href}"></iframe>
<div class="win-resize" data-win="${win.id}"></div>`;
winsEl.appendChild(win);
// Hide "Back to Hub" links inside iframe to prevent loading index.html in the window
const ifr=document.getElementById(iframeId);
ifr.addEventListener('load',()=>{
try{
const s=ifr.contentDocument.createElement('style');
s.textContent='.back-link{display:none!important}';
ifr.contentDocument.head.appendChild(s);
// Prevent links to index.html from navigating inside the iframe
ifr.contentDocument.querySelectorAll('a[href*="index.html"]').forEach(a=>{
a.style.display='none';
});
}catch(e){}
});
win.addEventListener('mousedown',()=>{winZ++;win.style.zIndex=winZ});
initDrag(win);
initResize(win);
}

function closeWin(id){
const w=document.getElementById(id);
if(w)w.remove();
}

function maxWin(id){
const w=document.getElementById(id);
if(!w)return;
if(w.dataset.maximized==='1'){
w.style.left=w.dataset.ox;w.style.top=w.dataset.oy;
w.style.width=w.dataset.ow;w.style.height=w.dataset.oh;
w.style.borderRadius='10px';
w.dataset.maximized='0';
}else{
w.dataset.ox=w.style.left;w.dataset.oy=w.style.top;
w.dataset.ow=w.style.width;w.dataset.oh=w.style.height;
w.style.left='56px';w.style.top='36px';
w.style.width='calc(100vw - 56px)';w.style.height='calc(100vh - 36px)';
w.style.borderRadius='0';
w.dataset.maximized='1';
}
}

function initDrag(win){
const bar=win.querySelector('.win-titlebar');
let dx,dy,dragging=false;
function startDrag(cx,cy,e){
if(e.target.closest('.win-btn'))return;
dragging=true;dx=cx-win.offsetLeft;dy=cy-win.offsetTop;
win.dataset.maximized='0';win.style.borderRadius='10px';
e.preventDefault();
}
function moveDrag(cx,cy){
if(!dragging)return;
win.style.left=Math.max(0,cx-dx)+'px';
win.style.top=Math.max(0,cy-dy)+'px';
}
function endDrag(){dragging=false}
bar.addEventListener('mousedown',e=>startDrag(e.clientX,e.clientY,e));
document.addEventListener('mousemove',e=>moveDrag(e.clientX,e.clientY));
document.addEventListener('mouseup',endDrag);
bar.addEventListener('touchstart',e=>{
const t=e.touches[0];startDrag(t.clientX,t.clientY,e);
},{passive:false});
document.addEventListener('touchmove',e=>{
if(!dragging)return;
const t=e.touches[0];moveDrag(t.clientX,t.clientY);
e.preventDefault();
},{passive:false});
document.addEventListener('touchend',endDrag);
}

function initResize(win){
const handle=win.querySelector('.win-resize');
let rx,ry,rw,rh,resizing=false;
function startResize(cx,cy,e){
resizing=true;rx=cx;ry=cy;
rw=win.offsetWidth;rh=win.offsetHeight;
e.preventDefault();e.stopPropagation();
}
function moveResize(cx,cy){
if(!resizing)return;
win.style.width=Math.max(280,rw+(cx-rx))+'px';
win.style.height=Math.max(200,rh+(cy-ry))+'px';
}
function endResize(){resizing=false}
handle.addEventListener('mousedown',e=>startResize(e.clientX,e.clientY,e));
document.addEventListener('mousemove',e=>moveResize(e.clientX,e.clientY));
document.addEventListener('mouseup',endResize);
handle.addEventListener('touchstart',e=>{
const t=e.touches[0];startResize(t.clientX,t.clientY,e);
},{passive:false});
document.addEventListener('touchmove',e=>{
if(!resizing)return;
const t=e.touches[0];moveResize(t.clientX,t.clientY);
e.preventDefault();
},{passive:false});
document.addEventListener('touchend',endResize);
}

document.addEventListener('keydown',e=>{
if(e.key==='Escape'){
const wins=winsEl.querySelectorAll('.float-win');
if(wins.length)wins[wins.length-1].remove();
}
});

// Clock & Day Counter
function updateClock(){
const now=new Date();
document.getElementById('utc-clock').textContent=now.toISOString().slice(11,19)+' UTC';
const epoch=new Date('2026-01-22T00:00:00Z');
const day=Math.floor((now-epoch)/864e5);
document.getElementById('day-count').textContent='DAY '+(day>0?day:0);
}
updateClock();setInterval(updateClock,1000);

// â”€â”€ SPACE RADIO â”€â”€
const RADIO_STATIONS=[
{name:'Mission Control',sub:'NASA audio + ambient music',url:'https://ice5.somafm.com/missioncontrol-128-mp3'},
{name:'Deep Space One',sub:'Deep ambient space music',url:'https://ice5.somafm.com/deepspaceone-128-mp3'},
{name:'Space Station Soma',sub:'Spaced-out ambient & electronica',url:'https://ice5.somafm.com/spacestation-128-mp3'},
{name:'Drone Zone',sub:'Atmospheric textures & drones',url:'https://ice5.somafm.com/dronezone-128-mp3'},
{name:'Off',sub:'Stop radio',url:null},
];

let radioPlaying=-1;
const radioPlayer=document.getElementById('radio-player');

const rl=document.getElementById('radio-list');
RADIO_STATIONS.forEach((s,i)=>{
const d=document.createElement('div');
d.className='radio-item';
d.innerHTML=`<div>${s.name}</div>${s.sub?'<div class="radio-sub">'+s.sub+'</div>':''}`;
d.onclick=()=>{playRadio(i);toggleRadioList()};
rl.appendChild(d);
});

function playRadio(i){
document.querySelectorAll('.radio-item').forEach((el,j)=>{
  el.classList.remove('active','playing');
});
if(RADIO_STATIONS[i].url===null||radioPlaying===i){
  radioPlayer.pause();radioPlayer.src='';
  radioPlaying=-1;
  document.getElementById('radio-btn').textContent='ðŸ“»';
  return;
}
radioPlayer.src=RADIO_STATIONS[i].url;
radioPlayer.volume=0.5;
radioPlayer.play().catch(()=>{});
radioPlaying=i;
document.querySelectorAll('.radio-item')[i].classList.add('active','playing');
document.getElementById('radio-btn').textContent='ðŸ“»';
document.getElementById('radio-btn').style.borderColor='var(--green)';
setTimeout(()=>{document.getElementById('radio-btn').style.borderColor=''},2000);
}

function toggleRadioList(){
document.getElementById('radio-list').classList.toggle('open');
document.getElementById('scene-list').classList.remove('open');
}

document.addEventListener('click',e=>{
if(!e.target.closest('#controls')){
  document.getElementById('scene-list').classList.remove('open');
  document.getElementById('radio-list').classList.remove('open');
}
});

// â”€â”€ WELCOME PANEL AUTO-OPEN â”€â”€
document.addEventListener('DOMContentLoaded',()=>{
  setTimeout(()=>{
    document.getElementById('welcome-panel').style.display='flex';
  },800);
});

// â”€â”€ PAPER TICKER â”€â”€
(function(){
const papers=[
  '#7 GR from Primes',
  '#6 Causal Set Theory',
  '#5 River Velocity GPS',
  '#4 Optical AI Accelerator',
  '#3 Ternary Logic',
  '#2 BEC + Benford\'s Law',
  '#1 Modified Schwarzschild'
];
const tickerEl=document.getElementById('paper-ticker');
const sep=' \u00b7 ';
const full=papers.join(sep)+sep;
tickerEl.innerHTML='<span class="ticker-track"><span>\u25c6</span> '+full+'<span>\u25c6</span> '+full+'</span>';
})();
</script>
</body>
</html>
