<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Schwarzschild Orbit Simulator ‚Äî Riner Research Hub</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../shared.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
.sim-container {
  display: grid;
  grid-template-columns: 300px 1fr;
  gap: 20px;
  margin: 20px 0;
}
@media (max-width: 800px) {
  .sim-container { grid-template-columns: 1fr; }
}
.controls {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 20px;
}
.controls label {
  display: block;
  font-size: 0.85rem;
  color: var(--text-dim);
  margin-top: 12px;
  margin-bottom: 4px;
}
.controls label:first-child { margin-top: 0; }
.controls input[type=range] {
  width: 100%;
  accent-color: var(--accent1);
}
.controls .val {
  font-size: 0.9rem;
  color: var(--accent1);
  font-weight: 600;
  float: right;
}
.controls select, .controls button {
  width: 100%;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid var(--card-border);
  background: var(--bg);
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.9rem;
  cursor: pointer;
  margin-top: 8px;
}
.controls button {
  background: linear-gradient(135deg, var(--accent1), var(--accent2));
  border: none;
  font-weight: 600;
  padding: 10px;
  margin-top: 16px;
  transition: transform 0.2s;
}
.controls button:hover { transform: translateY(-2px); }
.btn-secondary {
  background: var(--card) !important;
  border: 1px solid var(--card-border) !important;
  color: var(--text-dim) !important;
  font-weight: 400 !important;
}
canvas#orbitCanvas {
  background: var(--bg);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  width: 100%;
  aspect-ratio: 1;
  cursor: crosshair;
}
.info-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 10px;
  margin: 16px 0;
}
.info-box {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: 8px;
  padding: 12px 14px;
  text-align: center;
}
.info-box .ib-label { font-size: 0.75rem; color: var(--text-dim); }
.info-box .ib-val { font-size: 1.1rem; font-weight: 700; color: var(--accent1); margin-top: 2px; }
.legend-row {
  display: flex; gap: 20px; justify-content: center; margin: 10px 0;
  font-size: 0.85rem; color: var(--text-dim);
}
.legend-dot {
  display: inline-block; width: 10px; height: 10px; border-radius: 50%;
  margin-right: 6px; vertical-align: middle;
}
.preset-grid {
  display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 8px;
}
.preset-btn {
  padding: 6px 8px !important;
  font-size: 0.8rem !important;
  margin-top: 0 !important;
  background: rgba(99,102,241,0.1) !important;
  border: 1px solid rgba(99,102,241,0.2) !important;
  color: var(--accent1) !important;
}
.preset-btn:hover {
  background: rgba(99,102,241,0.2) !important;
}
.section-title {
  font-size: 0.7rem;
  color: var(--accent2);
  text-transform: uppercase;
  letter-spacing: 0.1em;
  margin-top: 20px;
  margin-bottom: 4px;
  border-top: 1px solid var(--card-border);
  padding-top: 14px;
}
.checkbox-row {
  display: flex; align-items: center; gap: 8px; margin-top: 10px;
  font-size: 0.85rem; color: var(--text-dim);
}
.checkbox-row input { accent-color: var(--accent2); }
.effective-potential {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: 12px;
  padding: 16px;
  margin-top: 16px;
}
.effective-potential canvas { width: 100% !important; height: 250px !important; }
</style>
</head>
<body>
<div class="main">
<a href="../index.html" class="back-link">‚Üê Back to Hub</a>
<header class="header">
  <h1>ü™ê Orbit Simulator</h1>
  <div class="sub">Schwarzschild Geodesics ‚Äî Standard GR vs Œ∂-Modified Metric</div>
</header>

<div class="info-row" id="live-info">
  <div class="info-box"><div class="ib-label">r / r_s</div><div class="ib-val" id="info-r">‚Äî</div></div>
  <div class="info-box"><div class="ib-label">Clock Rate ‚àö(1‚àíŒ≤¬≤)</div><div class="ib-val" id="info-clock">‚Äî</div></div>
  <div class="info-box"><div class="ib-label">Œ∂(s) at r</div><div class="ib-val" id="info-zeta">‚Äî</div></div>
  <div class="info-box"><div class="ib-label">Œ∂ Effect on g_tt</div><div class="ib-val" id="info-gtt">‚Äî</div></div>
  <div class="info-box"><div class="ib-label">Orbits</div><div class="ib-val" id="info-orbits">0</div></div>
  <div class="info-box"><div class="ib-label">Perihelion Shift</div><div class="ib-val" id="info-precess">‚Äî</div></div>
</div>

<div class="legend-row">
  <span><span class="legend-dot" style="background:#6366f1;"></span>Standard GR</span>
  <span><span class="legend-dot" style="background:#22c55e;"></span>Œ∂-Modified</span>
  <span><span class="legend-dot" style="background:#f59e0b;"></span>Event Horizon</span>
  <span><span class="legend-dot" style="background:#ec4899;"></span>Photon Sphere (1.5 r_s)</span>
</div>

<div class="sim-container">
  <div class="controls">
    <label>Initial r / r_s <span class="val" id="v-r0">10</span></label>
    <input type="range" id="r0" min="2.5" max="50" step="0.1" value="10">

    <label>Angular Momentum L/m <span class="val" id="v-L">4.0</span></label>
    <input type="range" id="L" min="2" max="8" step="0.05" value="4.0">

    <label>Radial Velocity dr/dœÑ <span class="val" id="v-vr">0.00</span></label>
    <input type="range" id="vr" min="-0.3" max="0.3" step="0.005" value="0">

    <label>Black Hole Mass (M‚òâ) <span class="val" id="v-M">10</span></label>
    <input type="range" id="M" min="1" max="100" step="1" value="10">

    <div class="section-title">Œ∂-Modified Metric</div>
    <div class="checkbox-row">
      <input type="checkbox" id="showZeta" checked>
      <label for="showZeta" style="margin:0;">Show Œ∂-modified orbit</label>
    </div>
    <label>Œ∂ Strength <span class="val" id="v-zetaStr">1.00</span></label>
    <input type="range" id="zetaStr" min="0" max="3" step="0.05" value="1.0">

    <div class="section-title">Simulation</div>
    <label>Speed <span class="val" id="v-speed">1x</span></label>
    <input type="range" id="speed" min="1" max="20" step="1" value="5">

    <label>Trail Length <span class="val" id="v-trail">2000</span></label>
    <input type="range" id="trail" min="200" max="10000" step="100" value="2000">

    <button id="btn-start">‚ñ∂ Start Simulation</button>
    <button id="btn-reset" class="btn-secondary">‚Ü∫ Reset</button>

    <div class="section-title">Presets</div>
    <div class="preset-grid">
      <button class="preset-btn" data-preset="stable">Stable Orbit</button>
      <button class="preset-btn" data-preset="precess">Precessing</button>
      <button class="preset-btn" data-preset="plunge">Plunge</button>
      <button class="preset-btn" data-preset="scatter">Scatter</button>
      <button class="preset-btn" data-preset="isco">ISCO</button>
      <button class="preset-btn" data-preset="near-horizon">Near Horizon</button>
    </div>
  </div>

  <div>
    <canvas id="orbitCanvas"></canvas>
  </div>
</div>

<!-- Effective Potential Plot -->
<div class="effective-potential">
  <h3 style="font-size:1rem;color:var(--text);margin-bottom:10px;">Effective Potential V_eff(r)</h3>
  <canvas id="potentialChart"></canvas>
</div>

<!-- Explanation -->
<div style="background:var(--card);border:1px solid var(--card-border);border-radius:12px;padding:24px;margin-top:20px;line-height:1.9;">
  <h3 style="color:var(--text);margin-bottom:10px;">How This Works</h3>
  <p style="color:var(--text-dim);font-size:0.9rem;">
    This simulator integrates the geodesic equation in Schwarzschild spacetime using the effective potential formalism.
    The <strong style="color:var(--accent1);">blue orbit</strong> follows standard GR.
    The <strong style="color:var(--green);">green orbit</strong> includes CJ's Œ∂-modification:
  </p>
  <div style="background:var(--bg);border-radius:8px;padding:16px;margin:12px 0;font-size:0.95rem;color:var(--accent2);text-align:center;line-height:2;">
    g_tt = ‚àí(1 ‚àí r_s/r) ¬∑ Œ∂(s(r))<br>
    where s(r) = floor(r/r_s ¬∑ 10¬≤‚Å∂) and Œ∂(s) = Œ£ 1/n^s<br>
    Œ≤ = ‚àö(r_s/r), &nbsp; Clock Rate = ‚àö(1 ‚àí Œ≤¬≤)
  </p>
  <p style="color:var(--text-dim);font-size:0.9rem;margin-top:10px;">
    Far from the black hole, Œ∂ ‚âà 1 and both orbits match.
    Near the horizon, Œ∂ diverges ‚Äî the prime modification resists time stopping.
    Watch the green orbit deviate near perihelion!
  </p>
</div>

</div>

<script>
// ============================================================
// Schwarzschild Orbit Simulator with Œ∂-modification
// ============================================================
(function() {
  const $ = id => document.getElementById(id);

  // --- Zeta function (truncated Riemann zeta for real s > 1) ---
  function zeta(s) {
    if (s <= 1) return 1e6; // pole
    let sum = 0;
    for (let n = 1; n <= 500; n++) sum += 1 / Math.pow(n, s);
    return sum;
  }

  // s(r) mapping: maps r/r_s to a zeta argument
  // Near horizon (r‚Üír_s): s‚Üí1 (zeta diverges)
  // Far away (r‚Üí‚àû): s‚Üí‚àû (zeta‚Üí1)
  function sOfR(rOverRs) {
    // s = 1 + (r/r_s - 1) mapped to useful range
    // At r=r_s: s=1 (pole), At r=2r_s: s=2, At r=10r_s: s=10
    return Math.max(1.001, rOverRs);
  }

  // --- Effective potential ---
  function Veff(rRs, L) {
    // V_eff = (1 - 1/r)(1 + L¬≤/r¬≤) in units where r_s=1, c=1
    const r = rRs;
    return (1 - 1/r) * (1 + L*L/(r*r));
  }

  function VeffZeta(rRs, L, zetaStr) {
    const r = rRs;
    const s = sOfR(r);
    const z = 1 + (zeta(s) - 1) * zetaStr;
    return (1 - 1/r) * z * (1 + L*L/(r*r));
  }

  // --- Geodesic integration (Verlet/leapfrog in r,œÜ) ---
  // Using effective potential: (dr/dœÑ)¬≤ = E¬≤ - V_eff(r)
  // œÜÃá = L/r¬≤
  // rÃà = -dV_eff/dr / 2  (from energy equation)

  function dVeffDr(r, L) {
    const eps = 1e-6;
    return (Veff(r + eps, L) - Veff(r - eps, L)) / (2 * eps);
  }

  function dVeffDrZeta(r, L, zetaStr) {
    const eps = 1e-6;
    return (VeffZeta(r + eps, L, zetaStr) - VeffZeta(r - eps, L, zetaStr)) / (2 * eps);
  }

  // --- State ---
  let running = false;
  let animId = null;
  let grState, zetaState;
  let grTrail = [], zetaTrail = [];
  let orbitCount = 0, lastAngle = 0;
  let perihelions = [];

  const canvas = $('orbitCanvas');
  const ctx = canvas.getContext('2d');

  function resize() {
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * window.devicePixelRatio;
    canvas.height = rect.height * window.devicePixelRatio;
    ctx.setTransform(window.devicePixelRatio, 0, 0, window.devicePixelRatio, 0, 0);
  }
  window.addEventListener('resize', resize);
  resize();

  // Slider updates
  const sliders = ['r0','L','vr','M','speed','trail','zetaStr'];
  sliders.forEach(id => {
    $(id).addEventListener('input', () => {
      const v = parseFloat($(id).value);
      const el = $('v-' + id);
      if (id === 'speed') el.textContent = v + 'x';
      else if (id === 'trail') el.textContent = v;
      else el.textContent = v.toFixed(id === 'r0' ? 1 : 2);
      updatePotentialChart();
    });
  });

  // --- Presets ---
  const presets = {
    stable:       { r0: 10,  L: 4.0,  vr: 0,    M: 10 },
    precess:      { r0: 6,   L: 3.8,  vr: 0,    M: 10 },
    plunge:       { r0: 4,   L: 3.0,  vr: -0.1, M: 10 },
    scatter:      { r0: 20,  L: 4.5,  vr: -0.15,M: 10 },
    isco:         { r0: 3,   L: 3.46, vr: 0,    M: 10 },
    'near-horizon': { r0: 2.5, L: 3.8, vr: 0,   M: 10 },
  };
  document.querySelectorAll('.preset-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const p = presets[btn.dataset.preset];
      if (!p) return;
      Object.entries(p).forEach(([k, v]) => {
        $(k).value = v;
        $(k).dispatchEvent(new Event('input'));
      });
      resetSim();
    });
  });

  // --- Init state ---
  function initState() {
    const r0 = parseFloat($('r0').value);
    const vr = parseFloat($('vr').value);
    const phi = 0;
    return { r: r0, vr: vr, phi: phi };
  }

  function resetSim() {
    running = false;
    if (animId) cancelAnimationFrame(animId);
    animId = null;
    grState = initState();
    zetaState = initState();
    grTrail = [];
    zetaTrail = [];
    orbitCount = 0;
    lastAngle = 0;
    perihelions = [];
    $('btn-start').textContent = '‚ñ∂ Start Simulation';
    updateInfo(grState, zetaState);
    draw();
    updatePotentialChart();
  }

  $('btn-reset').addEventListener('click', resetSim);
  $('btn-start').addEventListener('click', () => {
    if (running) {
      running = false;
      $('btn-start').textContent = '‚ñ∂ Start Simulation';
    } else {
      running = true;
      $('btn-start').textContent = '‚è∏ Pause';
      if (!grState) resetSim();
      running = true;
      animate();
    }
  });

  // --- Integration step ---
  function step(state, useZeta) {
    const L = parseFloat($('L').value);
    const zetaStr = parseFloat($('zetaStr').value);
    const dt = 0.002;

    const dvdr = useZeta ? dVeffDrZeta(state.r, L, zetaStr) : dVeffDr(state.r, L);

    // Leapfrog
    const ar = -dvdr / 2;
    state.vr += ar * dt;
    state.r += state.vr * dt;
    state.phi += (L / (state.r * state.r)) * dt;

    // Capture/crash detection
    if (state.r < 1.01) {
      state.r = 1.01;
      state.vr = 0;
    }

    return state;
  }

  // --- Drawing ---
  function toScreen(r, phi) {
    const w = canvas.getBoundingClientRect().width;
    const h = canvas.getBoundingClientRect().height;
    const scale = Math.min(w, h) / (parseFloat($('r0').value) * 3.5);
    const cx = w / 2, cy = h / 2;
    return {
      x: cx + r * Math.cos(phi) * scale,
      y: cy - r * Math.sin(phi) * scale
    };
  }

  function draw() {
    const w = canvas.getBoundingClientRect().width;
    const h = canvas.getBoundingClientRect().height;
    ctx.clearRect(0, 0, w, h);

    const scale = Math.min(w, h) / (parseFloat($('r0').value) * 3.5);
    const cx = w / 2, cy = h / 2;

    // Grid circles
    ctx.strokeStyle = 'rgba(100,100,160,0.15)';
    ctx.lineWidth = 1;
    for (let rg = 5; rg <= 50; rg += 5) {
      ctx.beginPath();
      ctx.arc(cx, cy, rg * scale, 0, Math.PI * 2);
      ctx.stroke();
    }

    // Event horizon (r_s = 1 in our units)
    ctx.strokeStyle = '#f59e0b';
    ctx.lineWidth = 2;
    ctx.setLineDash([6, 4]);
    ctx.beginPath();
    ctx.arc(cx, cy, 1 * scale, 0, Math.PI * 2);
    ctx.stroke();

    // Photon sphere at 1.5 r_s
    ctx.strokeStyle = '#ec4899';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.arc(cx, cy, 1.5 * scale, 0, Math.PI * 2);
    ctx.stroke();
    ctx.setLineDash([]);

    // Black hole fill
    ctx.fillStyle = '#000';
    ctx.beginPath();
    ctx.arc(cx, cy, 1 * scale, 0, Math.PI * 2);
    ctx.fill();
    // Glow
    const grad = ctx.createRadialGradient(cx, cy, 0.5 * scale, cx, cy, 2 * scale);
    grad.addColorStop(0, 'rgba(245,158,11,0.3)');
    grad.addColorStop(1, 'rgba(245,158,11,0)');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(cx, cy, 2 * scale, 0, Math.PI * 2);
    ctx.fill();

    // Trails
    const maxTrail = parseInt($('trail').value);

    function drawTrail(trail, color) {
      if (trail.length < 2) return;
      const start = Math.max(0, trail.length - maxTrail);
      for (let i = start + 1; i < trail.length; i++) {
        const alpha = (i - start) / (trail.length - start);
        ctx.strokeStyle = color.replace('1)', alpha * 0.8 + ')');
        ctx.lineWidth = 1.5;
        ctx.beginPath();
        const p0 = toScreen(trail[i-1].r, trail[i-1].phi);
        const p1 = toScreen(trail[i].r, trail[i].phi);
        ctx.moveTo(p0.x, p0.y);
        ctx.lineTo(p1.x, p1.y);
        ctx.stroke();
      }
    }

    drawTrail(grTrail, 'rgba(99,102,241,1)');
    if ($('showZeta').checked) {
      drawTrail(zetaTrail, 'rgba(34,197,94,1)');
    }

    // Current positions
    if (grState) {
      const p = toScreen(grState.r, grState.phi);
      ctx.fillStyle = '#6366f1';
      ctx.beginPath();
      ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
      ctx.fill();
      // glow
      ctx.fillStyle = 'rgba(99,102,241,0.3)';
      ctx.beginPath();
      ctx.arc(p.x, p.y, 10, 0, Math.PI * 2);
      ctx.fill();
    }
    if (zetaState && $('showZeta').checked) {
      const p = toScreen(zetaState.r, zetaState.phi);
      ctx.fillStyle = '#22c55e';
      ctx.beginPath();
      ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'rgba(34,197,94,0.3)';
      ctx.beginPath();
      ctx.arc(p.x, p.y, 10, 0, Math.PI * 2);
      ctx.fill();
    }

    // Labels
    ctx.font = '11px JetBrains Mono';
    ctx.fillStyle = '#f59e0b';
    ctx.fillText('r_s', cx + 1 * scale + 4, cy - 4);
    ctx.fillStyle = '#ec4899';
    ctx.fillText('1.5 r_s', cx + 1.5 * scale + 4, cy + 12);
  }

  // --- Info panel ---
  function updateInfo(gr, zs) {
    if (!gr) return;
    const r = gr.r;
    const beta = Math.sqrt(1 / r);
    const clockRate = Math.sqrt(1 - 1/r);
    const s = sOfR(r);
    const z = zeta(s);
    const zetaStr = parseFloat($('zetaStr').value);
    const gttMod = (1 - 1/r) * (1 + (z - 1) * zetaStr);

    $('info-r').textContent = r.toFixed(2);
    $('info-clock').textContent = isNaN(clockRate) ? '0' : clockRate.toFixed(6);
    $('info-zeta').textContent = z.toFixed(4);
    $('info-gtt').textContent = gttMod.toFixed(6);
    $('info-orbits').textContent = orbitCount;

    if (perihelions.length >= 2) {
      const lastTwo = perihelions.slice(-2);
      const shift = (lastTwo[1] - lastTwo[0] - 2 * Math.PI) * (180 / Math.PI) * 3600; // arcsec
      $('info-precess').textContent = shift.toFixed(1) + '‚Ä≥';
    }
  }

  // --- Animation ---
  function animate() {
    if (!running) return;
    const spd = parseInt($('speed').value);
    const L = parseFloat($('L').value);

    for (let i = 0; i < spd * 5; i++) {
      const prevR = grState.r;
      const prevVr = grState.vr;

      step(grState, false);
      if ($('showZeta').checked) step(zetaState, true);

      grTrail.push({ r: grState.r, phi: grState.phi });
      if ($('showZeta').checked) zetaTrail.push({ r: zetaState.r, phi: zetaState.phi });

      // Detect orbit completion & perihelion
      const newAngle = grState.phi % (2 * Math.PI);
      if (newAngle < lastAngle && grState.phi > Math.PI) {
        orbitCount++;
      }
      lastAngle = newAngle;

      // Perihelion detection (vr crosses zero from negative to positive)
      if (prevVr < 0 && grState.vr >= 0) {
        perihelions.push(grState.phi);
      }
    }

    updateInfo(grState, zetaState);
    draw();
    animId = requestAnimationFrame(animate);
  }

  // --- Effective Potential Chart ---
  let potChart = null;
  function updatePotentialChart() {
    const L = parseFloat($('L').value);
    const zetaStr = parseFloat($('zetaStr').value);
    const r0 = parseFloat($('r0').value);
    const showZ = $('showZeta').checked;

    const rVals = [];
    const vGR = [];
    const vZ = [];
    for (let r = 1.1; r <= Math.max(r0 * 2, 25); r += 0.1) {
      rVals.push(r.toFixed(1));
      vGR.push(Veff(r, L));
      if (showZ) vZ.push(VeffZeta(r, L, zetaStr));
    }

    // Energy line from initial conditions
    const vr0 = parseFloat($('vr').value);
    const E2 = vr0 * vr0 + Veff(r0, L);

    const datasets = [
      {
        label: 'V_eff (GR)',
        data: vGR,
        borderColor: '#6366f1',
        borderWidth: 2,
        pointRadius: 0,
        fill: false,
      },
      {
        label: 'E¬≤ (energy)',
        data: rVals.map(() => E2),
        borderColor: 'rgba(245,158,11,0.6)',
        borderWidth: 1,
        borderDash: [5, 5],
        pointRadius: 0,
        fill: false,
      },
    ];
    if (showZ) {
      datasets.splice(1, 0, {
        label: 'V_eff (Œ∂)',
        data: vZ,
        borderColor: '#22c55e',
        borderWidth: 2,
        pointRadius: 0,
        fill: false,
      });
    }

    if (potChart) potChart.destroy();
    potChart = new Chart($('potentialChart'), {
      type: 'line',
      data: { labels: rVals, datasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        animation: false,
        scales: {
          x: {
            title: { display: true, text: 'r / r_s', color: '#8888aa' },
            ticks: { color: '#8888aa', maxTicksLimit: 10 },
            grid: { color: 'rgba(100,100,160,0.1)' },
          },
          y: {
            title: { display: true, text: 'V_eff', color: '#8888aa' },
            ticks: { color: '#8888aa' },
            grid: { color: 'rgba(100,100,160,0.1)' },
            min: 0.8,
            max: Math.min(E2 * 1.5, 2.5),
          }
        },
        plugins: {
          legend: { labels: { color: '#8888aa', font: { family: 'JetBrains Mono' } } },
        }
      }
    });
  }

  // Init
  resetSim();
  updatePotentialChart();
  $('showZeta').addEventListener('change', () => { updatePotentialChart(); draw(); });
})();
</script>
</body>
</html>
