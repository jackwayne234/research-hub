<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lesson 16: Acids &amp; Bases II</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#1e2128;--bg-card:#262a33;--bg-card-hover:#2c313c;--bg-input:#1a1d24;--border:#363b47;--text:#e2e4e9;--text-dim:#9ca3af;--text-bright:#fff;--indigo:#6366f1;--indigo-dim:rgba(99,102,241,.15);--green:#22c55e;--green-dim:rgba(34,197,94,.15);--pink:#ec4899;--pink-dim:rgba(236,72,153,.15);--amber:#f59e0b;--amber-dim:rgba(245,158,11,.15);--radius:10px;--transition:0.3s cubic-bezier(.4,0,.2,1)}
html{scroll-behavior:smooth}
body{font-family:'JetBrains Mono',monospace;background:var(--bg);color:var(--text);line-height:1.7;min-height:100vh;padding:0}
.top-bar{position:sticky;top:0;z-index:100;background:rgba(30,33,40,.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:16px 24px}
.top-bar h1{font-size:1.1rem;font-weight:600;color:var(--text-bright);margin-bottom:10px;letter-spacing:-.02em}
.top-bar h1 span{color:var(--indigo)}
.progress-track{width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--indigo),#818cf8);border-radius:3px;transition:width .5s ease}
.progress-label{font-size:.7rem;color:var(--text-dim);margin-top:6px;text-align:right}
.content{max-width:900px;margin:0 auto;padding:24px}
.section-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:20px;overflow:hidden;transition:border-color var(--transition)}
.section-card.completed{border-color:var(--green)}
.section-header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;cursor:pointer;user-select:none;transition:background var(--transition)}
.section-header:hover{background:var(--bg-card-hover)}
.section-header h2{font-size:.95rem;font-weight:600;color:var(--text-bright);display:flex;align-items:center;gap:10px}
.section-num{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;background:var(--indigo-dim);color:var(--indigo);font-size:.75rem;font-weight:700;flex-shrink:0}
.chevron{width:20px;height:20px;color:var(--text-dim);transition:transform .4s cubic-bezier(.34,1.56,.64,1);flex-shrink:0}
.section-card.open .chevron{transform:rotate(180deg)}
.section-body{max-height:0;overflow:hidden;transition:max-height .5s cubic-bezier(.4,0,.2,1)}
.section-card.open .section-body{max-height:80000px}
.section-inner{padding:0 22px 22px}
.concept-text{font-size:.82rem;color:var(--text);margin-bottom:16px;line-height:1.8}
.concept-text strong{color:var(--text-bright)}
.formula-box{background:var(--indigo-dim);border:1px solid rgba(99,102,241,.3);border-radius:var(--radius);padding:16px 20px;margin:16px 0;text-align:center;font-size:1rem;color:var(--indigo);font-weight:600}
.formula-box.large{font-size:1.2rem;padding:20px 24px;letter-spacing:.02em}
.formula-box.green{background:var(--green-dim);border-color:rgba(34,197,94,.3);color:var(--green)}
.formula-box.pink{background:var(--pink-dim);border-color:rgba(236,72,153,.3);color:var(--pink)}
.formula-box.amber{background:var(--amber-dim);border-color:rgba(245,158,11,.3);color:var(--amber)}
.key-point{background:var(--amber-dim);border-left:3px solid var(--amber);border-radius:0 var(--radius) var(--radius) 0;padding:12px 16px;margin:14px 0;font-size:.78rem;color:var(--amber)}
.key-point strong{color:var(--amber);font-weight:700}
.navy-context{background:rgba(99,102,241,.08);border:1px solid rgba(99,102,241,.2);border-radius:var(--radius);padding:12px 16px;margin:14px 0;font-size:.76rem;color:var(--text-dim)}
.navy-context strong{color:var(--indigo)}
.interactive-area{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin:16px 0}
.interactive-label{font-size:.7rem;color:var(--indigo);text-transform:uppercase;letter-spacing:.08em;margin-bottom:12px;font-weight:600}
.readout{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
.readout-item{background:var(--bg-card);border:1px solid var(--border);border-radius:6px;padding:8px 14px;font-size:.75rem}
.readout-item .label{color:var(--text-dim);font-size:.65rem}
.readout-item .value{color:var(--text-bright);font-weight:600}
.readout-item .value.green{color:var(--green)}
.readout-item .value.pink{color:var(--pink)}
.readout-item .value.amber{color:var(--amber)}
.readout-item .value.indigo{color:var(--indigo)}
.slider-row{display:flex;align-items:center;gap:12px;margin:8px 0}
.slider-row label{font-size:.7rem;color:var(--text-dim);min-width:130px;flex-shrink:0}
.slider-row input[type="range"]{flex:1}
.slider-row .slider-val{font-size:.75rem;color:var(--text-bright);font-weight:600;min-width:70px;text-align:right}
input[type="range"]{-webkit-appearance:none;width:100%;height:6px;background:var(--border);border-radius:3px;outline:none;margin:4px 0}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--indigo);cursor:pointer;border:2px solid var(--text-bright)}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.72rem;cursor:pointer;transition:var(--transition);user-select:none}
.btn:hover{background:var(--bg-card-hover);border-color:var(--indigo);color:var(--text-bright)}
.btn-primary{background:var(--indigo);border-color:var(--indigo);color:#fff}
.btn-primary:hover{background:#5558e6}
.btn-sm{padding:6px 12px;font-size:.68rem}
.feedback{font-size:.75rem;margin-top:8px;padding:8px 12px;border-radius:6px;display:none}
.feedback.correct{display:block;background:var(--green-dim);color:var(--green);border:1px solid rgba(34,197,94,.3)}
.feedback.incorrect{display:block;background:var(--pink-dim);color:var(--pink);border:1px solid rgba(236,72,153,.3)}
.practice-block{margin-top:20px;border-top:1px solid var(--border);padding-top:16px}
.practice-title{font-size:.8rem;font-weight:600;color:var(--amber);margin-bottom:14px}
.problem{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:12px}
.problem p{font-size:.78rem;margin-bottom:10px;line-height:1.7}
.problem-input-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.problem input[type="text"],.problem input[type="number"]{background:var(--bg-card);border:1px solid var(--border);border-radius:6px;padding:8px 12px;color:var(--text-bright);font-family:'JetBrains Mono',monospace;font-size:.78rem;width:120px;outline:none;transition:border-color var(--transition)}
.problem input:focus{border-color:var(--indigo)}
.mc-choices{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.mc-btn{text-align:left;padding:8px 12px;font-size:.74rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);cursor:pointer;transition:var(--transition);font-family:'JetBrains Mono',monospace}
.mc-btn:hover{border-color:var(--indigo);background:var(--bg-card-hover)}
.mc-btn.correct{border-color:var(--green);background:var(--green-dim);color:var(--green);pointer-events:none}
.mc-btn.wrong{border-color:var(--pink);background:var(--pink-dim);color:var(--pink);pointer-events:none}
.mc-btn.disabled{pointer-events:none;opacity:.6}
.sub-label{font-size:.7rem;color:var(--text-dim);margin:10px 0 4px}
.quiz-score{background:var(--indigo-dim);border:1px solid rgba(99,102,241,.3);border-radius:var(--radius);padding:14px 20px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.quiz-score .score-text{font-size:.85rem;color:var(--text-bright);font-weight:600}
.quiz-q{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px}
.quiz-q .q-num{font-size:.65rem;color:var(--indigo);font-weight:600;text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px}
.quiz-q .q-text{font-size:.78rem;margin-bottom:12px;line-height:1.7}
.quiz-q .choices{display:flex;flex-direction:column;gap:8px}
.quiz-q .choice-btn{text-align:left;padding:10px 14px;font-size:.76rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);cursor:pointer;transition:var(--transition);font-family:'JetBrains Mono',monospace;width:100%}
.quiz-q .choice-btn:hover{border-color:var(--indigo);background:var(--bg-card-hover)}
.quiz-q .choice-btn.selected-correct{border-color:var(--green);background:var(--green-dim);color:var(--green)}
.quiz-q .choice-btn.selected-wrong{border-color:var(--pink);background:var(--pink-dim);color:var(--pink)}
.quiz-q .choice-btn.reveal-correct{border-color:var(--green);background:var(--green-dim);color:var(--green)}
.quiz-q .choice-btn.disabled{pointer-events:none;opacity:.7}
.rule-table{width:100%;border-collapse:collapse;margin:14px 0;font-size:.74rem}
.rule-table th{background:var(--indigo-dim);color:var(--indigo);padding:10px 12px;text-align:left;border:1px solid var(--border);font-weight:600}
.rule-table td{padding:8px 12px;border:1px solid var(--border);color:var(--text)}
.rule-table tr:nth-child(even) td{background:rgba(255,255,255,.02)}
.step-list{list-style:none;counter-reset:step;margin:12px 0}
.step-list li{counter-increment:step;padding:8px 0 8px 36px;font-size:.78rem;position:relative;border-bottom:1px solid var(--border)}
.step-list li:last-child{border-bottom:none}
.step-list li::before{content:counter(step);position:absolute;left:0;top:8px;width:24px;height:24px;border-radius:50%;background:var(--indigo-dim);color:var(--indigo);display:flex;align-items:center;justify-content:center;font-size:.68rem;font-weight:700}
.ph-bar{height:20px;border-radius:4px;background:linear-gradient(90deg,#ef4444,#f97316,#eab308,#22c55e,#06b6d4,#6366f1,#8b5cf6);margin:10px 0;position:relative;border:1px solid var(--border)}
.ph-marker{position:absolute;top:-6px;width:3px;height:32px;background:var(--text-bright);border-radius:2px;transition:left .3s ease;box-shadow:0 0 6px rgba(255,255,255,.5)}
.ph-label{position:absolute;top:26px;transform:translateX(-50%);font-size:.65rem;color:var(--text-bright);font-weight:600;white-space:nowrap}
svg text{font-family:'JetBrains Mono',monospace}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin:14px 0}
.info-card{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:12px 14px}
.info-card .ic-title{font-size:.7rem;font-weight:600;color:var(--indigo);margin-bottom:6px;text-transform:uppercase;letter-spacing:.06em}
.info-card p{font-size:.75rem;line-height:1.7;color:var(--text)}
.scenario-tabs{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.scenario-tab{padding:6px 14px;font-size:.7rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text-dim);cursor:pointer;transition:var(--transition);font-family:'JetBrains Mono',monospace}
.scenario-tab:hover{border-color:var(--indigo)}
.scenario-tab.active{border-color:var(--indigo);background:var(--indigo-dim);color:var(--indigo)}
.indicator-swatch{display:inline-block;width:18px;height:18px;border-radius:4px;vertical-align:middle;margin-right:6px;border:1px solid rgba(255,255,255,.15)}
@keyframes popCorrect{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
@keyframes shakeWrong{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
.pop{animation:popCorrect .35s cubic-bezier(.34,1.56,.64,1)}
.shake{animation:shakeWrong .4s ease}
@media(max-width:640px){.content{padding:16px}.section-header{padding:14px 16px}.section-inner{padding:0 16px 16px}.slider-row label{min-width:90px}.readout{gap:8px}.readout-item{padding:6px 10px;font-size:.7rem}.two-col{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="top-bar">
  <h1><span>16</span> Acids &amp; Bases II — Buffers, Henderson-Hasselbalch &amp; Titrations</h1>
  <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
  <div class="progress-label" id="progressLabel">0 / 8 sections</div>
</div>

<div class="content" id="contentArea">

<!-- ============================================================ -->
<!-- SECTION 1: BUFFER SOLUTIONS -->
<!-- ============================================================ -->
<div class="section-card open" data-section="1">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">1</span> Buffer Solutions</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      A <strong>buffer</strong> is a solution that resists changes in pH when small amounts of strong acid or strong base are added. Buffers are critical in chemistry, biology, and engineering — without them, even tiny acid inputs would cause catastrophic pH swings.
    </p>

    <p class="concept-text">
      Buffers are made from one of two combinations:<br>
      &bull; A <strong>weak acid</strong> (HA) + its <strong>conjugate base</strong> (A&minus;) — the most common type.<br>
      &bull; A <strong>weak base</strong> (B) + its <strong>conjugate acid</strong> (BH&plus;) — less common but same principle.
    </p>

    <div class="formula-box large">Buffer = Weak Acid + Conjugate Base<br><span style="font-size:.75rem;opacity:.7">e.g., CH&#x2083;COOH / CH&#x2083;COO&minus; &nbsp;|&nbsp; H&#x2082;CO&#x2083; / HCO&#x2083;&minus;</span></div>

    <p class="concept-text">
      <strong>How buffers resist pH change</strong><br>
      When strong acid (H&plus;) is added: the conjugate base (A&minus;) consumes it.<br>
      &nbsp;&nbsp;A&minus; + H&plus; &rarr; HA<br><br>
      When strong base (OH&minus;) is added: the weak acid (HA) neutralizes it.<br>
      &nbsp;&nbsp;HA + OH&minus; &rarr; A&minus; + H&#x2082;O<br><br>
      In both cases, the strong acid/base is replaced by the weak acid/base, causing only a tiny pH shift.
    </p>

    <div class="two-col">
      <div class="info-card">
        <div class="ic-title">Buffer Capacity</div>
        <p>The amount of acid or base a buffer can absorb before the pH changes significantly. Capacity increases with higher concentrations of both HA and A&minus;. A buffer is most effective when both components are present in high concentrations.</p>
      </div>
      <div class="info-card">
        <div class="ic-title">Buffer Range</div>
        <p>Buffers work best when pH is within &plusmn;1 unit of the weak acid pK&#x2090;. Outside this range, one component is nearly depleted and the buffer can no longer resist pH change effectively. Buffer range: <strong>pK&#x2090; &minus;1 to pK&#x2090; +1</strong></p>
      </div>
    </div>

    <div class="key-point"><strong>Rule of thumb:</strong> A buffer fails when the ratio [A&minus;]/[HA] falls below 0.1 or rises above 10. At those extremes, you've essentially run out of one reservoir.</div>

    <div class="navy-context">
      <strong>Navy context:</strong> Blood is a bicarbonate buffer (H&#x2082;CO&#x2083; / HCO&#x2083;&minus;, pK&#x2090; = 6.1, physiological pH = 7.4). A sailor's lungs regulate CO&#x2082; to keep this ratio at ~20:1. In combat casualty care, understanding this buffer is essential — acidosis from blood loss shifts the ratio catastrophically. Ship pool water also uses a carbonate/bicarbonate system to maintain pH 7.2–7.8 to prevent corrosion of heat exchangers.
    </div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Buffer Action Visualizer</div>
      <p style="font-size:.76rem;color:var(--text-dim);margin-bottom:12px">An acetate buffer: 0.10 M CH&#x2083;COOH / 0.10 M CH&#x2083;COO&minus; (pK&#x2090; = 4.74). Add strong acid or base and watch pH.</p>
      <div class="slider-row">
        <label>Strong acid added (mol)</label>
        <input type="range" id="bufAcid" min="0" max="0.09" step="0.001" value="0" oninput="updateBuffer()">
        <span class="slider-val" id="bufAcidVal">0.000 mol</span>
      </div>
      <div class="slider-row">
        <label>Strong base added (mol)</label>
        <input type="range" id="bufBase" min="0" max="0.09" step="0.001" value="0" oninput="updateBuffer()">
        <span class="slider-val" id="bufBaseVal">0.000 mol</span>
      </div>
      <div class="ph-bar" id="bufPhBar" style="margin-top:16px">
        <div class="ph-marker" id="bufPhMarker" style="left:37%"></div>
        <div class="ph-label" id="bufPhLabel" style="left:37%">pH 4.74</div>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:.62rem;color:var(--text-dim);margin-top:32px;padding:0 2px">
        <span>0</span><span>2</span><span>4</span><span>6</span><span>8</span><span>10</span><span>12</span><span>14</span>
      </div>
      <div class="readout">
        <div class="readout-item"><span class="label">[HA] remaining</span><br><span class="value amber" id="bufHA">0.100 M</span></div>
        <div class="readout-item"><span class="label">[A&minus;] remaining</span><br><span class="value indigo" id="bufAminus">0.100 M</span></div>
        <div class="readout-item"><span class="label">pH</span><br><span class="value green" id="bufPH">4.74</span></div>
        <div class="readout-item"><span class="label">Status</span><br><span class="value" id="bufStatus">Buffering</span></div>
      </div>
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 2: HENDERSON-HASSELBALCH -->
<!-- ============================================================ -->
<div class="section-card" data-section="2">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">2</span> Henderson-Hasselbalch Equation</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      The <strong>Henderson-Hasselbalch (H-H) equation</strong> is derived directly from the K&#x2090; expression for a weak acid. It gives us a fast way to calculate the pH of a buffer without solving a full ICE table.
    </p>

    <p class="concept-text">Starting from K&#x2090; = [H&plus;][A&minus;] / [HA], take &minus;log of both sides:</p>

    <div class="formula-box large">pH = pK&#x2090; + log([A&minus;] / [HA])</div>

    <p class="concept-text">
      <strong>Key insights from the equation:</strong><br>
      &bull; When [A&minus;] = [HA], the ratio is 1, log(1) = 0, so <strong>pH = pK&#x2090;</strong>.<br>
      &bull; When [A&minus;] &gt; [HA], log is positive, pH &gt; pK&#x2090; (more basic).<br>
      &bull; When [A&minus;] &lt; [HA], log is negative, pH &lt; pK&#x2090; (more acidic).<br>
      &bull; Every 10x change in ratio shifts pH by exactly 1 unit.
    </p>

    <div class="formula-box green">[A&minus;] = [HA] &rArr; pH = pK&#x2090; &nbsp;|&nbsp; [A&minus;] = 10[HA] &rArr; pH = pK&#x2090; + 1 &nbsp;|&nbsp; [HA] = 10[A&minus;] &rArr; pH = pK&#x2090; &minus; 1</div>

    <div class="key-point"><strong>Assumption check:</strong> H-H assumes [A&minus;] and [HA] are large enough that the equilibrium shift is negligible. It works well when both concentrations are &ge;0.01 M and the ratio is between 0.1 and 10.</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Henderson-Hasselbalch Calculator</div>
      <p style="font-size:.76rem;color:var(--text-dim);margin-bottom:12px">Adjust pK&#x2090; and the concentration ratio to see how pH changes in real time.</p>
      <div class="slider-row">
        <label>pK&#x2090; of weak acid</label>
        <input type="range" id="hhPka" min="2" max="12" step="0.1" value="4.74" oninput="updateHH()">
        <span class="slider-val" id="hhPkaVal">4.74</span>
      </div>
      <div class="slider-row">
        <label>[A&minus;] / [HA] ratio</label>
        <input type="range" id="hhRatio" min="-20" max="20" step="1" value="0" oninput="updateHH()">
        <span class="slider-val" id="hhRatioVal">1.00</span>
      </div>
      <div class="ph-bar" style="margin-top:16px">
        <div class="ph-marker" id="hhPhMarker" style="left:33.9%"></div>
        <div class="ph-label" id="hhPhLabel" style="left:33.9%">pH 4.74</div>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:.62rem;color:var(--text-dim);margin-top:32px;padding:0 2px">
        <span>0</span><span>2</span><span>4</span><span>6</span><span>8</span><span>10</span><span>12</span><span>14</span>
      </div>
      <div class="readout">
        <div class="readout-item"><span class="label">pK&#x2090;</span><br><span class="value indigo" id="hhPkaDisplay">4.74</span></div>
        <div class="readout-item"><span class="label">log([A&minus;]/[HA])</span><br><span class="value amber" id="hhLogDisplay">0.00</span></div>
        <div class="readout-item"><span class="label">pH</span><br><span class="value green" id="hhPhDisplay">4.74</span></div>
        <div class="readout-item"><span class="label">Ratio</span><br><span class="value" id="hhRatioDisplay">1.00 : 1</span></div>
      </div>
      <p style="font-size:.72rem;color:var(--text-dim);margin-top:12px">Equation: pH = <span id="hhEqPka" style="color:var(--indigo)">4.74</span> + log(<span id="hhEqRatio" style="color:var(--amber)">1.00</span>) = <span id="hhEqResult" style="color:var(--green);font-weight:600">4.74</span></p>
    </div>

    <div class="navy-context">
      <strong>Navy application:</strong> Blood plasma pH is 7.4, with the bicarbonate buffer (pK&#x2090; = 6.1). Using H-H: 7.4 = 6.1 + log([HCO&#x2083;&minus;]/[H&#x2082;CO&#x2083;]) &rarr; log(ratio) = 1.3 &rarr; ratio = 20:1. The respiratory system (CO&#x2082; exhaled) and kidneys (HCO&#x2083;&minus; reabsorption) continuously adjust this ratio. Respiratory acidosis from smoke inhalation drops the ratio, dropping pH toward lethal territory.
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 3: STRONG ACID / STRONG BASE TITRATION -->
<!-- ============================================================ -->
<div class="section-card" data-section="3">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">3</span> Titration Curves: Strong Acid + Strong Base</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      A <strong>titration</strong> involves gradually adding a solution of known concentration (the <strong>titrant</strong>) to an analyte until the reaction is complete. A <strong>titration curve</strong> plots pH versus volume of titrant added. The shape of the curve reveals what type of acid-base system you have.
    </p>

    <p class="concept-text">
      For a <strong>strong acid + strong base</strong> titration (e.g., HCl titrated with NaOH):<br>
      &bull; Below the equivalence point: excess HCl dominates &rarr; low pH.<br>
      &bull; At the <strong>equivalence point</strong>: all HCl neutralized, only NaCl and water remain &rarr; <strong>pH = 7.00</strong> (neutral salt).<br>
      &bull; Above the equivalence point: excess NaOH &rarr; high pH.<br>
      &bull; The curve has a steep vertical inflection at the equivalence point.
    </p>

    <div class="formula-box">HCl + NaOH &rarr; NaCl + H&#x2082;O &nbsp;&nbsp;|&nbsp;&nbsp; Equivalence point: pH = 7</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Strong-Strong Titration Curve</div>
      <p style="font-size:.76rem;color:var(--text-dim);margin-bottom:12px">25.00 mL of 0.100 M HCl titrated with 0.100 M NaOH. Drag the slider to add titrant.</p>
      <div class="slider-row">
        <label>NaOH added (mL)</label>
        <input type="range" id="ssVol" min="0" max="50" step="0.5" value="0" oninput="updateSSTitration()">
        <span class="slider-val" id="ssVolVal">0.0 mL</span>
      </div>
      <svg id="ssSvg" width="100%" viewBox="0 0 560 300" style="display:block;margin-top:12px;overflow:visible"></svg>
      <div class="readout">
        <div class="readout-item"><span class="label">NaOH added</span><br><span class="value indigo" id="ssVolDisplay">0.0 mL</span></div>
        <div class="readout-item"><span class="label">pH</span><br><span class="value green" id="ssPH">1.00</span></div>
        <div class="readout-item"><span class="label">Stage</span><br><span class="value amber" id="ssStage">Before equivalence</span></div>
      </div>
    </div>

    <div class="key-point"><strong>The steep jump:</strong> Near the equivalence point (25 mL), pH jumps from about 4 to 10 in just a couple of drops. This is why indicators work -- they change color in this narrow range.</div>

    <div class="navy-context">
      <strong>Navy application:</strong> Wastewater neutralization on ships uses strong acid or base dosing controlled by automated pH sensors. The sharp equivalence point in strong-strong titrations means precise dosing is critical -- a tiny overshoot takes wastewater from acidic to basic instantly. MARPOL regulations require discharge pH to be 6–9.
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 4: WEAK ACID / STRONG BASE TITRATION -->
<!-- ============================================================ -->
<div class="section-card" data-section="4">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">4</span> Titration Curves: Weak Acid + Strong Base</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      When a <strong>weak acid</strong> (e.g., acetic acid, CH&#x2083;COOH, pK&#x2090; = 4.74) is titrated with a strong base (NaOH), the curve looks very different from strong-strong. The key differences are:
    </p>

    <div class="two-col">
      <div class="info-card">
        <div class="ic-title">Starting pH</div>
        <p>Higher than strong acid -- weak acid only partially dissociates. For 0.100 M CH&#x2083;COOH, starting pH &asymp; 2.87 (not 1.00).</p>
      </div>
      <div class="info-card">
        <div class="ic-title">Buffer Region</div>
        <p>Before equivalence point, a buffer forms. pH changes gradually. This is the H-H regime -- the working range of the buffer.</p>
      </div>
      <div class="info-card">
        <div class="ic-title">Half-Equivalence Point</div>
        <p>At exactly half the equivalence volume, [A&minus;] = [HA], so <strong>pH = pK&#x2090;</strong>. Reading this point off the curve tells you the pK&#x2090; of the weak acid.</p>
      </div>
      <div class="info-card">
        <div class="ic-title">Equivalence Point</div>
        <p>pH &gt; 7 (basic), because the conjugate base (CH&#x2083;COO&minus;) is a weak base that hydrolyzes water: CH&#x2083;COO&minus; + H&#x2082;O &rarr; CH&#x2083;COOH + OH&minus;.</p>
      </div>
    </div>

    <div class="formula-box amber">Half-equivalence: pH = pK&#x2090; &nbsp;&nbsp;|&nbsp;&nbsp; Equivalence: pH &gt; 7 (basic)</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Weak-Strong Titration Curve</div>
      <p style="font-size:.76rem;color:var(--text-dim);margin-bottom:12px">25.00 mL of 0.100 M CH&#x2083;COOH (pK&#x2090; = 4.74) titrated with 0.100 M NaOH.</p>
      <div class="slider-row">
        <label>NaOH added (mL)</label>
        <input type="range" id="wsVol" min="0" max="50" step="0.5" value="0" oninput="updateWSTitration()">
        <span class="slider-val" id="wsVolVal">0.0 mL</span>
      </div>
      <svg id="wsSvg" width="100%" viewBox="0 0 560 300" style="display:block;margin-top:12px;overflow:visible"></svg>
      <div class="readout">
        <div class="readout-item"><span class="label">NaOH added</span><br><span class="value indigo" id="wsVolDisplay">0.0 mL</span></div>
        <div class="readout-item"><span class="label">pH</span><br><span class="value green" id="wsPH">2.87</span></div>
        <div class="readout-item"><span class="label">Stage</span><br><span class="value amber" id="wsStage">Initial (weak acid)</span></div>
      </div>
    </div>

    <div class="key-point"><strong>Diagnostic trick:</strong> Read the half-equivalence volume (12.5 mL here), find the pH at that point on the curve -- that IS the pK&#x2090; of the unknown acid. Chemists use this to identify unknown weak acids experimentally.</div>

    <div class="navy-context">
      <strong>Navy application:</strong> Acetic acid (vinegar, pK&#x2090; = 4.74) is a common weak acid in lab cleaning solutions on ships. Titration curves with weak acids are used in water quality testing aboard carriers and submarines to identify and quantify organic acid contamination in potable water systems.
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 5: INDICATORS -->
<!-- ============================================================ -->
<div class="section-card" data-section="5">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">5</span> Acid-Base Indicators</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      An <strong>indicator</strong> is itself a weak acid (HIn) whose acid and conjugate base (In&minus;) have different colors. When you add it to a solution, the equilibrium HIn &harr; H&plus; + In&minus; shifts based on pH, changing the indicator's color.
    </p>

    <div class="formula-box">HIn (color A) &harr; H&plus; + In&minus; (color B)<br><span style="font-size:.8rem;opacity:.8">Color change occurs when pH &asymp; pK&#x2090;(indicator)</span></div>

    <p class="concept-text">
      <strong>Choosing the right indicator:</strong> Select an indicator whose pK&#x2090; is close to the equivalence point pH of your titration. The color change must occur within the steep part of the titration curve so that one drop produces a definitive color change.
    </p>

    <table class="rule-table">
      <thead>
        <tr><th>Indicator</th><th>Acid color</th><th>Base color</th><th>pH transition range</th><th>Best used for</th></tr>
      </thead>
      <tbody>
        <tr><td>Methyl orange</td><td style="color:#ef4444">Red</td><td style="color:#eab308">Yellow</td><td>3.1 – 4.4</td><td>Strong acid + strong base (titrant from basic)</td></tr>
        <tr><td>Methyl red</td><td style="color:#ef4444">Red</td><td style="color:#eab308">Yellow</td><td>4.4 – 6.2</td><td>Weak base + strong acid</td></tr>
        <tr><td>Bromothymol blue</td><td style="color:#eab308">Yellow</td><td style="color:#3b82f6">Blue</td><td>6.0 – 7.6</td><td>Strong acid + strong base (near pH 7)</td></tr>
        <tr><td>Phenolphthalein</td><td>Colorless</td><td style="color:#ec4899">Pink/Magenta</td><td>8.2 – 10.0</td><td>Weak acid + strong base (equivalence &gt;7)</td></tr>
        <tr><td>Alizarin yellow</td><td style="color:#eab308">Yellow</td><td style="color:#ef4444">Red</td><td>10.1 – 12.0</td><td>Very weak acids</td></tr>
      </tbody>
    </table>

    <div class="key-point"><strong>Phenolphthalein (pK&#x2090; &asymp; 9.1):</strong> The lab classic. Colorless in acid, pink/magenta in base. Perfect for weak acid + strong base titrations where the equivalence point is basic (pH 8–10). Do NOT use it for strong-strong titrations if you want precision near pH 7.</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Indicator Color Simulator</div>
      <p style="font-size:.76rem;color:var(--text-dim);margin-bottom:12px">Adjust pH and observe what each indicator looks like in solution.</p>
      <div class="slider-row">
        <label>Solution pH</label>
        <input type="range" id="indPH" min="0" max="14" step="0.1" value="7" oninput="updateIndicators()">
        <span class="slider-val" id="indPHVal">7.0</span>
      </div>
      <div style="margin-top:14px;display:flex;flex-direction:column;gap:10px" id="indicatorDisplay">
        <!-- Filled by JS -->
      </div>
    </div>

    <div class="navy-context">
      <strong>Navy application:</strong> Pool maintenance on ships uses phenol red as the primary indicator for pH testing (transition 6.8–8.2). A yellow pool means the pH has dropped below 6.8 -- CO&#x2082; absorption from air or swimmer-produced carbonic acid. Red/magenta means pH is too high -- excess chlorine dosing or NaOH overshoot. Maintaining pH 7.2–7.6 prevents eye irritation for crew and chloramine formation.
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 6: BUFFER CALCULATIONS -->
<!-- ============================================================ -->
<div class="section-card" data-section="6">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">6</span> Buffer Calculations &amp; Common Ion Effect</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      The <strong>common ion effect</strong> is the suppression of an equilibrium by a product that is already present in solution. When you dissolve sodium acetate (CH&#x2083;COONa) into acetic acid solution, the extra acetate (CH&#x2083;COO&minus;) shifts the equilibrium left, lowering [H&plus;] and raising pH. This is exactly how buffers work.
    </p>

    <div class="formula-box">CH&#x2083;COOH &harr; H&plus; + CH&#x2083;COO&minus; &nbsp; (K&#x2090; = 1.8&times;10&minus;5)<br><span style="font-size:.8rem;opacity:.8">Adding CH&#x2083;COO&minus; pushes equilibrium LEFT &rarr; [H&plus;] decreases</span></div>

    <p class="concept-text"><strong>Adding strong acid to a buffer</strong> — the ICE approach:</p>
    <ul class="step-list">
      <li>Identify moles of HA, A&minus;, and strong acid (H&plus;) added.</li>
      <li>React H&plus; with A&minus; stoichiometrically: A&minus; + H&plus; &rarr; HA. Strong acid goes to completion.</li>
      <li>Calculate new moles of HA and A&minus; after the reaction.</li>
      <li>Apply H-H: pH = pK&#x2090; + log([A&minus;]/[HA]). Use moles directly (volume cancels).</li>
    </ul>

    <p class="concept-text"><strong>Adding strong base to a buffer</strong>:</p>
    <ul class="step-list">
      <li>Identify moles of HA, A&minus;, and OH&minus; added.</li>
      <li>React OH&minus; with HA: HA + OH&minus; &rarr; A&minus; + H&#x2082;O.</li>
      <li>Calculate new moles of HA and A&minus;.</li>
      <li>Apply H-H using the new ratio.</li>
    </ul>

    <div class="key-point"><strong>Volume trick:</strong> In H-H calculations, since [A&minus;]/[HA] involves the same total volume in numerator and denominator, you can use moles instead of concentrations. This simplifies calculations enormously.</div>

    <div class="interactive-area">
      <div class="interactive-label">Worked Example: Adding Strong Acid to Buffer</div>
      <p style="font-size:.76rem;color:var(--text-dim);margin-bottom:12px">0.200 L of buffer: 0.100 M CH&#x2083;COOH + 0.100 M CH&#x2083;COO&minus; (pK&#x2090; = 4.74). Add 0.010 mol HCl.</p>
      <div style="background:var(--bg-card);border-radius:6px;padding:12px 14px;font-size:.76rem;line-height:1.9">
        <div>Initial moles: HA = 0.100&times;0.200 = <span style="color:var(--amber)">0.020 mol</span>, A&minus; = <span style="color:var(--indigo)">0.020 mol</span></div>
        <div>Add 0.010 mol H&plus;: A&minus; + H&plus; &rarr; HA</div>
        <div>After reaction: HA = 0.020 + 0.010 = <span style="color:var(--amber)">0.030 mol</span>, A&minus; = 0.020 &minus; 0.010 = <span style="color:var(--indigo)">0.010 mol</span></div>
        <div>pH = 4.74 + log(0.010/0.030) = 4.74 + log(0.333) = 4.74 + (&minus;0.477) = <span style="color:var(--green);font-weight:600">4.26</span></div>
        <div style="color:var(--text-dim);font-size:.7rem;margin-top:6px">Without buffer, adding 0.010 mol HCl to 0.200 L would give pH = &minus;log(0.050) = 1.30. Buffer kept pH at 4.26 instead.</div>
      </div>
    </div>

    <div class="practice-block">
      <div class="practice-title">Quick Check</div>
      <div class="problem">
        <p>A buffer contains 0.050 mol of NH&#x2083; and 0.050 mol of NH&#x2084;&plus; in 1.00 L. pK&#x2090;(NH&#x2084;&plus;) = 9.25. 0.010 mol NaOH is added. What is the new pH? (Round to 2 decimal places)</p>
        <div class="problem-input-row">
          <input type="number" id="bc1" step="0.01" placeholder="pH">
          <button class="btn btn-primary btn-sm" onclick="checkNum('bc1', 9.55, 0.05)">Check</button>
        </div>
        <div class="feedback" id="bc1-fb"></div>
      </div>
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 7: PRACTICE PROBLEMS -->
<!-- ============================================================ -->
<div class="section-card" data-section="7">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">7</span> Practice Problems</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">Work through each problem. All answers should be rounded as indicated. Use log tables or your calculator for logarithms.</p>

    <!-- P1 -->
    <div class="problem">
      <p><strong>P1.</strong> Calculate the pH of a buffer made by mixing 150 mL of 0.20 M acetic acid (CH&#x2083;COOH) with 100 mL of 0.20 M sodium acetate (CH&#x2083;COONa). pK&#x2090; = 4.74. Give answer to 2 decimal places.</p>
      <div class="problem-input-row">
        <input type="number" id="p1" step="0.01" placeholder="pH">
        <button class="btn btn-primary btn-sm" onclick="checkNum('p1', 4.56, 0.05)">Check</button>
      </div>
      <div class="feedback" id="p1-fb"></div>
    </div>

    <!-- P2 -->
    <div class="problem">
      <p><strong>P2.</strong> A buffer has [A&minus;]/[HA] = 3.16 and pK&#x2090; = 5.00. What is the pH? (Hint: log(3.16) = 0.50.) Give answer to 2 decimal places.</p>
      <div class="problem-input-row">
        <input type="number" id="p2" step="0.01" placeholder="pH">
        <button class="btn btn-primary btn-sm" onclick="checkNum('p2', 5.50, 0.05)">Check</button>
      </div>
      <div class="feedback" id="p2-fb"></div>
    </div>

    <!-- P3 -->
    <div class="problem">
      <p><strong>P3.</strong> 25.00 mL of 0.100 M HCl is titrated with 0.100 M NaOH. What is the pH after adding 10.00 mL of NaOH? (Strong-strong; calculate excess HCl concentration.)</p>
      <div class="problem-input-row">
        <input type="number" id="p3" step="0.01" placeholder="pH">
        <button class="btn btn-primary btn-sm" onclick="checkNum('p3', 1.48, 0.05)">Check</button>
      </div>
      <div class="feedback" id="p3-fb"></div>
    </div>

    <!-- P4 -->
    <div class="problem">
      <p><strong>P4.</strong> For a weak acid + strong base titration (pK&#x2090; = 4.74, 25.00 mL of 0.100 M weak acid, titrated with 0.100 M NaOH): What is the pH at the half-equivalence point (12.50 mL NaOH added)?</p>
      <div class="problem-input-row">
        <input type="number" id="p4" step="0.01" placeholder="pH">
        <button class="btn btn-primary btn-sm" onclick="checkNum('p4', 4.74, 0.05)">Check</button>
      </div>
      <div class="feedback" id="p4-fb"></div>
    </div>

    <!-- P5 -->
    <div class="problem">
      <p><strong>P5.</strong> A buffer is prepared with 0.300 mol NH&#x2084;Cl and 0.200 mol NH&#x2083; in 1.00 L of solution. pK&#x2090;(NH&#x2084;&plus;) = 9.25. Calculate the pH. Give answer to 2 decimal places.</p>
      <div class="problem-input-row">
        <input type="number" id="p5" step="0.01" placeholder="pH">
        <button class="btn btn-primary btn-sm" onclick="checkNum('p5', 9.07, 0.05)">Check</button>
      </div>
      <div class="feedback" id="p5-fb"></div>
    </div>

    <!-- P6 -->
    <div class="problem">
      <p><strong>P6.</strong> A formic acid (HCOOH) buffer has pK&#x2090; = 3.74. You need to prepare a buffer with pH = 3.44. What ratio of [HCOO&minus;]/[HCOOH] is required? Round to 2 decimal places.</p>
      <div class="problem-input-row">
        <input type="number" id="p6" step="0.01" placeholder="ratio">
        <button class="btn btn-primary btn-sm" onclick="checkNum('p6', 0.50, 0.05)">Check</button>
      </div>
      <div class="feedback" id="p6-fb"></div>
    </div>

    <div style="margin-top:16px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;font-size:.76rem;line-height:1.8">
      <div style="color:var(--amber);font-weight:600;margin-bottom:8px">Answer key with work:</div>
      <div style="color:var(--text-dim)">
        P1: moles HA = 0.150&times;0.20 = 0.030, moles A&minus; = 0.100&times;0.20 = 0.020. pH = 4.74 + log(0.020/0.030) = 4.74 + log(0.667) = 4.74 &minus; 0.176 = <strong style="color:var(--green)">4.56</strong><br>
        P2: pH = 5.00 + 0.50 = <strong style="color:var(--green)">5.50</strong><br>
        P3: moles HCl = 0.025&times;0.100 = 0.0025; moles NaOH = 0.010&times;0.100 = 0.0010; excess HCl = 0.0015 mol in 35.00 mL = 0.04286 M; pH = &minus;log(0.04286) = <strong style="color:var(--green)">1.37</strong><br>
        P4: At half-equivalence, [A&minus;] = [HA], pH = pK&#x2090; = <strong style="color:var(--green)">4.74</strong><br>
        P5: pH = 9.25 + log(0.200/0.300) = 9.25 + log(0.667) = 9.25 &minus; 0.176 = <strong style="color:var(--green)">9.07</strong><br>
        P6: 3.44 = 3.74 + log(r) &rarr; log(r) = &minus;0.30 &rarr; r = 10&minus;0.30 = <strong style="color:var(--green)">0.50</strong>
      </div>
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 8: QUIZ -->
<!-- ============================================================ -->
<div class="section-card" data-section="8">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">8</span> Quiz — 10 Questions</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <div class="quiz-score">
      <span class="score-text">Score: <span id="quizScore">0</span> / 10</span>
      <button class="btn btn-sm" onclick="resetQuiz()">Reset Quiz</button>
    </div>

    <!-- Q1 -->
    <div class="quiz-q">
      <div class="q-num">Question 1</div>
      <div class="q-text">A buffer is best described as a solution that:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(1,this,false)">A. Neutralizes all acid added to it completely</button>
        <button class="choice-btn" onclick="quizAnswer(1,this,true)">B. Resists changes in pH when small amounts of acid or base are added</button>
        <button class="choice-btn" onclick="quizAnswer(1,this,false)">C. Maintains an exactly constant pH no matter what is added</button>
        <button class="choice-btn" onclick="quizAnswer(1,this,false)">D. Contains equal moles of strong acid and strong base</button>
      </div>
    </div>

    <!-- Q2 -->
    <div class="quiz-q">
      <div class="q-num">Question 2</div>
      <div class="q-text">Using Henderson-Hasselbalch: a buffer has pK&#x2090; = 6.80 and [A&minus;]/[HA] = 10. What is the pH?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(2,this,false)">A. 5.80</button>
        <button class="choice-btn" onclick="quizAnswer(2,this,false)">B. 6.80</button>
        <button class="choice-btn" onclick="quizAnswer(2,this,true)">C. 7.80</button>
        <button class="choice-btn" onclick="quizAnswer(2,this,false)">D. 8.80</button>
      </div>
    </div>

    <!-- Q3 -->
    <div class="quiz-q">
      <div class="q-num">Question 3</div>
      <div class="q-text">In a strong acid + strong base titration, the equivalence point pH is:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(3,this,false)">A. Always less than 7</button>
        <button class="choice-btn" onclick="quizAnswer(3,this,true)">B. Exactly 7 (at 25&deg;C)</button>
        <button class="choice-btn" onclick="quizAnswer(3,this,false)">C. Always greater than 7</button>
        <button class="choice-btn" onclick="quizAnswer(3,this,false)">D. Equal to the pK&#x2090; of water</button>
      </div>
    </div>

    <!-- Q4 -->
    <div class="quiz-q">
      <div class="q-num">Question 4</div>
      <div class="q-text">For a weak acid + strong base titration, at the half-equivalence point:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(4,this,false)">A. pH = 7</button>
        <button class="choice-btn" onclick="quizAnswer(4,this,false)">B. All the weak acid has been neutralized</button>
        <button class="choice-btn" onclick="quizAnswer(4,this,true)">C. pH = pK&#x2090; of the weak acid</button>
        <button class="choice-btn" onclick="quizAnswer(4,this,false)">D. The solution is most basic</button>
      </div>
    </div>

    <!-- Q5 -->
    <div class="quiz-q">
      <div class="q-num">Question 5</div>
      <div class="q-text">The equivalence point of a weak acid + strong base titration has pH:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(5,this,false)">A. Equal to 7</button>
        <button class="choice-btn" onclick="quizAnswer(5,this,false)">B. Less than 7, because the acid was weak</button>
        <button class="choice-btn" onclick="quizAnswer(5,this,true)">C. Greater than 7, because the conjugate base hydrolyzes water</button>
        <button class="choice-btn" onclick="quizAnswer(5,this,false)">D. Equal to the pK&#x2090; of the weak acid</button>
      </div>
    </div>

    <!-- Q6 -->
    <div class="quiz-q">
      <div class="q-num">Question 6</div>
      <div class="q-text">Phenolphthalein changes from colorless to pink in the pH range 8.2–10.0. It is the correct indicator for:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(6,this,false)">A. Strong acid + strong base (equivalence at pH 7)</button>
        <button class="choice-btn" onclick="quizAnswer(6,this,true)">B. Weak acid + strong base (equivalence above pH 7)</button>
        <button class="choice-btn" onclick="quizAnswer(6,this,false)">C. Strong base + strong acid (equivalence at pH 7)</button>
        <button class="choice-btn" onclick="quizAnswer(6,this,false)">D. All acid-base titrations equally</button>
      </div>
    </div>

    <!-- Q7 -->
    <div class="quiz-q">
      <div class="q-num">Question 7</div>
      <div class="q-text">Blood is buffered at pH 7.4 by the H&#x2082;CO&#x2083;/HCO&#x2083;&minus; system (pK&#x2090; = 6.1). The [HCO&#x2083;&minus;]/[H&#x2082;CO&#x2083;] ratio is approximately:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(7,this,false)">A. 1 : 1</button>
        <button class="choice-btn" onclick="quizAnswer(7,this,false)">B. 10 : 1</button>
        <button class="choice-btn" onclick="quizAnswer(7,this,true)">C. 20 : 1</button>
        <button class="choice-btn" onclick="quizAnswer(7,this,false)">D. 100 : 1</button>
      </div>
    </div>

    <!-- Q8 -->
    <div class="quiz-q">
      <div class="q-num">Question 8</div>
      <div class="q-text">When 0.010 mol of strong acid is added to a buffer containing 0.050 mol HA and 0.050 mol A&minus;, the A&minus; concentration:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(8,this,false)">A. Increases, because acid shifts equilibrium right</button>
        <button class="choice-btn" onclick="quizAnswer(8,this,true)">B. Decreases, as A&minus; reacts with H&plus; to form HA</button>
        <button class="choice-btn" onclick="quizAnswer(8,this,false)">C. Stays the same, because the buffer is at equilibrium</button>
        <button class="choice-btn" onclick="quizAnswer(8,this,false)">D. Goes to zero immediately</button>
      </div>
    </div>

    <!-- Q9 -->
    <div class="quiz-q">
      <div class="q-num">Question 9</div>
      <div class="q-text">Bromothymol blue (transition range pH 6.0–7.6) would be the BEST indicator for which titration?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(9,this,false)">A. Weak acid (pK&#x2090; = 4.74) + strong base (equivalence pH &asymp; 8.7)</button>
        <button class="choice-btn" onclick="quizAnswer(9,this,true)">B. Strong acid + strong base (equivalence pH = 7.0)</button>
        <button class="choice-btn" onclick="quizAnswer(9,this,false)">C. Very weak acid (pK&#x2090; = 9.0) + strong base (equivalence pH &asymp; 11)</button>
        <button class="choice-btn" onclick="quizAnswer(9,this,false)">D. Strong base + strong acid with methyl orange endpoint</button>
      </div>
    </div>

    <!-- Q10 -->
    <div class="quiz-q">
      <div class="q-num">Question 10</div>
      <div class="q-text">A buffer is most effective (has the highest buffer capacity) when:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(10,this,false)">A. The concentration of HA is much greater than A&minus;</button>
        <button class="choice-btn" onclick="quizAnswer(10,this,false)">B. [A&minus;]/[HA] ratio is 10:1</button>
        <button class="choice-btn" onclick="quizAnswer(10,this,true)">C. Both [HA] and [A&minus;] are high and approximately equal</button>
        <button class="choice-btn" onclick="quizAnswer(10,this,false)">D. The solution is very dilute in both components</button>
      </div>
    </div>

  </div></div>
</div>

</div><!-- /content -->

<script>
// ============================================================
// PROGRESS TRACKING
// ============================================================
var completedSections = new Set();
function updateProgress() {
  var cards = document.querySelectorAll('.section-card');
  var total = cards.length;
  var pct = (completedSections.size / total) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressLabel').textContent = completedSections.size + ' / ' + total + ' sections';
}
function markComplete(n) {
  if (completedSections.has(n)) return;
  completedSections.add(n);
  var card = document.querySelector('.section-card[data-section="'+n+'"]');
  if (card) card.classList.add('completed');
  updateProgress();
}
function toggleSection(header) {
  var card = header.parentElement;
  card.classList.toggle('open');
  if (card.classList.contains('open')) { markComplete(+card.getAttribute('data-section')); }
  updateProgress();
}

// ============================================================
// CHECK FUNCTIONS
// ============================================================
function checkNum(id, answer, tol) {
  var inp = document.getElementById(id);
  var fb = document.getElementById(id + '-fb');
  var val = parseFloat(inp.value);
  if (isNaN(val)) {
    fb.className = 'feedback incorrect'; fb.textContent = 'Enter a number.';
    inp.parentElement.parentElement.classList.add('shake');
    setTimeout(function(){inp.parentElement.parentElement.classList.remove('shake')},400);
    return;
  }
  if (Math.abs(val - answer) <= tol) {
    fb.className = 'feedback correct'; fb.textContent = 'Correct! The answer is ' + answer + '.';
    inp.parentElement.parentElement.classList.add('pop');
    setTimeout(function(){inp.parentElement.parentElement.classList.remove('pop')},350);
  } else {
    fb.className = 'feedback incorrect'; fb.textContent = 'Not quite. Try again. (Hint: near ' + answer.toFixed(2) + ')';
    inp.parentElement.parentElement.classList.add('shake');
    setTimeout(function(){inp.parentElement.parentElement.classList.remove('shake')},400);
  }
}
function checkMC(btn, id, result) {
  var fb = document.getElementById(id + '-fb');
  var btns = btn.parentElement.querySelectorAll('.mc-btn');
  btns.forEach(function(b) { b.classList.add('disabled'); });
  if (result === 'correct') {
    btn.classList.add('correct'); fb.className = 'feedback correct'; fb.textContent = 'Correct!';
    btn.closest('.problem').classList.add('pop');
    setTimeout(function(){btn.closest('.problem').classList.remove('pop')},350);
  } else {
    btn.classList.add('wrong'); fb.className = 'feedback incorrect'; fb.textContent = 'Not quite. Review the concept above.';
    btn.closest('.problem').classList.add('shake');
    setTimeout(function(){btn.closest('.problem').classList.remove('shake')},400);
  }
}
var quizScoreVal = 0, quizAnswered = new Set();
function quizAnswer(qn, btn, correct) {
  if (quizAnswered.has(qn)) return;
  quizAnswered.add(qn);
  var btns = btn.parentElement.querySelectorAll('.choice-btn');
  btns.forEach(function(b) { b.classList.add('disabled'); });
  if (correct) {
    btn.classList.add('selected-correct'); quizScoreVal++;
    btn.closest('.quiz-q').classList.add('pop');
    setTimeout(function(){btn.closest('.quiz-q').classList.remove('pop')},350);
  } else {
    btn.classList.add('selected-wrong');
    btns.forEach(function(b) {
      if (b.getAttribute('onclick') && b.getAttribute('onclick').indexOf('true') !== -1)
        b.classList.add('reveal-correct');
    });
    btn.closest('.quiz-q').classList.add('shake');
    setTimeout(function(){btn.closest('.quiz-q').classList.remove('shake')},400);
  }
  document.getElementById('quizScore').textContent = quizScoreVal;
}
function resetQuiz() {
  quizScoreVal = 0; quizAnswered.clear();
  document.getElementById('quizScore').textContent = '0';
  document.querySelectorAll('.quiz-q .choice-btn').forEach(function(b) { b.className = 'choice-btn'; });
}

// ============================================================
// SECTION 1: BUFFER VISUALIZER
// ============================================================
function updateBuffer() {
  var acid = parseFloat(document.getElementById('bufAcid').value);
  var base = parseFloat(document.getElementById('bufBase').value);
  document.getElementById('bufAcidVal').textContent = acid.toFixed(3) + ' mol';
  document.getElementById('bufBaseVal').textContent = base.toFixed(3) + ' mol';

  // Reset sliders influence each other conceptually but we just compute net
  // Initial in 1L buffer: 0.10 mol HA, 0.10 mol A-
  var initHA = 0.10, initAm = 0.10;
  // Net: add acid and base independently
  var HA = initHA + acid - base;
  var Am = initAm - acid + base;

  var ph, status, statusClass;
  var pka = 4.74;

  if (HA <= 0 || Am <= 0) {
    if (Am <= 0) {
      // Buffer exhausted: all A- consumed, excess acid
      var excessAcid = Math.abs(Am);
      ph = -Math.log10(excessAcid / 1.0);
      if (ph < 0) ph = 0;
      status = 'Buffer exhausted (acid)';
      statusClass = 'pink';
    } else {
      // Buffer exhausted: all HA consumed, excess base
      var excessBase = Math.abs(HA);
      var pOH = -Math.log10(excessBase / 1.0);
      ph = 14 - pOH;
      if (ph > 14) ph = 14;
      status = 'Buffer exhausted (base)';
      statusClass = 'pink';
    }
    HA = Math.max(HA, 0);
    Am = Math.max(Am, 0);
  } else {
    ph = pka + Math.log10(Am / HA);
    status = 'Buffering';
    statusClass = 'green';
  }

  document.getElementById('bufHA').textContent = HA.toFixed(3) + ' M';
  document.getElementById('bufAminus').textContent = Am.toFixed(3) + ' M';
  document.getElementById('bufPH').textContent = ph.toFixed(2);
  document.getElementById('bufStatus').textContent = status;
  document.getElementById('bufStatus').className = 'value ' + (statusClass || 'green');

  var pct = (ph / 14) * 100;
  pct = Math.max(1, Math.min(99, pct));
  document.getElementById('bufPhMarker').style.left = pct + '%';
  document.getElementById('bufPhLabel').style.left = pct + '%';
  document.getElementById('bufPhLabel').textContent = 'pH ' + ph.toFixed(2);
}

// ============================================================
// SECTION 2: HENDERSON-HASSELBALCH CALCULATOR
// ============================================================
function updateHH() {
  var pka = parseFloat(document.getElementById('hhPka').value);
  var sliderVal = parseInt(document.getElementById('hhRatio').value); // -20 to 20
  // Map slider to ratio: ratio = 10^(sliderVal/10)
  var ratio = Math.pow(10, sliderVal / 10);
  var logRatio = Math.log10(ratio);
  var ph = pka + logRatio;
  ph = Math.max(0, Math.min(14, ph));

  document.getElementById('hhPkaVal').textContent = pka.toFixed(2);
  document.getElementById('hhRatioVal').textContent = ratio.toFixed(2);
  document.getElementById('hhPkaDisplay').textContent = pka.toFixed(2);
  document.getElementById('hhLogDisplay').textContent = logRatio.toFixed(2);
  document.getElementById('hhPhDisplay').textContent = ph.toFixed(2);
  document.getElementById('hhRatioDisplay').textContent = ratio.toFixed(2) + ' : 1';

  document.getElementById('hhEqPka').textContent = pka.toFixed(2);
  document.getElementById('hhEqRatio').textContent = ratio.toFixed(2);
  document.getElementById('hhEqResult').textContent = ph.toFixed(2);

  var pct = (ph / 14) * 100;
  pct = Math.max(1, Math.min(99, pct));
  document.getElementById('hhPhMarker').style.left = pct + '%';
  document.getElementById('hhPhLabel').style.left = pct + '%';
  document.getElementById('hhPhLabel').textContent = 'pH ' + ph.toFixed(2);
}

// ============================================================
// SECTION 3: STRONG-STRONG TITRATION CURVE
// ============================================================
function calcSSpH(volNaOH) {
  // 25.00 mL 0.100 M HCl + 0.100 M NaOH
  var molHCl = 0.025 * 0.100;  // 0.0025 mol
  var molNaOH = (volNaOH / 1000) * 0.100;
  var totalVol = (25.00 + volNaOH) / 1000; // L
  var ph;
  var eps = 1e-9;
  if (Math.abs(molNaOH - molHCl) < eps) {
    ph = 7.00;
  } else if (molNaOH < molHCl) {
    var excessHCl = molHCl - molNaOH;
    var cH = excessHCl / totalVol;
    ph = -Math.log10(cH);
  } else {
    var excessNaOH = molNaOH - molHCl;
    var cOH = excessNaOH / totalVol;
    var pOH = -Math.log10(cOH);
    ph = 14 - pOH;
  }
  return Math.max(0, Math.min(14, ph));
}

function drawTitrationCurve(svgId, calcPhFn, equivalenceVol, markerVol, halfEqVol, showHalfEq) {
  var svg = document.getElementById(svgId);
  var W = 560, H = 300;
  var padL = 52, padR = 20, padT = 20, padB = 40;
  var chartW = W - padL - padR;
  var chartH = H - padT - padB;
  var maxVol = 50;

  // Build path points
  var points = [];
  for (var v = 0; v <= maxVol; v += 0.25) {
    var ph = calcPhFn(v);
    var x = padL + (v / maxVol) * chartW;
    var y = padT + chartH - (ph / 14) * chartH;
    points.push([x, y]);
  }

  var pathD = points.map(function(p, i) {
    return (i === 0 ? 'M' : 'L') + p[0].toFixed(1) + ',' + p[1].toFixed(1);
  }).join(' ');

  // Y axis ticks
  var yTicks = '';
  for (var ph = 0; ph <= 14; ph += 2) {
    var y = padT + chartH - (ph / 14) * chartH;
    yTicks += '<line x1="' + (padL-5) + '" y1="' + y + '" x2="' + padL + '" y2="' + y + '" stroke="#363b47" stroke-width="1"/>';
    yTicks += '<text x="' + (padL-8) + '" y="' + (y+4) + '" fill="#9ca3af" font-size="9" text-anchor="end">' + ph + '</text>';
    if (ph > 0 && ph < 14) {
      yTicks += '<line x1="' + padL + '" y1="' + y + '" x2="' + (padL + chartW) + '" y2="' + y + '" stroke="#363b47" stroke-width="0.5" stroke-dasharray="3,4"/>';
    }
  }

  // X axis ticks
  var xTicks = '';
  for (var v2 = 0; v2 <= maxVol; v2 += 10) {
    var x2 = padL + (v2 / maxVol) * chartW;
    xTicks += '<line x1="' + x2 + '" y1="' + (padT + chartH) + '" x2="' + x2 + '" y2="' + (padT + chartH + 5) + '" stroke="#363b47" stroke-width="1"/>';
    xTicks += '<text x="' + x2 + '" y="' + (padT + chartH + 16) + '" fill="#9ca3af" font-size="9" text-anchor="middle">' + v2 + '</text>';
  }

  // Equivalence point line
  var eqX = padL + (equivalenceVol / maxVol) * chartW;
  var eqPh = calcPhFn(equivalenceVol);
  var eqY = padT + chartH - (eqPh / 14) * chartH;
  var eqLine = '<line x1="' + eqX + '" y1="' + padT + '" x2="' + eqX + '" y2="' + (padT + chartH) + '" stroke="rgba(245,158,11,0.4)" stroke-width="1" stroke-dasharray="4,4"/>';
  var eqDot = '<circle cx="' + eqX + '" cy="' + eqY + '" r="5" fill="#f59e0b"/>';
  var eqLabel = '<text x="' + (eqX + 5) + '" y="' + (padT + 14) + '" fill="#f59e0b" font-size="9">Equiv. pt (pH ' + eqPh.toFixed(1) + ')</text>';

  // Half-equivalence point (weak acid only)
  var halfEqMarkup = '';
  if (showHalfEq) {
    var hX = padL + (halfEqVol / maxVol) * chartW;
    var hPh = calcPhFn(halfEqVol);
    var hY = padT + chartH - (hPh / 14) * chartH;
    halfEqMarkup = '<line x1="' + hX + '" y1="' + padT + '" x2="' + hX + '" y2="' + (padT + chartH) + '" stroke="rgba(99,102,241,0.4)" stroke-width="1" stroke-dasharray="3,4"/>';
    halfEqMarkup += '<circle cx="' + hX + '" cy="' + hY + '" r="4" fill="#6366f1"/>';
    halfEqMarkup += '<text x="' + (hX + 4) + '" y="' + (hY - 8) + '" fill="#6366f1" font-size="8">pH = pKa = ' + hPh.toFixed(2) + '</text>';
  }

  // Marker dot for current slider position
  var mPh = calcPhFn(markerVol);
  var mX = padL + (markerVol / maxVol) * chartW;
  var mY = padT + chartH - (mPh / 14) * chartH;
  var markerDot = '<circle cx="' + mX + '" cy="' + mY + '" r="6" fill="#22c55e" stroke="#1e2128" stroke-width="2"/>';

  // Axes
  var axes = '<rect x="' + padL + '" y="' + padT + '" width="' + chartW + '" height="' + chartH + '" fill="none" stroke="#363b47" stroke-width="1" rx="2"/>';

  // pH=7 reference
  var y7 = padT + chartH - (7/14)*chartH;
  var ref7 = '<line x1="' + padL + '" y1="' + y7 + '" x2="' + (padL+chartW) + '" y2="' + y7 + '" stroke="rgba(34,197,94,0.25)" stroke-width="1" stroke-dasharray="6,4"/>';
  var ref7Label = '<text x="' + (padL + chartW - 2) + '" y="' + (y7 - 4) + '" fill="rgba(34,197,94,0.5)" font-size="8" text-anchor="end">pH 7</text>';

  // Axis labels
  var yAxisLabel = '<text x="12" y="' + (padT + chartH/2) + '" fill="#9ca3af" font-size="10" text-anchor="middle" transform="rotate(-90,12,' + (padT + chartH/2) + ')">pH</text>';
  var xAxisLabel = '<text x="' + (padL + chartW/2) + '" y="' + (H - 4) + '" fill="#9ca3af" font-size="10" text-anchor="middle">Volume NaOH added (mL)</text>';

  svg.innerHTML =
    '<rect width="' + W + '" height="' + H + '" fill="transparent"/>' +
    yTicks + xTicks + axes + ref7 + ref7Label +
    eqLine + halfEqMarkup +
    '<path d="' + pathD + '" fill="none" stroke="#6366f1" stroke-width="2.5" stroke-linejoin="round"/>' +
    eqDot + eqLabel + markerDot +
    yAxisLabel + xAxisLabel;
}

function updateSSTitration() {
  var vol = parseFloat(document.getElementById('ssVol').value);
  var ph = calcSSpH(vol);
  document.getElementById('ssVolVal').textContent = vol.toFixed(1) + ' mL';
  document.getElementById('ssVolDisplay').textContent = vol.toFixed(1) + ' mL';
  document.getElementById('ssPH').textContent = ph.toFixed(2);

  var stage;
  if (vol < 24.9) stage = 'Before equivalence';
  else if (vol < 25.1) stage = 'At equivalence point';
  else stage = 'After equivalence';
  document.getElementById('ssStage').textContent = stage;

  drawTitrationCurve('ssSvg', calcSSpH, 25, vol, 12.5, false);
}

// ============================================================
// SECTION 4: WEAK-STRONG TITRATION CURVE
// ============================================================
function calcWSpH(volNaOH) {
  // 25.00 mL 0.100 M CH3COOH + 0.100 M NaOH, pKa = 4.74
  var pka = 4.74;
  var Ka = Math.pow(10, -pka);
  var molAcid = 0.025 * 0.100; // 0.0025 mol
  var molNaOH = (volNaOH / 1000) * 0.100;
  var totalVol = (25.00 + volNaOH) / 1000;
  var ph;
  var eps = 1e-9;

  if (volNaOH < eps) {
    // Initial weak acid: solve Ka = x^2 / (C - x)
    var C = molAcid / totalVol;
    var x = (-Ka + Math.sqrt(Ka * Ka + 4 * Ka * C)) / 2;
    ph = -Math.log10(x);
  } else if (molNaOH < molAcid - eps) {
    // Buffer region: H-H
    var molHA = molAcid - molNaOH;
    var molAm = molNaOH;
    ph = pka + Math.log10(molAm / molHA);
  } else if (Math.abs(molNaOH - molAcid) < 5e-5) {
    // At equivalence: weak base (acetate) hydrolysis
    // CH3COO- + H2O <-> CH3COOH + OH-
    // Kb = Kw/Ka
    var Kb = 1e-14 / Ka;
    var Cb = molAcid / totalVol;
    var y = (-Kb + Math.sqrt(Kb * Kb + 4 * Kb * Cb)) / 2;
    var pOH = -Math.log10(y);
    ph = 14 - pOH;
  } else {
    // After equivalence: excess NaOH
    var excessBase = molNaOH - molAcid;
    var cOH = excessBase / totalVol;
    var pOH2 = -Math.log10(cOH);
    ph = 14 - pOH2;
  }
  return Math.max(0, Math.min(14, ph));
}

function updateWSTitration() {
  var vol = parseFloat(document.getElementById('wsVol').value);
  var ph = calcWSpH(vol);
  document.getElementById('wsVolVal').textContent = vol.toFixed(1) + ' mL';
  document.getElementById('wsVolDisplay').textContent = vol.toFixed(1) + ' mL';
  document.getElementById('wsPH').textContent = ph.toFixed(2);

  var stage;
  if (vol < 0.5) stage = 'Initial (weak acid)';
  else if (vol < 12.0) stage = 'Buffer region';
  else if (vol < 13.0) stage = 'Half-equivalence (pH = pKa)';
  else if (vol < 24.5) stage = 'Buffer region';
  else if (vol < 25.5) stage = 'Equivalence point (basic)';
  else stage = 'After equivalence (excess base)';
  document.getElementById('wsStage').textContent = stage;

  drawTitrationCurve('wsSvg', calcWSpH, 25, vol, 12.5, true);
}

// ============================================================
// SECTION 5: INDICATOR SIMULATOR
// ============================================================
var indicators = [
  {name: 'Methyl orange',    pKa: 3.75, acidColor: '#ef4444', baseColor: '#eab308', acidName: 'Red',    baseName: 'Yellow'},
  {name: 'Methyl red',       pKa: 5.30, acidColor: '#ef4444', baseColor: '#eab308', acidName: 'Red',    baseName: 'Yellow'},
  {name: 'Bromothymol blue', pKa: 7.10, acidColor: '#eab308', baseColor: '#3b82f6', acidName: 'Yellow', baseName: 'Blue'},
  {name: 'Phenolphthalein',  pKa: 9.10, acidColor: 'rgba(200,200,200,0.15)', baseColor: '#ec4899', acidName: 'Colorless', baseName: 'Pink'},
  {name: 'Alizarin yellow',  pKa: 11.0, acidColor: '#eab308', baseColor: '#ef4444', acidName: 'Yellow', baseName: 'Red'}
];

function updateIndicators() {
  var ph = parseFloat(document.getElementById('indPH').value);
  document.getElementById('indPHVal').textContent = ph.toFixed(1);
  var container = document.getElementById('indicatorDisplay');
  var html = '';
  indicators.forEach(function(ind) {
    // Fraction in base form: f = 10^(pH-pKa) / (1 + 10^(pH-pKa))
    var ratio = Math.pow(10, ph - ind.pKa);
    var fBase = ratio / (1 + ratio);
    // Mix colors via opacity
    var transitionStart = ph >= ind.pKa - 1 && ph <= ind.pKa + 1;
    var label, swatchStyle;
    if (fBase < 0.1) {
      label = ind.acidName;
      swatchStyle = 'background:' + ind.acidColor + ';';
    } else if (fBase > 0.9) {
      label = ind.baseName;
      swatchStyle = 'background:' + ind.baseColor + ';';
    } else {
      label = 'Transitioning (' + Math.round(fBase * 100) + '% ' + ind.baseName + ')';
      swatchStyle = 'background:' + ind.baseColor + ';opacity:' + (0.3 + fBase * 0.7) + ';';
    }
    html += '<div style="display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--bg-card);border:1px solid var(--border);border-radius:6px">';
    html += '<span class="indicator-swatch" style="' + swatchStyle + '"></span>';
    html += '<span style="font-size:.72rem;color:var(--text-dim);min-width:140px">' + ind.name + '</span>';
    html += '<span style="font-size:.72rem;color:var(--text-bright)">' + label + '</span>';
    html += '<span style="font-size:.68rem;color:var(--text-dim);margin-left:auto">pK&#x2090; ' + ind.pKa + '</span>';
    html += '</div>';
  });
  container.innerHTML = html;
}

// ============================================================
// INIT
// ============================================================
window.addEventListener('load', function() {
  markComplete(1);
  updateProgress();
  updateBuffer();
  updateHH();
  drawTitrationCurve('ssSvg', calcSSpH, 25, 0, 12.5, false);
  document.getElementById('ssPH').textContent = calcSSpH(0).toFixed(2);
  drawTitrationCurve('wsSvg', calcWSpH, 25, 0, 12.5, true);
  document.getElementById('wsPH').textContent = calcWSpH(0).toFixed(2);
  updateIndicators();
});
</script>
</body>
</html>
