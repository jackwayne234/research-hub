<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Week 6: Chemical Nomenclature</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ── Reset & Base ─────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 16px; scroll-behavior: smooth; }
body {
  background: #1e2128;
  color: #c9cdd5;
  font-family: 'JetBrains Mono', monospace;
  line-height: 1.65;
  min-height: 100vh;
  padding: 0 0 4rem;
}

/* ── Palette ──────────────────────────────────────── */
:root {
  --bg: #1e2128;
  --surface: #262a33;
  --surface2: #2e323d;
  --border: #363b47;
  --text: #c9cdd5;
  --text-dim: #8b90a0;
  --primary: #6366f1;
  --primary-dim: rgba(99,102,241,.15);
  --green: #22c55e;
  --green-dim: rgba(34,197,94,.15);
  --pink: #ec4899;
  --pink-dim: rgba(236,72,153,.15);
  --amber: #f59e0b;
  --amber-dim: rgba(245,158,11,.15);
  --blue: #3b82f6;
  --blue-dim: rgba(59,130,246,.15);
  --red: #ef4444;
  --red-dim: rgba(239,68,68,.15);
  --cyan: #06b6d4;
  --cyan-dim: rgba(6,182,212,.15);
}

/* ── Header ───────────────────────────────────────── */
.page-header {
  text-align: center;
  padding: 2.5rem 1rem 1rem;
}
.page-header h1 {
  font-size: clamp(1.3rem, 3.5vw, 2rem);
  font-weight: 700;
  color: #fff;
  letter-spacing: -.02em;
}
.page-header .subtitle {
  font-size: .8rem;
  color: var(--text-dim);
  margin-top: .3rem;
}

/* ── Progress Bar ─────────────────────────────────── */
.progress-wrap {
  max-width: 740px;
  margin: 1.2rem auto .5rem;
  padding: 0 1rem;
}
.progress-bar-outer {
  background: var(--surface);
  border-radius: 8px;
  height: 10px;
  overflow: hidden;
  border: 1px solid var(--border);
}
.progress-bar-inner {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--primary), #818cf8);
  border-radius: 8px;
  transition: width .5s cubic-bezier(.34,1.56,.64,1);
}
.progress-label {
  font-size: .7rem;
  color: var(--text-dim);
  text-align: right;
  margin-top: .3rem;
}

/* ── Container ────────────────────────────────────── */
.container {
  max-width: 860px;
  margin: 0 auto;
  padding: 0 1rem;
}

/* ── Collapsible Card ─────────────────────────────── */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  margin-bottom: 1rem;
  overflow: hidden;
  transition: border-color .3s;
}
.card.completed { border-color: var(--green); }
.card-header {
  display: flex;
  align-items: center;
  gap: .75rem;
  padding: 1rem 1.2rem;
  cursor: pointer;
  user-select: none;
  transition: background .2s;
}
.card-header:hover { background: var(--surface2); }
.card-header .num {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 30px; height: 30px;
  border-radius: 8px;
  background: var(--primary-dim);
  color: var(--primary);
  font-weight: 700;
  font-size: .8rem;
  flex-shrink: 0;
}
.card.completed .card-header .num {
  background: var(--green-dim);
  color: var(--green);
}
.card-header .title {
  flex: 1;
  font-weight: 600;
  font-size: .9rem;
  color: #eee;
}
.card-header .chevron {
  font-size: 1.1rem;
  color: var(--text-dim);
  transition: transform .3s cubic-bezier(.34,1.56,.64,1);
}
.card.open .card-header .chevron { transform: rotate(180deg); }
.card-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height .5s ease, padding .3s ease;
}
.card.open .card-body {
  max-height: 80000px;
  padding: 0 1.2rem 1.5rem;
}

/* ── Section Internals ────────────────────────────── */
.section-desc {
  font-size: .8rem;
  color: var(--text-dim);
  margin-bottom: 1.2rem;
  line-height: 1.6;
}
h3.sub-heading {
  font-size: .85rem;
  color: var(--primary);
  margin: 1.5rem 0 .8rem;
  font-weight: 600;
}
h3.sub-heading:first-of-type { margin-top: .5rem; }

/* ── Interactive Box ──────────────────────────────── */
.interactive-box {
  background: var(--bg);
  border-radius: 10px;
  padding: 1.2rem;
  margin-bottom: 1.2rem;
  border: 1px solid var(--border);
}
.interactive-box h4 {
  font-size: .82rem;
  color: var(--primary);
  margin-bottom: .8rem;
}

/* ── Buttons ──────────────────────────────────────── */
.btn-row {
  display: flex;
  flex-wrap: wrap;
  gap: .5rem;
  margin-bottom: .8rem;
}
.btn {
  font-family: 'JetBrains Mono', monospace;
  font-size: .72rem;
  padding: .45rem .9rem;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text);
  cursor: pointer;
  transition: all .2s;
}
.btn:hover { border-color: var(--primary); color: #fff; }
.btn.active {
  background: var(--primary-dim);
  border-color: var(--primary);
  color: var(--primary);
}
.btn.correct {
  background: var(--green-dim);
  border-color: var(--green);
  color: var(--green);
}
.btn.incorrect {
  background: var(--pink-dim);
  border-color: var(--pink);
  color: var(--pink);
}
.btn-primary {
  background: var(--primary);
  color: #fff;
  border-color: var(--primary);
  font-weight: 600;
}
.btn-primary:hover { background: #5558e6; }

/* ── Feedback ─────────────────────────────────────── */
.feedback {
  font-size: .75rem;
  padding: .6rem .8rem;
  border-radius: 8px;
  margin-top: .6rem;
  opacity: 0;
  transform: translateY(-8px);
  transition: opacity .3s cubic-bezier(.34,1.56,.64,1), transform .3s cubic-bezier(.34,1.56,.64,1);
  pointer-events: none;
}
.feedback.show {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}
.feedback.correct-fb { background: var(--green-dim); color: var(--green); border: 1px solid var(--green); }
.feedback.incorrect-fb { background: var(--pink-dim); color: var(--pink); border: 1px solid var(--pink); }

/* ── Explanation Block ────────────────────────────── */
.explanation {
  font-size: .78rem;
  color: var(--text);
  background: var(--surface2);
  border-left: 3px solid var(--primary);
  padding: .8rem 1rem;
  border-radius: 0 8px 8px 0;
  margin-bottom: 1.2rem;
  line-height: 1.7;
}

/* ── Formula Display ─────────────────────────────── */
.formula-display {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1rem;
  text-align: center;
  font-size: 1.1rem;
  color: #fff;
  margin-bottom: 1rem;
  font-weight: 600;
  letter-spacing: .03em;
}

/* ── Data Table ──────────────────────────────────── */
.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: .72rem;
  margin-bottom: 1.2rem;
}
.data-table th {
  background: var(--surface2);
  color: var(--primary);
  font-weight: 600;
  text-align: left;
  padding: .6rem .7rem;
  border-bottom: 2px solid var(--border);
  white-space: nowrap;
}
.data-table td {
  padding: .5rem .7rem;
  border-bottom: 1px solid var(--border);
  color: var(--text);
}
.data-table tr:hover td { background: rgba(99,102,241,.05); }

/* ── Input ────────────────────────────────────────── */
.text-input {
  font-family: 'JetBrains Mono', monospace;
  font-size: .8rem;
  padding: .5rem .8rem;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: #fff;
  outline: none;
  width: 100%;
  max-width: 320px;
  transition: border-color .2s;
}
.text-input:focus { border-color: var(--primary); }
.text-input.correct-input { border-color: var(--green); background: var(--green-dim); }
.text-input.incorrect-input { border-color: var(--pink); background: var(--pink-dim); }

.input-row {
  display: flex;
  gap: .6rem;
  align-items: center;
  flex-wrap: wrap;
  margin-bottom: .5rem;
}

/* ── Problem Counter ─────────────────────────────── */
.problem-counter {
  font-size: .7rem;
  color: var(--text-dim);
  margin-bottom: .8rem;
}
.problem-counter span { color: var(--primary); font-weight: 600; }

/* ── Score Display ───────────────────────────────── */
.score-display {
  display: inline-flex;
  align-items: center;
  gap: .4rem;
  font-size: .75rem;
  color: var(--green);
  background: var(--green-dim);
  padding: .3rem .7rem;
  border-radius: 6px;
  margin-left: .5rem;
}

/* ── Chemical Formula Formatting ─────────────────── */
.chem { font-weight: 600; color: #fff; }
.chem sub { font-size: .75em; }
.chem sup { font-size: .7em; color: var(--amber); }

/* ── Breakdown Display ───────────────────────────── */
.ion-breakdown {
  display: flex;
  gap: 1rem;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
  margin: .8rem 0;
  font-size: .8rem;
}
.ion-box {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: .5rem 1rem;
  text-align: center;
}
.ion-box .ion-label {
  font-size: .6rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: .05em;
  margin-bottom: .2rem;
}
.ion-box .ion-value {
  font-weight: 600;
  color: #fff;
}
.ion-box.cation { border-color: var(--blue); }
.ion-box.cation .ion-label { color: var(--blue); }
.ion-box.anion { border-color: var(--pink); }
.ion-box.anion .ion-label { color: var(--pink); }
.ion-arrow { color: var(--text-dim); font-size: 1.2rem; }

/* ── Drag and Drop ───────────────────────────────── */
.drag-container {
  display: flex;
  flex-wrap: wrap;
  gap: .5rem;
  margin-bottom: 1rem;
  min-height: 44px;
}
.drag-item {
  font-family: 'JetBrains Mono', monospace;
  font-size: .72rem;
  padding: .45rem .9rem;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  color: var(--text);
  cursor: grab;
  transition: all .2s cubic-bezier(.34,1.56,.64,1);
  user-select: none;
}
.drag-item:active { cursor: grabbing; transform: scale(1.05); }
.drag-item.matched {
  background: var(--green-dim);
  border-color: var(--green);
  color: var(--green);
  cursor: default;
  opacity: .7;
}

.drop-zone {
  display: flex;
  align-items: center;
  gap: .6rem;
  padding: .5rem .8rem;
  border: 2px dashed var(--border);
  border-radius: 8px;
  margin-bottom: .5rem;
  min-height: 44px;
  transition: all .2s;
}
.drop-zone.drag-over {
  border-color: var(--primary);
  background: var(--primary-dim);
}
.drop-zone.matched {
  border-style: solid;
  border-color: var(--green);
  background: var(--green-dim);
}
.drop-zone.wrong {
  border-color: var(--pink);
  background: var(--pink-dim);
}
.drop-zone .drop-label {
  font-size: .75rem;
  color: var(--text-dim);
  flex: 1;
}
.drop-zone .drop-slot {
  min-width: 100px;
  min-height: 30px;
  border: 1px dashed var(--border);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: .72rem;
  color: var(--text-dim);
  transition: all .2s;
}
.drop-zone.matched .drop-slot {
  border-color: var(--green);
  color: var(--green);
  font-weight: 600;
}

/* ── Flowchart ───────────────────────────────────── */
.flowchart {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: .3rem;
  margin: 1rem 0 1.5rem;
}
.flow-node {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: .5rem 1rem;
  font-size: .72rem;
  text-align: center;
  max-width: 320px;
  width: 100%;
  color: var(--text);
}
.flow-node.decision {
  border-color: var(--amber);
  background: var(--amber-dim);
  color: var(--amber);
  font-weight: 600;
}
.flow-node.result {
  border-color: var(--green);
  color: var(--green);
}
.flow-arrow { color: var(--text-dim); font-size: .9rem; }
.flow-branch {
  display: flex;
  gap: .8rem;
  justify-content: center;
  width: 100%;
}
.flow-branch .flow-node { flex: 1; max-width: 200px; }

/* ── Flash Card ──────────────────────────────────── */
.flash-card {
  background: var(--surface2);
  border: 2px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
  text-align: center;
  margin-bottom: 1rem;
  position: relative;
  min-height: 120px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: border-color .3s cubic-bezier(.34,1.56,.64,1), transform .3s cubic-bezier(.34,1.56,.64,1);
}
.flash-card.correct-card { border-color: var(--green); transform: scale(1.01); }
.flash-card.incorrect-card { border-color: var(--pink); }
.flash-card .fc-label {
  font-size: .65rem;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: .06em;
  margin-bottom: .5rem;
}
.flash-card .fc-ion {
  font-size: 1.3rem;
  font-weight: 700;
  color: #fff;
  margin-bottom: .3rem;
}
.flash-card .fc-charge {
  font-size: .8rem;
  color: var(--amber);
  margin-bottom: .8rem;
}

/* ── Quiz ─────────────────────────────────────────── */
.quiz-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1rem;
  flex-wrap: wrap;
  gap: .5rem;
}
.quiz-score {
  font-size: .85rem;
  color: var(--green);
  font-weight: 600;
}
.quiz-problem {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 1rem 1.2rem;
  margin-bottom: .8rem;
}
.quiz-problem .q-num {
  font-size: .65rem;
  color: var(--text-dim);
  margin-bottom: .4rem;
}
.quiz-problem .q-text {
  font-size: .82rem;
  color: #eee;
  margin-bottom: .6rem;
  line-height: 1.6;
}
.quiz-problem .q-type {
  display: inline-block;
  font-size: .6rem;
  padding: .15rem .5rem;
  border-radius: 4px;
  margin-bottom: .5rem;
}
.q-type.ionic { background: var(--blue-dim); color: var(--blue); }
.q-type.covalent { background: var(--cyan-dim); color: var(--cyan); }
.q-type.acid { background: var(--amber-dim); color: var(--amber); }

/* ── Prefix Reference Table ──────────────────────── */
.prefix-ref {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
  gap: .4rem;
  margin-bottom: 1.2rem;
}
.prefix-item {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: .4rem .6rem;
  font-size: .7rem;
  text-align: center;
}
.prefix-item .prefix-num { color: var(--amber); font-weight: 600; }
.prefix-item .prefix-name { color: var(--text); }

/* ── Section Score Bar ───────────────────────────── */
.section-score {
  display: flex;
  align-items: center;
  gap: .5rem;
  margin-top: 1rem;
  padding: .6rem .8rem;
  background: var(--surface2);
  border-radius: 8px;
  font-size: .75rem;
}
.section-score .score-bar {
  flex: 1;
  height: 6px;
  background: var(--border);
  border-radius: 3px;
  overflow: hidden;
}
.section-score .score-fill {
  height: 100%;
  background: var(--green);
  border-radius: 3px;
  transition: width .4s cubic-bezier(.34,1.56,.64,1);
  width: 0%;
}
.section-score .score-text {
  color: var(--text-dim);
  min-width: 50px;
  text-align: right;
}

/* ── Responsive ──────────────────────────────────── */
@media (max-width: 600px) {
  .page-header { padding: 1.5rem .8rem .8rem; }
  .card-header { padding: .8rem 1rem; }
  .card.open .card-body { padding: 0 1rem 1.2rem; }
  .interactive-box { padding: .8rem; }
  .ion-breakdown { gap: .5rem; }
  .ion-box { padding: .4rem .6rem; }
  .formula-display { font-size: .95rem; padding: .8rem; }
  .text-input { max-width: 100%; }
  .drag-item { font-size: .68rem; padding: .35rem .7rem; }
  .drop-zone { padding: .4rem .6rem; }
  .flow-branch { flex-direction: column; align-items: center; }
  .flash-card { padding: 1rem; }
  .data-table { font-size: .65rem; }
  .data-table th, .data-table td { padding: .4rem .5rem; }
  .prefix-ref { grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); }
  .quiz-problem { padding: .8rem; }
}

/* ── Shake Animation ─────────────────────────────── */
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-6px); }
  40% { transform: translateX(6px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
}
.shake { animation: shake .4s ease; }

/* ── Spring Pop ──────────────────────────────────── */
@keyframes springPop {
  0% { transform: scale(1); }
  40% { transform: scale(1.06); }
  70% { transform: scale(.97); }
  100% { transform: scale(1); }
}
.spring-pop { animation: springPop .4s cubic-bezier(.34,1.56,.64,1); }

/* ── Completion Badge ────────────────────────────── */
.completion-badge {
  display: none;
  align-items: center;
  gap: .4rem;
  font-size: .7rem;
  color: var(--green);
  margin-top: .6rem;
}
.completion-badge.show { display: flex; }
</style>
</head>
<body>

<!-- ═══════════════════════════════════════════════════ -->
<!--  HEADER                                            -->
<!-- ═══════════════════════════════════════════════════ -->
<header class="page-header">
  <h1>Week 6: Chemical Nomenclature</h1>
  <div class="subtitle">Naming ionic compounds, covalent compounds, and acids</div>
</header>

<div class="progress-wrap">
  <div class="progress-bar-outer">
    <div class="progress-bar-inner" id="progressBar"></div>
  </div>
  <div class="progress-label" id="progressLabel">0 / 49 problems completed</div>
</div>

<div class="container">

<!-- ═══════════════════════════════════════════════════ -->
<!--  SECTION 1: IONIC COMPOUND NAMING                  -->
<!-- ═══════════════════════════════════════════════════ -->
<div class="card open" id="card1">
  <div class="card-header" onclick="toggleCard('card1')">
    <div class="num">1</div>
    <div class="title">Ionic Compound Naming</div>
    <div class="chevron">&#9662;</div>
  </div>
  <div class="card-body">
    <p class="section-desc">
      Ionic compounds form between metals (cations) and nonmetals (anions). The metal name comes first, followed by the nonmetal with an <strong>-ide</strong> ending. Transition metals require Roman numerals to indicate their charge.
    </p>

    <div class="explanation">
      <strong>Rules:</strong><br>
      1. Name the metal cation first (unchanged)<br>
      2. Name the nonmetal anion with <span style="color:var(--amber)">-ide</span> suffix<br>
      3. Transition metals: add Roman numeral for charge &mdash; e.g., Fe<sup>2+</sup> = iron(II), Fe<sup>3+</sup> = iron(III)<br>
      4. For polyatomic ions, use the ion's name directly
    </div>

    <h3 class="sub-heading">Practice Problems</h3>

    <div class="interactive-box" id="ionic-practice">
      <div class="problem-counter">Problem <span id="ionic-current">1</span> of <span>8</span>
        <span class="score-display" id="ionic-score-display">0/0</span>
      </div>
      <div class="formula-display" id="ionic-prompt"></div>
      <div class="ion-breakdown" id="ionic-breakdown"></div>
      <div class="input-row">
        <input type="text" class="text-input" id="ionic-input" placeholder="Type the answer..." autocomplete="off" spellcheck="false">
        <button class="btn btn-primary" onclick="checkIonic()">Check</button>
        <button class="btn" onclick="skipIonic()" style="color:var(--text-dim)">Skip</button>
      </div>
      <div class="feedback" id="ionic-feedback"></div>
      <div class="section-score" id="ionic-score-bar">
        <span style="color:var(--text-dim)">Score:</span>
        <div class="score-bar"><div class="score-fill" id="ionic-fill"></div></div>
        <span class="score-text" id="ionic-score-text">0/8</span>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════════ -->
<!--  SECTION 2: COVALENT COMPOUND NAMING               -->
<!-- ═══════════════════════════════════════════════════ -->
<div class="card" id="card2">
  <div class="card-header" onclick="toggleCard('card2')">
    <div class="num">2</div>
    <div class="title">Covalent Compound Naming</div>
    <div class="chevron">&#9662;</div>
  </div>
  <div class="card-body">
    <p class="section-desc">
      Covalent (molecular) compounds form between two nonmetals. Use Greek prefixes to indicate the number of each atom. Drop the "a" or "o" prefix before "oxide."
    </p>

    <h3 class="sub-heading">Prefix Reference</h3>
    <div class="prefix-ref">
      <div class="prefix-item"><span class="prefix-num">1</span> <span class="prefix-name">mono</span></div>
      <div class="prefix-item"><span class="prefix-num">2</span> <span class="prefix-name">di</span></div>
      <div class="prefix-item"><span class="prefix-num">3</span> <span class="prefix-name">tri</span></div>
      <div class="prefix-item"><span class="prefix-num">4</span> <span class="prefix-name">tetra</span></div>
      <div class="prefix-item"><span class="prefix-num">5</span> <span class="prefix-name">penta</span></div>
      <div class="prefix-item"><span class="prefix-num">6</span> <span class="prefix-name">hexa</span></div>
      <div class="prefix-item"><span class="prefix-num">7</span> <span class="prefix-name">hepta</span></div>
      <div class="prefix-item"><span class="prefix-num">8</span> <span class="prefix-name">octa</span></div>
      <div class="prefix-item"><span class="prefix-num">9</span> <span class="prefix-name">nona</span></div>
      <div class="prefix-item"><span class="prefix-num">10</span> <span class="prefix-name">deca</span></div>
    </div>

    <div class="explanation">
      <strong>Rules:</strong><br>
      1. First element: prefix (skip "mono" for the first element) + element name<br>
      2. Second element: prefix + root + <span style="color:var(--amber)">-ide</span><br>
      3. Drop trailing "a" or "o" from prefix before "oxide" (e.g., "monoxide" not "monooxide")
    </div>

    <h3 class="sub-heading">Drag and Match</h3>

    <div class="interactive-box" id="covalent-match">
      <h4>Drag each formula to its correct name</h4>
      <div class="drag-container" id="cov-drag-items"></div>
      <div id="cov-drop-zones"></div>
      <div class="feedback" id="cov-match-feedback"></div>
    </div>

    <h3 class="sub-heading">Practice Problems</h3>

    <div class="interactive-box" id="covalent-practice">
      <div class="problem-counter">Problem <span id="cov-current">1</span> of <span>8</span>
        <span class="score-display" id="cov-score-display">0/0</span>
      </div>
      <div class="formula-display" id="cov-prompt"></div>
      <div class="input-row">
        <input type="text" class="text-input" id="cov-input" placeholder="Type the answer..." autocomplete="off" spellcheck="false">
        <button class="btn btn-primary" onclick="checkCovalent()">Check</button>
        <button class="btn" onclick="skipCovalent()" style="color:var(--text-dim)">Skip</button>
      </div>
      <div class="feedback" id="cov-feedback"></div>
      <div class="section-score" id="cov-score-bar">
        <span style="color:var(--text-dim)">Score:</span>
        <div class="score-bar"><div class="score-fill" id="cov-fill"></div></div>
        <span class="score-text" id="cov-score-text">0/8</span>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════════ -->
<!--  SECTION 3: ACID NAMING                            -->
<!-- ═══════════════════════════════════════════════════ -->
<div class="card" id="card3">
  <div class="card-header" onclick="toggleCard('card3')">
    <div class="num">3</div>
    <div class="title">Acid Naming</div>
    <div class="chevron">&#9662;</div>
  </div>
  <div class="card-body">
    <p class="section-desc">
      Acids start with hydrogen (H). Naming depends on whether the anion contains oxygen. Binary acids use "hydro-" prefix; oxyacids change the anion suffix.
    </p>

    <h3 class="sub-heading">Acid Naming Flowchart</h3>

    <div class="flowchart">
      <div class="flow-node decision">Does the acid contain oxygen?</div>
      <div class="flow-arrow">&#9660;</div>
      <div class="flow-branch">
        <div style="display:flex;flex-direction:column;align-items:center;gap:.3rem;flex:1">
          <div style="font-size:.65rem;color:var(--pink);font-weight:600">NO</div>
          <div class="flow-node result">
            <strong>Binary Acid</strong><br>
            hydro + root + <span style="color:var(--amber)">-ic</span> acid<br>
            <span style="color:var(--text-dim)">HCl &rarr; hydrochloric acid</span>
          </div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:center;gap:.3rem;flex:1">
          <div style="font-size:.65rem;color:var(--green);font-weight:600">YES</div>
          <div class="flow-node decision" style="font-size:.68rem">Anion ends in -ate or -ite?</div>
          <div class="flow-arrow">&#9660;</div>
          <div class="flow-branch">
            <div style="display:flex;flex-direction:column;align-items:center;gap:.3rem;flex:1">
              <div style="font-size:.6rem;color:var(--blue);font-weight:600">-ate</div>
              <div class="flow-node result" style="font-size:.68rem">
                root + <span style="color:var(--amber)">-ic</span> acid<br>
                <span style="color:var(--text-dim)">sulfate &rarr; sulfuric acid</span>
              </div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:center;gap:.3rem;flex:1">
              <div style="font-size:.6rem;color:var(--cyan);font-weight:600">-ite</div>
              <div class="flow-node result" style="font-size:.68rem">
                root + <span style="color:var(--amber)">-ous</span> acid<br>
                <span style="color:var(--text-dim)">sulfite &rarr; sulfurous acid</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="explanation">
      <strong>The chlorine series (HClO through HClO<sub>4</sub>):</strong><br>
      HCl &rarr; hydrochloric acid (binary)<br>
      HClO &rarr; hypochlorous acid (hypo- + -ite &rarr; -ous)<br>
      HClO<sub>2</sub> &rarr; chlorous acid (-ite &rarr; -ous)<br>
      HClO<sub>3</sub> &rarr; chloric acid (-ate &rarr; -ic)<br>
      HClO<sub>4</sub> &rarr; perchloric acid (per- + -ate &rarr; -ic)
    </div>

    <h3 class="sub-heading">Practice Problems</h3>

    <div class="interactive-box" id="acid-practice">
      <div class="problem-counter">Problem <span id="acid-current">1</span> of <span>8</span>
        <span class="score-display" id="acid-score-display">0/0</span>
      </div>
      <div class="formula-display" id="acid-prompt"></div>
      <div class="input-row">
        <input type="text" class="text-input" id="acid-input" placeholder="Type the answer..." autocomplete="off" spellcheck="false">
        <button class="btn btn-primary" onclick="checkAcid()">Check</button>
        <button class="btn" onclick="skipAcid()" style="color:var(--text-dim)">Skip</button>
      </div>
      <div class="feedback" id="acid-feedback"></div>
      <div class="section-score" id="acid-score-bar">
        <span style="color:var(--text-dim)">Score:</span>
        <div class="score-bar"><div class="score-fill" id="acid-fill"></div></div>
        <span class="score-text" id="acid-score-text">0/8</span>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════════ -->
<!--  SECTION 4: POLYATOMIC IONS                        -->
<!-- ═══════════════════════════════════════════════════ -->
<div class="card" id="card4">
  <div class="card-header" onclick="toggleCard('card4')">
    <div class="num">4</div>
    <div class="title">Polyatomic Ions</div>
    <div class="chevron">&#9662;</div>
  </div>
  <div class="card-body">
    <p class="section-desc">
      Polyatomic ions are groups of atoms that carry a charge. You must memorize these. Notice the <strong>-ate / -ite</strong> pattern: -ate has one more oxygen than -ite.
    </p>

    <h3 class="sub-heading">Reference Table</h3>

    <table class="data-table" id="poly-table">
      <thead>
        <tr><th>Name</th><th>Formula</th><th>Charge</th><th>Pattern</th></tr>
      </thead>
      <tbody id="poly-table-body"></tbody>
    </table>

    <h3 class="sub-heading">Flash Cards</h3>

    <div class="interactive-box" id="flash-practice">
      <div class="problem-counter">Card <span id="flash-current">1</span> of <span>10</span>
        <span class="score-display" id="flash-score-display">0/0</span>
      </div>
      <div class="flash-card" id="flash-card">
        <div class="fc-label" id="fc-mode-label">Name this ion</div>
        <div class="fc-ion" id="fc-ion-display"></div>
        <div class="fc-charge" id="fc-charge-hint"></div>
      </div>
      <div class="input-row">
        <input type="text" class="text-input" id="flash-input" placeholder="Type formula and charge (e.g., SO4 2-)" autocomplete="off" spellcheck="false">
        <button class="btn btn-primary" onclick="checkFlash()">Check</button>
        <button class="btn" onclick="skipFlash()" style="color:var(--text-dim)">Skip</button>
      </div>
      <div class="feedback" id="flash-feedback"></div>
      <div class="section-score" id="flash-score-bar">
        <span style="color:var(--text-dim)">Score:</span>
        <div class="score-bar"><div class="score-fill" id="flash-fill"></div></div>
        <span class="score-text" id="flash-score-text">0/10</span>
      </div>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════════ -->
<!--  SECTION 5: QUICK QUIZ                             -->
<!-- ═══════════════════════════════════════════════════ -->
<div class="card" id="card5">
  <div class="card-header" onclick="toggleCard('card5')">
    <div class="num">5</div>
    <div class="title">Quick Quiz</div>
    <div class="chevron">&#9662;</div>
  </div>
  <div class="card-body">
    <p class="section-desc">
      15 mixed nomenclature problems covering ionic, covalent, and acid naming. Some ask formula &rarr; name, others name &rarr; formula.
    </p>

    <div class="interactive-box" id="quiz-section">
      <div class="quiz-header">
        <div class="problem-counter">Question <span id="quiz-current">1</span> of <span>15</span></div>
        <div class="quiz-score" id="quiz-score">Score: 0 / 0</div>
      </div>
      <div class="quiz-problem" id="quiz-problem">
        <div class="q-type" id="quiz-type-badge"></div>
        <div class="q-text" id="quiz-text"></div>
        <div class="input-row">
          <input type="text" class="text-input" id="quiz-input" placeholder="Type your answer..." autocomplete="off" spellcheck="false">
          <button class="btn btn-primary" onclick="checkQuiz()">Check</button>
          <button class="btn" onclick="skipQuiz()" style="color:var(--text-dim)">Skip</button>
        </div>
      </div>
      <div class="feedback" id="quiz-feedback"></div>
      <div class="section-score" id="quiz-score-bar">
        <span style="color:var(--text-dim)">Score:</span>
        <div class="score-bar"><div class="score-fill" id="quiz-fill"></div></div>
        <span class="score-text" id="quiz-score-text">0/15</span>
      </div>
    </div>
  </div>
</div>

</div><!-- /container -->

<!-- ═══════════════════════════════════════════════════ -->
<!--  JAVASCRIPT                                        -->
<!-- ═══════════════════════════════════════════════════ -->
<script>
/* ── Globals ──────────────────────────────────────── */
const totalProblems = 49;
let solvedTotal = 0;
const sectionComplete = { s1: false, s2: false, s3: false, s4: false, s5: false };

function updateProgress() {
  const pct = Math.round((solvedTotal / totalProblems) * 100);
  document.getElementById('progressBar').style.width = pct + '%';
  document.getElementById('progressLabel').textContent = solvedTotal + ' / ' + totalProblems + ' problems completed';
}

/* ── Card Toggle ─────────────────────────────────── */
function toggleCard(id) {
  const card = document.getElementById(id);
  card.classList.toggle('open');
}

/* ── Helper: format chemical formula as HTML ─────── */
function chemHTML(str) {
  return str
    .replace(/(\d+)([+-])/g, '<sup>$1$2</sup>')
    .replace(/([A-Za-z)])(\d+)/g, '$1<sub>$2</sub>')
    .replace(/\^(\d*[+-])/g, '<sup>$1</sup>');
}

/* ── Helper: normalize answer string ─────────────── */
function norm(s) {
  return s.trim().toLowerCase()
    .replace(/\s+/g, ' ')
    .replace(/\(/g, '(')
    .replace(/\)/g, ')')
    .replace(/[''`]/g, '')
    .replace(/\u2013/g, '-')
    .replace(/\u2014/g, '-');
}

/* ── Helper: show feedback ───────────────────────── */
function showFeedback(elId, isCorrect, msg) {
  const el = document.getElementById(elId);
  el.className = 'feedback show ' + (isCorrect ? 'correct-fb' : 'incorrect-fb');
  el.innerHTML = msg;
}

function clearFeedback(elId) {
  const el = document.getElementById(elId);
  el.className = 'feedback';
  el.innerHTML = '';
}

/* ── Helper: spring pop animation ────────────────── */
function springPop(el) {
  el.classList.remove('spring-pop');
  void el.offsetWidth;
  el.classList.add('spring-pop');
}

function shakeEl(el) {
  el.classList.remove('shake');
  void el.offsetWidth;
  el.classList.add('shake');
}

/* ── Helper: mark input correct/incorrect ────────── */
function markInput(inputEl, isCorrect) {
  inputEl.classList.remove('correct-input', 'incorrect-input');
  inputEl.classList.add(isCorrect ? 'correct-input' : 'incorrect-input');
  if (isCorrect) {
    springPop(inputEl);
  } else {
    shakeEl(inputEl);
  }
  setTimeout(() => inputEl.classList.remove('correct-input', 'incorrect-input'), 1500);
}

/* ── Helper: update section score ────────────────── */
function updateSectionScore(fillId, textId, correct, total) {
  document.getElementById(fillId).style.width = (total > 0 ? (correct / total * 100) : 0) + '%';
  document.getElementById(textId).textContent = correct + '/' + total;
}

/* ── Helper: mark section complete ───────────────── */
function markSectionComplete(cardId, sectionKey) {
  if (!sectionComplete[sectionKey]) {
    sectionComplete[sectionKey] = true;
    document.getElementById(cardId).classList.add('completed');
  }
}

/* ═══════════════════════════════════════════════════ */
/*  SECTION 1: IONIC COMPOUNDS                        */
/* ═══════════════════════════════════════════════════ */
const ionicProblems = [
  {
    prompt: 'Name this compound: NaCl',
    promptHTML: 'NaCl',
    answer: ['sodium chloride'],
    cation: { label: 'Cation', value: 'Na<sup>+</sup>', name: 'Sodium' },
    anion: { label: 'Anion', value: 'Cl<sup>-</sup>', name: 'Chloride' },
    explanation: 'Sodium (Na+) + Chloride (Cl-) = sodium chloride'
  },
  {
    prompt: 'Name this compound: MgO',
    promptHTML: 'MgO',
    answer: ['magnesium oxide'],
    cation: { label: 'Cation', value: 'Mg<sup>2+</sup>', name: 'Magnesium' },
    anion: { label: 'Anion', value: 'O<sup>2-</sup>', name: 'Oxide' },
    explanation: 'Magnesium (Mg2+) + Oxide (O2-) = magnesium oxide'
  },
  {
    prompt: 'Name this compound: Al2O3',
    promptHTML: 'Al<sub>2</sub>O<sub>3</sub>',
    answer: ['aluminum oxide', 'aluminium oxide'],
    cation: { label: 'Cation', value: 'Al<sup>3+</sup>', name: 'Aluminum' },
    anion: { label: 'Anion', value: 'O<sup>2-</sup>', name: 'Oxide' },
    explanation: '2 Al3+ ions balance 3 O2- ions (total charge: 6+ and 6-)'
  },
  {
    prompt: 'Name this compound: FeCl2',
    promptHTML: 'FeCl<sub>2</sub>',
    answer: ['iron(ii) chloride', 'iron (ii) chloride'],
    cation: { label: 'Cation', value: 'Fe<sup>2+</sup>', name: 'Iron(II)' },
    anion: { label: 'Anion', value: 'Cl<sup>-</sup>', name: 'Chloride' },
    explanation: 'Fe with 2 Cl- ions means Fe2+ &rarr; iron(II) chloride'
  },
  {
    prompt: 'Name this compound: FeCl3',
    promptHTML: 'FeCl<sub>3</sub>',
    answer: ['iron(iii) chloride', 'iron (iii) chloride'],
    cation: { label: 'Cation', value: 'Fe<sup>3+</sup>', name: 'Iron(III)' },
    anion: { label: 'Anion', value: 'Cl<sup>-</sup>', name: 'Chloride' },
    explanation: 'Fe with 3 Cl- ions means Fe3+ &rarr; iron(III) chloride'
  },
  {
    prompt: 'Write the formula for: calcium fluoride',
    promptHTML: 'calcium fluoride',
    answer: ['caf2'],
    cation: { label: 'Cation', value: 'Ca<sup>2+</sup>', name: 'Calcium' },
    anion: { label: 'Anion', value: 'F<sup>-</sup>', name: 'Fluoride' },
    explanation: 'Ca2+ needs 2 F- ions to balance &rarr; CaF2'
  },
  {
    prompt: 'Write the formula for: copper(II) sulfide',
    promptHTML: 'copper(II) sulfide',
    answer: ['cus'],
    cation: { label: 'Cation', value: 'Cu<sup>2+</sup>', name: 'Copper(II)' },
    anion: { label: 'Anion', value: 'S<sup>2-</sup>', name: 'Sulfide' },
    explanation: 'Cu2+ and S2- balance 1:1 &rarr; CuS'
  },
  {
    prompt: 'Write the formula for: tin(IV) oxide',
    promptHTML: 'tin(IV) oxide',
    answer: ['sno2'],
    cation: { label: 'Cation', value: 'Sn<sup>4+</sup>', name: 'Tin(IV)' },
    anion: { label: 'Anion', value: 'O<sup>2-</sup>', name: 'Oxide' },
    explanation: 'Sn4+ needs 2 O2- ions to balance &rarr; SnO2'
  }
];

let ionicIdx = 0, ionicCorrect = 0, ionicAttempted = 0;

function loadIonic() {
  if (ionicIdx >= ionicProblems.length) {
    markSectionComplete('card1', 's1');
    return;
  }
  const p = ionicProblems[ionicIdx];
  document.getElementById('ionic-current').textContent = ionicIdx + 1;
  document.getElementById('ionic-prompt').innerHTML = p.promptHTML;
  document.getElementById('ionic-breakdown').innerHTML =
    '<div class="ion-box cation"><div class="ion-label">' + p.cation.label + '</div><div class="ion-value">' + p.cation.value + ' ' + p.cation.name + '</div></div>' +
    '<div class="ion-arrow">+</div>' +
    '<div class="ion-box anion"><div class="ion-label">' + p.anion.label + '</div><div class="ion-value">' + p.anion.value + ' ' + p.anion.name + '</div></div>';
  document.getElementById('ionic-input').value = '';
  document.getElementById('ionic-input').classList.remove('correct-input', 'incorrect-input');
  clearFeedback('ionic-feedback');
  document.getElementById('ionic-input').focus();
}

function checkIonic() {
  const input = document.getElementById('ionic-input');
  const val = norm(input.value);
  if (!val) return;
  const p = ionicProblems[ionicIdx];
  const correct = p.answer.some(a => norm(a) === val);
  ionicAttempted++;
  if (correct) {
    ionicCorrect++;
    solvedTotal++;
    updateProgress();
    showFeedback('ionic-feedback', true, 'Correct! ' + p.explanation);
    markInput(input, true);
  } else {
    showFeedback('ionic-feedback', false, 'Not quite. The answer is <strong>' + p.answer[0] + '</strong>. ' + p.explanation);
    markInput(input, false);
    solvedTotal++;
    updateProgress();
  }
  document.getElementById('ionic-score-display').textContent = ionicCorrect + '/' + ionicAttempted;
  updateSectionScore('ionic-fill', 'ionic-score-text', ionicCorrect, ionicProblems.length);
  ionicIdx++;
  setTimeout(() => loadIonic(), 1500);
}

function skipIonic() {
  const p = ionicProblems[ionicIdx];
  ionicAttempted++;
  solvedTotal++;
  updateProgress();
  showFeedback('ionic-feedback', false, 'Skipped. The answer is <strong>' + p.answer[0] + '</strong>. ' + p.explanation);
  document.getElementById('ionic-score-display').textContent = ionicCorrect + '/' + ionicAttempted;
  updateSectionScore('ionic-fill', 'ionic-score-text', ionicCorrect, ionicProblems.length);
  ionicIdx++;
  setTimeout(() => loadIonic(), 1500);
}

/* ═══════════════════════════════════════════════════ */
/*  SECTION 2: COVALENT COMPOUNDS                     */
/* ═══════════════════════════════════════════════════ */

/* -- Drag and Match Game -- */
const covMatchData = [
  { formula: 'CO', formulaHTML: 'CO', name: 'carbon monoxide' },
  { formula: 'CO2', formulaHTML: 'CO<sub>2</sub>', name: 'carbon dioxide' },
  { formula: 'N2O4', formulaHTML: 'N<sub>2</sub>O<sub>4</sub>', name: 'dinitrogen tetroxide' },
  { formula: 'PCl5', formulaHTML: 'PCl<sub>5</sub>', name: 'phosphorus pentachloride' },
  { formula: 'SF6', formulaHTML: 'SF<sub>6</sub>', name: 'sulfur hexafluoride' }
];

let covMatchCount = 0;
let draggedItem = null;

function initCovMatch() {
  const dragC = document.getElementById('cov-drag-items');
  const dropC = document.getElementById('cov-drop-zones');
  dragC.innerHTML = '';
  dropC.innerHTML = '';

  // Shuffle formulas
  const shuffled = [...covMatchData].sort(() => Math.random() - 0.5);

  shuffled.forEach(item => {
    const el = document.createElement('div');
    el.className = 'drag-item';
    el.innerHTML = item.formulaHTML;
    el.setAttribute('data-formula', item.formula);
    el.draggable = true;
    el.addEventListener('dragstart', e => {
      draggedItem = el;
      e.dataTransfer.setData('text/plain', item.formula);
      setTimeout(() => el.style.opacity = '0.5', 0);
    });
    el.addEventListener('dragend', () => {
      el.style.opacity = '1';
      draggedItem = null;
    });
    // Touch support
    el.addEventListener('touchstart', e => {
      draggedItem = el;
      el.style.opacity = '0.7';
    }, { passive: true });
    el.addEventListener('touchend', e => {
      el.style.opacity = '1';
      const touch = e.changedTouches[0];
      const target = document.elementFromPoint(touch.clientX, touch.clientY);
      if (target) {
        const zone = target.closest('.drop-zone');
        if (zone && !zone.classList.contains('matched')) {
          handleDrop(zone, el.getAttribute('data-formula'));
        }
      }
      draggedItem = null;
    });
    dragC.appendChild(el);
  });

  // Shuffle names for drop zones
  const nameShuffled = [...covMatchData].sort(() => Math.random() - 0.5);
  nameShuffled.forEach(item => {
    const zone = document.createElement('div');
    zone.className = 'drop-zone';
    zone.setAttribute('data-correct', item.formula);
    zone.innerHTML = '<span class="drop-label">' + item.name + '</span><span class="drop-slot">drop here</span>';
    zone.addEventListener('dragover', e => {
      e.preventDefault();
      zone.classList.add('drag-over');
    });
    zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
    zone.addEventListener('drop', e => {
      e.preventDefault();
      zone.classList.remove('drag-over');
      const formula = e.dataTransfer.getData('text/plain');
      handleDrop(zone, formula);
    });
    dropC.appendChild(zone);
  });
}

function handleDrop(zone, formula) {
  if (zone.classList.contains('matched')) return;
  const correct = zone.getAttribute('data-correct');
  if (formula === correct) {
    zone.classList.add('matched');
    zone.querySelector('.drop-slot').innerHTML = chemHTML(formula);
    // Mark drag item
    const items = document.querySelectorAll('.drag-item');
    items.forEach(it => {
      if (it.getAttribute('data-formula') === formula) it.classList.add('matched');
    });
    covMatchCount++;
    solvedTotal++;
    updateProgress();
    springPop(zone);
    if (covMatchCount === covMatchData.length) {
      showFeedback('cov-match-feedback', true, 'All matched correctly! Well done.');
    }
  } else {
    zone.classList.add('wrong');
    shakeEl(zone);
    setTimeout(() => zone.classList.remove('wrong'), 800);
  }
}

/* -- Covalent Practice Problems -- */
const covProblems = [
  { prompt: 'Name: N2O5', promptHTML: 'N<sub>2</sub>O<sub>5</sub>', answer: ['dinitrogen pentoxide', 'dinitrogen pentaoxide'], explanation: '2 nitrogen (di-) + 5 oxygen (penta- + oxide)' },
  { prompt: 'Name: P4O10', promptHTML: 'P<sub>4</sub>O<sub>10</sub>', answer: ['tetraphosphorus decoxide', 'tetraphosphorus decaoxide'], explanation: '4 phosphorus (tetra-) + 10 oxygen (deca- + oxide)' },
  { prompt: 'Name: SO3', promptHTML: 'SO<sub>3</sub>', answer: ['sulfur trioxide'], explanation: '1 sulfur (no prefix for first) + 3 oxygen (tri- + oxide)' },
  { prompt: 'Name: CCl4', promptHTML: 'CCl<sub>4</sub>', answer: ['carbon tetrachloride'], explanation: '1 carbon + 4 chlorine (tetra- + chloride)' },
  { prompt: 'Formula: diboron trioxide', promptHTML: 'diboron trioxide', answer: ['b2o3'], explanation: 'di = 2 boron, tri = 3 oxygen &rarr; B2O3' },
  { prompt: 'Formula: nitrogen trifluoride', promptHTML: 'nitrogen trifluoride', answer: ['nf3'], explanation: '1 nitrogen + 3 fluorine &rarr; NF3' },
  { prompt: 'Name: IF7', promptHTML: 'IF<sub>7</sub>', answer: ['iodine heptafluoride'], explanation: '1 iodine + 7 fluorine (hepta- + fluoride)' },
  { prompt: 'Formula: diphosphorus pentoxide', promptHTML: 'diphosphorus pentoxide', answer: ['p2o5'], explanation: 'di = 2 phosphorus, penta = 5 oxygen &rarr; P2O5' }
];

let covIdx = 0, covCorrect = 0, covAttempted = 0;

function loadCovalent() {
  if (covIdx >= covProblems.length) {
    markSectionComplete('card2', 's2');
    return;
  }
  const p = covProblems[covIdx];
  document.getElementById('cov-current').textContent = covIdx + 1;
  document.getElementById('cov-prompt').innerHTML = p.promptHTML;
  document.getElementById('cov-input').value = '';
  document.getElementById('cov-input').classList.remove('correct-input', 'incorrect-input');
  clearFeedback('cov-feedback');
  document.getElementById('cov-input').focus();
}

function checkCovalent() {
  const input = document.getElementById('cov-input');
  const val = norm(input.value);
  if (!val) return;
  const p = covProblems[covIdx];
  const correct = p.answer.some(a => norm(a) === val);
  covAttempted++;
  if (correct) {
    covCorrect++;
    solvedTotal++;
    updateProgress();
    showFeedback('cov-feedback', true, 'Correct! ' + p.explanation);
    markInput(input, true);
  } else {
    showFeedback('cov-feedback', false, 'Not quite. Answer: <strong>' + p.answer[0] + '</strong>. ' + p.explanation);
    markInput(input, false);
    solvedTotal++;
    updateProgress();
  }
  document.getElementById('cov-score-display').textContent = covCorrect + '/' + covAttempted;
  updateSectionScore('cov-fill', 'cov-score-text', covCorrect, covProblems.length);
  covIdx++;
  setTimeout(() => loadCovalent(), 1500);
}

function skipCovalent() {
  const p = covProblems[covIdx];
  covAttempted++;
  solvedTotal++;
  updateProgress();
  showFeedback('cov-feedback', false, 'Skipped. Answer: <strong>' + p.answer[0] + '</strong>. ' + p.explanation);
  document.getElementById('cov-score-display').textContent = covCorrect + '/' + covAttempted;
  updateSectionScore('cov-fill', 'cov-score-text', covCorrect, covProblems.length);
  covIdx++;
  setTimeout(() => loadCovalent(), 1500);
}

/* ═══════════════════════════════════════════════════ */
/*  SECTION 3: ACID NAMING                            */
/* ═══════════════════════════════════════════════════ */
const acidProblems = [
  { prompt: 'Name: HCl (aq)', promptHTML: 'HCl <span style="color:var(--text-dim)">(aq)</span>', answer: ['hydrochloric acid'], explanation: 'Binary acid: hydro- + chlor- + -ic acid' },
  { prompt: 'Name: H2SO4', promptHTML: 'H<sub>2</sub>SO<sub>4</sub>', answer: ['sulfuric acid'], explanation: 'From sulfate (SO4 2-): -ate &rarr; -ic acid' },
  { prompt: 'Name: HNO3', promptHTML: 'HNO<sub>3</sub>', answer: ['nitric acid'], explanation: 'From nitrate (NO3-): -ate &rarr; -ic acid' },
  { prompt: 'Name: H3PO4', promptHTML: 'H<sub>3</sub>PO<sub>4</sub>', answer: ['phosphoric acid'], explanation: 'From phosphate (PO4 3-): -ate &rarr; -ic acid' },
  { prompt: 'Name: HClO', promptHTML: 'HClO', answer: ['hypochlorous acid'], explanation: 'From hypochlorite (ClO-): hypo- + -ite &rarr; hypo- + -ous acid' },
  { prompt: 'Name: HClO2', promptHTML: 'HClO<sub>2</sub>', answer: ['chlorous acid'], explanation: 'From chlorite (ClO2-): -ite &rarr; -ous acid' },
  { prompt: 'Name: HClO3', promptHTML: 'HClO<sub>3</sub>', answer: ['chloric acid'], explanation: 'From chlorate (ClO3-): -ate &rarr; -ic acid' },
  { prompt: 'Name: HClO4', promptHTML: 'HClO<sub>4</sub>', answer: ['perchloric acid'], explanation: 'From perchlorate (ClO4-): per- + -ate &rarr; per- + -ic acid' }
];

let acidIdx = 0, acidCorrect = 0, acidAttempted = 0;

function loadAcid() {
  if (acidIdx >= acidProblems.length) {
    markSectionComplete('card3', 's3');
    return;
  }
  const p = acidProblems[acidIdx];
  document.getElementById('acid-current').textContent = acidIdx + 1;
  document.getElementById('acid-prompt').innerHTML = p.promptHTML;
  document.getElementById('acid-input').value = '';
  document.getElementById('acid-input').classList.remove('correct-input', 'incorrect-input');
  clearFeedback('acid-feedback');
  document.getElementById('acid-input').focus();
}

function checkAcid() {
  const input = document.getElementById('acid-input');
  const val = norm(input.value);
  if (!val) return;
  const p = acidProblems[acidIdx];
  const correct = p.answer.some(a => norm(a) === val);
  acidAttempted++;
  if (correct) {
    acidCorrect++;
    solvedTotal++;
    updateProgress();
    showFeedback('acid-feedback', true, 'Correct! ' + p.explanation);
    markInput(input, true);
  } else {
    showFeedback('acid-feedback', false, 'Not quite. Answer: <strong>' + p.answer[0] + '</strong>. ' + p.explanation);
    markInput(input, false);
    solvedTotal++;
    updateProgress();
  }
  document.getElementById('acid-score-display').textContent = acidCorrect + '/' + acidAttempted;
  updateSectionScore('acid-fill', 'acid-score-text', acidCorrect, acidProblems.length);
  acidIdx++;
  setTimeout(() => loadAcid(), 1500);
}

function skipAcid() {
  const p = acidProblems[acidIdx];
  acidAttempted++;
  solvedTotal++;
  updateProgress();
  showFeedback('acid-feedback', false, 'Skipped. Answer: <strong>' + p.answer[0] + '</strong>. ' + p.explanation);
  document.getElementById('acid-score-display').textContent = acidCorrect + '/' + acidAttempted;
  updateSectionScore('acid-fill', 'acid-score-text', acidCorrect, acidProblems.length);
  acidIdx++;
  setTimeout(() => loadAcid(), 1500);
}

/* ═══════════════════════════════════════════════════ */
/*  SECTION 4: POLYATOMIC IONS                        */
/* ═══════════════════════════════════════════════════ */
const polyIons = [
  { name: 'Sulfate', formula: 'SO4', charge: '2-', formulaHTML: 'SO<sub>4</sub><sup>2-</sup>', pattern: '-ate (more O)' },
  { name: 'Sulfite', formula: 'SO3', charge: '2-', formulaHTML: 'SO<sub>3</sub><sup>2-</sup>', pattern: '-ite (less O)' },
  { name: 'Nitrate', formula: 'NO3', charge: '1-', formulaHTML: 'NO<sub>3</sub><sup>-</sup>', pattern: '-ate (more O)' },
  { name: 'Nitrite', formula: 'NO2', charge: '1-', formulaHTML: 'NO<sub>2</sub><sup>-</sup>', pattern: '-ite (less O)' },
  { name: 'Carbonate', formula: 'CO3', charge: '2-', formulaHTML: 'CO<sub>3</sub><sup>2-</sup>', pattern: '-ate' },
  { name: 'Phosphate', formula: 'PO4', charge: '3-', formulaHTML: 'PO<sub>4</sub><sup>3-</sup>', pattern: '-ate' },
  { name: 'Hydroxide', formula: 'OH', charge: '1-', formulaHTML: 'OH<sup>-</sup>', pattern: 'unique' },
  { name: 'Ammonium', formula: 'NH4', charge: '1+', formulaHTML: 'NH<sub>4</sub><sup>+</sup>', pattern: 'cation' },
  { name: 'Acetate', formula: 'C2H3O2', charge: '1-', formulaHTML: 'C<sub>2</sub>H<sub>3</sub>O<sub>2</sub><sup>-</sup>', pattern: '-ate' },
  { name: 'Permanganate', formula: 'MnO4', charge: '1-', formulaHTML: 'MnO<sub>4</sub><sup>-</sup>', pattern: '-ate' },
  { name: 'Chromate', formula: 'CrO4', charge: '2-', formulaHTML: 'CrO<sub>4</sub><sup>2-</sup>', pattern: '-ate' },
  { name: 'Dichromate', formula: 'Cr2O7', charge: '2-', formulaHTML: 'Cr<sub>2</sub>O<sub>7</sub><sup>2-</sup>', pattern: 'di- prefix' },
  { name: 'Perchlorate', formula: 'ClO4', charge: '1-', formulaHTML: 'ClO<sub>4</sub><sup>-</sup>', pattern: 'per-...-ate' },
  { name: 'Chlorate', formula: 'ClO3', charge: '1-', formulaHTML: 'ClO<sub>3</sub><sup>-</sup>', pattern: '-ate' },
  { name: 'Chlorite', formula: 'ClO2', charge: '1-', formulaHTML: 'ClO<sub>2</sub><sup>-</sup>', pattern: '-ite' },
  { name: 'Hypochlorite', formula: 'ClO', charge: '1-', formulaHTML: 'ClO<sup>-</sup>', pattern: 'hypo-...-ite' },
  { name: 'Bicarbonate', formula: 'HCO3', charge: '1-', formulaHTML: 'HCO<sub>3</sub><sup>-</sup>', pattern: 'hydrogen + -ate' },
  { name: 'Cyanide', formula: 'CN', charge: '1-', formulaHTML: 'CN<sup>-</sup>', pattern: '-ide (exception)' }
];

function buildPolyTable() {
  const tbody = document.getElementById('poly-table-body');
  tbody.innerHTML = '';
  polyIons.forEach(ion => {
    const tr = document.createElement('tr');
    tr.innerHTML = '<td style="color:#eee;font-weight:500">' + ion.name + '</td><td class="chem">' + ion.formulaHTML + '</td><td style="color:var(--amber)">' + ion.charge + '</td><td style="color:var(--text-dim)">' + ion.pattern + '</td>';
    tbody.appendChild(tr);
  });
}

/* -- Flash Cards -- */
const flashCards = [
  { showName: true, name: 'Sulfate', formula: 'SO4', charge: '2-', displayHTML: 'Sulfate', acceptFormula: ['so4 2-', 'so4^2-', 'so42-'], acceptCharge: '2-' },
  { showName: true, name: 'Nitrate', formula: 'NO3', charge: '1-', displayHTML: 'Nitrate', acceptFormula: ['no3 1-', 'no3-', 'no3 -', 'no3^-', 'no31-'], acceptCharge: '1-' },
  { showName: false, name: 'Carbonate', formula: 'CO3', charge: '2-', displayHTML: 'CO<sub>3</sub><sup>2-</sup>', acceptName: ['carbonate'] },
  { showName: true, name: 'Phosphate', formula: 'PO4', charge: '3-', displayHTML: 'Phosphate', acceptFormula: ['po4 3-', 'po4^3-', 'po43-'], acceptCharge: '3-' },
  { showName: false, name: 'Hydroxide', formula: 'OH', charge: '1-', displayHTML: 'OH<sup>-</sup>', acceptName: ['hydroxide'] },
  { showName: true, name: 'Ammonium', formula: 'NH4', charge: '1+', displayHTML: 'Ammonium', acceptFormula: ['nh4 1+', 'nh4+', 'nh4 +', 'nh4^+', 'nh41+'], acceptCharge: '1+' },
  { showName: false, name: 'Permanganate', formula: 'MnO4', charge: '1-', displayHTML: 'MnO<sub>4</sub><sup>-</sup>', acceptName: ['permanganate'] },
  { showName: true, name: 'Acetate', formula: 'C2H3O2', charge: '1-', displayHTML: 'Acetate', acceptFormula: ['c2h3o2 1-', 'c2h3o2-', 'c2h3o2 -', 'ch3coo-', 'ch3coo 1-'], acceptCharge: '1-' },
  { showName: false, name: 'Perchlorate', formula: 'ClO4', charge: '1-', displayHTML: 'ClO<sub>4</sub><sup>-</sup>', acceptName: ['perchlorate'] },
  { showName: true, name: 'Sulfite', formula: 'SO3', charge: '2-', displayHTML: 'Sulfite', acceptFormula: ['so3 2-', 'so3^2-', 'so32-'], acceptCharge: '2-' }
];

let flashIdx = 0, flashCorrect = 0, flashAttempted = 0;

function loadFlash() {
  if (flashIdx >= flashCards.length) {
    markSectionComplete('card4', 's4');
    return;
  }
  const fc = flashCards[flashIdx];
  const card = document.getElementById('flash-card');
  card.className = 'flash-card';
  document.getElementById('flash-current').textContent = flashIdx + 1;

  if (fc.showName) {
    document.getElementById('fc-mode-label').textContent = 'Write the formula and charge';
    document.getElementById('fc-ion-display').innerHTML = fc.displayHTML;
    document.getElementById('fc-charge-hint').textContent = '';
    document.getElementById('flash-input').placeholder = 'e.g., SO4 2-';
  } else {
    document.getElementById('fc-mode-label').textContent = 'Name this ion';
    document.getElementById('fc-ion-display').innerHTML = fc.displayHTML;
    document.getElementById('fc-charge-hint').textContent = '';
    document.getElementById('flash-input').placeholder = 'e.g., carbonate';
  }
  document.getElementById('flash-input').value = '';
  document.getElementById('flash-input').classList.remove('correct-input', 'incorrect-input');
  clearFeedback('flash-feedback');
  document.getElementById('flash-input').focus();
}

function checkFlash() {
  const input = document.getElementById('flash-input');
  const val = norm(input.value);
  if (!val) return;
  const fc = flashCards[flashIdx];
  const card = document.getElementById('flash-card');
  let correct = false;

  if (fc.showName) {
    correct = fc.acceptFormula.some(a => norm(a) === val);
  } else {
    correct = fc.acceptName.some(a => norm(a) === val);
  }

  flashAttempted++;
  if (correct) {
    flashCorrect++;
    solvedTotal++;
    updateProgress();
    card.classList.add('correct-card');
    const ans = fc.showName ? fc.formula + ' ' + fc.charge : fc.name;
    showFeedback('flash-feedback', true, 'Correct! ' + fc.name + ' is ' + fc.formula + ' with charge ' + fc.charge);
    markInput(input, true);
  } else {
    card.classList.add('incorrect-card');
    const ans = fc.showName ? fc.formula + ' ' + fc.charge : fc.name;
    showFeedback('flash-feedback', false, 'The answer is <strong>' + ans + '</strong>. ' + fc.name + ' = ' + fc.formula + ' (' + fc.charge + ')');
    markInput(input, false);
    solvedTotal++;
    updateProgress();
  }
  document.getElementById('flash-score-display').textContent = flashCorrect + '/' + flashAttempted;
  updateSectionScore('flash-fill', 'flash-score-text', flashCorrect, flashCards.length);
  flashIdx++;
  setTimeout(() => loadFlash(), 1500);
}

function skipFlash() {
  const fc = flashCards[flashIdx];
  flashAttempted++;
  solvedTotal++;
  updateProgress();
  const ans = fc.showName ? fc.formula + ' ' + fc.charge : fc.name;
  showFeedback('flash-feedback', false, 'Skipped. The answer is <strong>' + ans + '</strong>.');
  document.getElementById('flash-score-display').textContent = flashCorrect + '/' + flashAttempted;
  updateSectionScore('flash-fill', 'flash-score-text', flashCorrect, flashCards.length);
  flashIdx++;
  setTimeout(() => loadFlash(), 1500);
}

/* ═══════════════════════════════════════════════════ */
/*  SECTION 5: QUICK QUIZ                             */
/* ═══════════════════════════════════════════════════ */
const quizProblems = [
  { type: 'ionic', typeLabel: 'Ionic', text: 'Name: CaBr<sub>2</sub>', answer: ['calcium bromide'], explanation: 'Ca2+ + 2 Br- = calcium bromide' },
  { type: 'covalent', typeLabel: 'Covalent', text: 'Name: P<sub>2</sub>O<sub>5</sub>', answer: ['diphosphorus pentoxide', 'diphosphorus pentaoxide'], explanation: 'di- phosphorus penta- oxide' },
  { type: 'acid', typeLabel: 'Acid', text: 'Name: HBr (aq)', answer: ['hydrobromic acid'], explanation: 'Binary acid: hydro- + brom- + -ic acid' },
  { type: 'ionic', typeLabel: 'Ionic', text: 'Formula for: potassium oxide', answer: ['k2o'], explanation: '2 K+ and O2- balance charges &rarr; K2O' },
  { type: 'covalent', typeLabel: 'Covalent', text: 'Formula for: dinitrogen monoxide', answer: ['n2o'], explanation: 'di = 2 nitrogen, mono = 1 oxygen &rarr; N2O' },
  { type: 'acid', typeLabel: 'Acid', text: 'Name: H<sub>2</sub>CO<sub>3</sub>', answer: ['carbonic acid'], explanation: 'From carbonate (CO3 2-): -ate &rarr; -ic acid' },
  { type: 'ionic', typeLabel: 'Ionic', text: 'Name: CuO', answer: ['copper(ii) oxide', 'copper (ii) oxide'], explanation: 'Cu2+ + O2- = copper(II) oxide' },
  { type: 'covalent', typeLabel: 'Covalent', text: 'Name: BF<sub>3</sub>', answer: ['boron trifluoride'], explanation: '1 boron + 3 fluorine = boron trifluoride' },
  { type: 'acid', typeLabel: 'Acid', text: 'Name: H<sub>2</sub>SO<sub>3</sub>', answer: ['sulfurous acid'], explanation: 'From sulfite (SO3 2-): -ite &rarr; -ous acid' },
  { type: 'ionic', typeLabel: 'Ionic', text: 'Formula for: lead(II) nitrate', answer: ['pb(no3)2', 'pb (no3)2'], explanation: 'Pb2+ with 2 NO3- ions &rarr; Pb(NO3)2' },
  { type: 'covalent', typeLabel: 'Covalent', text: 'Name: Si<sub>2</sub>Cl<sub>6</sub>', answer: ['disilicon hexachloride'], explanation: 'di- silicon hexa- chloride' },
  { type: 'acid', typeLabel: 'Acid', text: 'Name: HNO<sub>2</sub>', answer: ['nitrous acid'], explanation: 'From nitrite (NO2-): -ite &rarr; -ous acid' },
  { type: 'ionic', typeLabel: 'Ionic', text: 'Formula for: chromium(III) sulfate', answer: ['cr2(so4)3', 'cr2 (so4)3'], explanation: '2 Cr3+ with 3 SO4 2- &rarr; Cr2(SO4)3' },
  { type: 'covalent', typeLabel: 'Covalent', text: 'Formula for: xenon tetrafluoride', answer: ['xef4'], explanation: '1 xenon + 4 fluorine &rarr; XeF4' },
  { type: 'acid', typeLabel: 'Acid', text: 'Name: H<sub>3</sub>PO<sub>3</sub>', answer: ['phosphorous acid'], explanation: 'From phosphite (PO3 3-): -ite &rarr; -ous acid' }
];

let quizIdx = 0, quizCorrectCount = 0, quizAttempted = 0;

function loadQuiz() {
  if (quizIdx >= quizProblems.length) {
    markSectionComplete('card5', 's5');
    document.getElementById('quiz-problem').innerHTML = '<div style="text-align:center;padding:1.5rem"><div style="font-size:1.5rem;margin-bottom:.5rem;color:var(--green)">Quiz Complete!</div><div style="font-size:.85rem;color:var(--text)">Score: ' + quizCorrectCount + ' / ' + quizProblems.length + '</div></div>';
    return;
  }
  const p = quizProblems[quizIdx];
  document.getElementById('quiz-current').textContent = quizIdx + 1;
  const badge = document.getElementById('quiz-type-badge');
  badge.className = 'q-type ' + p.type;
  badge.textContent = p.typeLabel;
  document.getElementById('quiz-text').innerHTML = p.text;
  document.getElementById('quiz-input').value = '';
  document.getElementById('quiz-input').classList.remove('correct-input', 'incorrect-input');
  clearFeedback('quiz-feedback');
  document.getElementById('quiz-input').focus();
}

function checkQuiz() {
  const input = document.getElementById('quiz-input');
  const val = norm(input.value);
  if (!val) return;
  const p = quizProblems[quizIdx];
  const correct = p.answer.some(a => norm(a) === val);
  quizAttempted++;
  if (correct) {
    quizCorrectCount++;
    solvedTotal++;
    updateProgress();
    showFeedback('quiz-feedback', true, 'Correct! ' + p.explanation);
    markInput(input, true);
  } else {
    showFeedback('quiz-feedback', false, 'Answer: <strong>' + p.answer[0] + '</strong>. ' + p.explanation);
    markInput(input, false);
    solvedTotal++;
    updateProgress();
  }
  document.getElementById('quiz-score').textContent = 'Score: ' + quizCorrectCount + ' / ' + quizAttempted;
  updateSectionScore('quiz-fill', 'quiz-score-text', quizCorrectCount, quizProblems.length);
  quizIdx++;
  setTimeout(() => loadQuiz(), 1500);
}

function skipQuiz() {
  const p = quizProblems[quizIdx];
  quizAttempted++;
  solvedTotal++;
  updateProgress();
  showFeedback('quiz-feedback', false, 'Skipped. Answer: <strong>' + p.answer[0] + '</strong>. ' + p.explanation);
  document.getElementById('quiz-score').textContent = 'Score: ' + quizCorrectCount + ' / ' + quizAttempted;
  updateSectionScore('quiz-fill', 'quiz-score-text', quizCorrectCount, quizProblems.length);
  quizIdx++;
  setTimeout(() => loadQuiz(), 1500);
}

/* ═══════════════════════════════════════════════════ */
/*  ENTER KEY HANDLERS                                 */
/* ═══════════════════════════════════════════════════ */
document.getElementById('ionic-input').addEventListener('keydown', e => { if (e.key === 'Enter') checkIonic(); });
document.getElementById('cov-input').addEventListener('keydown', e => { if (e.key === 'Enter') checkCovalent(); });
document.getElementById('acid-input').addEventListener('keydown', e => { if (e.key === 'Enter') checkAcid(); });
document.getElementById('flash-input').addEventListener('keydown', e => { if (e.key === 'Enter') checkFlash(); });
document.getElementById('quiz-input').addEventListener('keydown', e => { if (e.key === 'Enter') checkQuiz(); });

/* ═══════════════════════════════════════════════════ */
/*  INIT                                               */
/* ═══════════════════════════════════════════════════ */
buildPolyTable();
loadIonic();
initCovMatch();
loadCovalent();
loadAcid();
loadFlash();
loadQuiz();

</script>
</body>
</html>