<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lesson 17: Electric Charge &amp; Electric Fields</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#1e2128;--bg-card:#262a33;--bg-card-hover:#2c313c;--bg-input:#1a1d24;--border:#363b47;--text:#e2e4e9;--text-dim:#9ca3af;--text-bright:#fff;--indigo:#6366f1;--indigo-dim:rgba(99,102,241,.15);--green:#22c55e;--green-dim:rgba(34,197,94,.15);--pink:#ec4899;--pink-dim:rgba(236,72,153,.15);--amber:#f59e0b;--amber-dim:rgba(245,158,11,.15);--radius:10px;--transition:0.3s cubic-bezier(.4,0,.2,1)}
html{scroll-behavior:smooth}
body{font-family:'JetBrains Mono',monospace;background:var(--bg);color:var(--text);line-height:1.7;min-height:100vh;padding:0}
.top-bar{position:sticky;top:0;z-index:100;background:rgba(30,33,40,.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:16px 24px}
.top-bar h1{font-size:1.1rem;font-weight:600;color:var(--text-bright);margin-bottom:10px;letter-spacing:-.02em}
.top-bar h1 span{color:var(--indigo)}
.progress-track{width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--indigo),#818cf8);border-radius:3px;transition:width .5s ease}
.progress-label{font-size:.7rem;color:var(--text-dim);margin-top:6px;text-align:right}
.content{max-width:900px;margin:0 auto;padding:24px}
.section-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:20px;overflow:hidden;transition:border-color var(--transition)}
.section-card.completed{border-color:var(--green)}
.section-header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;cursor:pointer;user-select:none;transition:background var(--transition)}
.section-header:hover{background:var(--bg-card-hover)}
.section-header h2{font-size:.95rem;font-weight:600;color:var(--text-bright);display:flex;align-items:center;gap:10px}
.section-num{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;background:var(--indigo-dim);color:var(--indigo);font-size:.75rem;font-weight:700;flex-shrink:0}
.chevron{width:20px;height:20px;color:var(--text-dim);transition:transform .4s cubic-bezier(.34,1.56,.64,1);flex-shrink:0}
.section-card.open .chevron{transform:rotate(180deg)}
.section-body{max-height:0;overflow:hidden;transition:max-height .5s cubic-bezier(.4,0,.2,1)}
.section-card.open .section-body{max-height:80000px}
.section-inner{padding:0 22px 22px}
.concept-text{font-size:.82rem;color:var(--text);margin-bottom:16px;line-height:1.8}
.concept-text strong{color:var(--text-bright)}
.formula-box{background:var(--indigo-dim);border:1px solid rgba(99,102,241,.3);border-radius:var(--radius);padding:16px 20px;margin:16px 0;text-align:center;font-size:1rem;color:var(--indigo);font-weight:600}
.formula-box.large{font-size:1.15rem;padding:20px 24px}
.formula-box.green{background:var(--green-dim);border-color:rgba(34,197,94,.3);color:var(--green)}
.formula-box.pink{background:var(--pink-dim);border-color:rgba(236,72,153,.3);color:var(--pink)}
.formula-box.amber{background:var(--amber-dim);border-color:rgba(245,158,11,.3);color:var(--amber)}
.key-point{background:var(--amber-dim);border-left:3px solid var(--amber);border-radius:0 var(--radius) var(--radius) 0;padding:12px 16px;margin:14px 0;font-size:.78rem;color:var(--amber)}
.interactive-area{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin:16px 0;position:relative}
.interactive-label{font-size:.7rem;color:var(--indigo);text-transform:uppercase;letter-spacing:.08em;margin-bottom:12px;font-weight:600}
.readout{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
.readout-item{background:var(--bg-card);border:1px solid var(--border);border-radius:6px;padding:8px 14px;font-size:.75rem}
.readout-item .label{color:var(--text-dim);font-size:.65rem}
.readout-item .value{color:var(--text-bright);font-weight:600}
.readout-item .value.green{color:var(--green)}
.readout-item .value.pink{color:var(--pink)}
.readout-item .value.amber{color:var(--amber)}
.readout-item .value.indigo{color:var(--indigo)}
svg text{font-family:'JetBrains Mono',monospace}
.practice-block{margin-top:20px;border-top:1px solid var(--border);padding-top:16px}
.practice-title{font-size:.8rem;font-weight:600;color:var(--amber);margin-bottom:14px}
.problem{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:12px}
.problem p{font-size:.78rem;margin-bottom:10px;line-height:1.7}
.problem-input-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.problem input[type="text"],.problem input[type="number"]{background:var(--bg-card);border:1px solid var(--border);border-radius:6px;padding:8px 12px;color:var(--text-bright);font-family:'JetBrains Mono',monospace;font-size:.78rem;width:130px;outline:none;transition:border-color var(--transition)}
.problem input:focus{border-color:var(--indigo)}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.72rem;cursor:pointer;transition:var(--transition);user-select:none}
.btn:hover{background:var(--bg-card-hover);border-color:var(--indigo);color:var(--text-bright)}
.btn-primary{background:var(--indigo);border-color:var(--indigo);color:#fff}
.btn-primary:hover{background:#5558e6}
.btn-sm{padding:6px 12px;font-size:.68rem}
.feedback{font-size:.75rem;margin-top:8px;padding:8px 12px;border-radius:6px;display:none}
.feedback.correct{display:block;background:var(--green-dim);color:var(--green);border:1px solid rgba(34,197,94,.3)}
.feedback.incorrect{display:block;background:var(--pink-dim);color:var(--pink);border:1px solid rgba(236,72,153,.3)}
.slider-row{display:flex;align-items:center;gap:12px;margin:8px 0}
.slider-row label{font-size:.7rem;color:var(--text-dim);min-width:130px;flex-shrink:0}
.slider-row .slider-val{font-size:.75rem;color:var(--text-bright);font-weight:600;min-width:70px;text-align:right}
input[type="range"]{-webkit-appearance:none;width:100%;height:6px;background:var(--border);border-radius:3px;outline:none;margin:10px 0;flex:1}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--indigo);cursor:pointer;border:2px solid var(--text-bright)}
.mc-choices{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.mc-btn{text-align:left;padding:8px 12px;font-size:.74rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);cursor:pointer;transition:var(--transition);font-family:'JetBrains Mono',monospace}
.mc-btn:hover{border-color:var(--indigo);background:var(--bg-card-hover)}
.mc-btn.correct{border-color:var(--green);background:var(--green-dim);color:var(--green);pointer-events:none}
.mc-btn.wrong{border-color:var(--pink);background:var(--pink-dim);color:var(--pink);pointer-events:none}
.mc-btn.disabled{pointer-events:none;opacity:.6}
.quiz-score{background:var(--indigo-dim);border:1px solid rgba(99,102,241,.3);border-radius:var(--radius);padding:14px 20px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.quiz-score .score-text{font-size:.85rem;color:var(--text-bright);font-weight:600}
.quiz-q{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px}
.quiz-q .q-num{font-size:.65rem;color:var(--indigo);font-weight:600;text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px}
.quiz-q .q-text{font-size:.78rem;margin-bottom:12px;line-height:1.7}
.quiz-q .choices{display:flex;flex-direction:column;gap:8px}
.quiz-q .choice-btn{text-align:left;padding:10px 14px;font-size:.76rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);cursor:pointer;transition:var(--transition);font-family:'JetBrains Mono',monospace;width:100%}
.quiz-q .choice-btn:hover{border-color:var(--indigo);background:var(--bg-card-hover)}
.quiz-q .choice-btn.selected-correct{border-color:var(--green);background:var(--green-dim);color:var(--green)}
.quiz-q .choice-btn.selected-wrong{border-color:var(--pink);background:var(--pink-dim);color:var(--pink)}
.quiz-q .choice-btn.reveal-correct{border-color:var(--green);background:var(--green-dim);color:var(--green)}
.quiz-q .choice-btn.disabled{pointer-events:none;opacity:.7}
.canvas-wrap{position:relative;background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin:12px 0}
canvas{display:block}
.direction-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 14px;border-radius:20px;font-size:.78rem;font-weight:600;margin-top:10px}
.direction-badge.attract{background:var(--green-dim);border:1px solid rgba(34,197,94,.3);color:var(--green)}
.direction-badge.repel{background:var(--pink-dim);border:1px solid rgba(236,72,153,.3);color:var(--pink)}
.charge-legend{display:flex;gap:16px;margin:8px 0;flex-wrap:wrap}
.charge-legend span{font-size:.72rem;color:var(--text-dim);display:flex;align-items:center;gap:6px}
.charge-legend .dot{width:12px;height:12px;border-radius:50%;flex-shrink:0}
.dot-pos{background:var(--pink)}
.dot-neg{background:var(--indigo)}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:16px 0}
@keyframes springPop{0%{transform:scale(1)}40%{transform:scale(1.15)}70%{transform:scale(0.95)}100%{transform:scale(1)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
.pop{animation:springPop .45s cubic-bezier(.34,1.56,.64,1)}
.shake{animation:shake .4s ease}
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:16px 0}
.info-cell{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:12px 14px}
.info-cell .cell-label{font-size:.65rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:.06em;margin-bottom:4px}
.info-cell .cell-value{font-size:.85rem;color:var(--text-bright);font-weight:600}
.trajectory-legend{display:flex;gap:14px;flex-wrap:wrap;margin:8px 0}
.trajectory-legend span{font-size:.7rem;color:var(--text-dim);display:flex;align-items:center;gap:6px}
.tl-line{width:20px;height:3px;border-radius:2px;flex-shrink:0}
@media(max-width:640px){.content{padding:16px}.section-header{padding:14px 16px}.section-inner{padding:0 16px 16px}.slider-row label{min-width:80px}.readout{gap:8px}.readout-item{padding:6px 10px;font-size:.7rem}.two-col{grid-template-columns:1fr}.info-grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="top-bar">
  <h1><span>17</span> Electric Charge &amp; Electric Fields</h1>
  <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
  <div class="progress-label" id="progressLabel">0 / 6 sections</div>
</div>

<div class="content" id="contentArea">

<!-- ============================================================ -->
<!-- SECTION 1: ELECTRIC CHARGE -->
<!-- ============================================================ -->
<div class="section-card open" data-section="1" id="sec1">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">1</span> Electric Charge</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      Electric charge is a fundamental property of matter. <strong>Protons</strong> carry a positive charge (+e) and <strong>electrons</strong> carry a negative charge (-e), where e = 1.6 &times; 10<sup>-19</sup> C is the elementary charge. Neutrons are electrically neutral. Like charges repel; opposite charges attract.
    </p>

    <div class="formula-box large">q = ne &nbsp;&nbsp;&nbsp; e = 1.6 &times; 10<sup>-19</sup> C</div>

    <p class="concept-text">
      <strong>Charge quantization</strong> means charge only comes in integer multiples of e. You cannot have half an electron's worth of charge. This was first measured by Millikan's oil-drop experiment. <strong>Conservation of charge</strong> states that the total charge in an isolated system never changes -- charge cannot be created or destroyed, only transferred.
    </p>

    <div class="key-point">Conservation of charge: In any process, the net charge before equals the net charge after. This is an exact, universal law with no known exceptions.</div>

    <p class="concept-text">
      Materials fall into two categories based on how freely charge moves:
    </p>

    <div class="two-col">
      <div class="interactive-area" style="margin:0">
        <div class="interactive-label">Conductors</div>
        <p class="concept-text" style="font-size:.78rem;margin:0">Outer electrons move freely throughout the material. Examples: metals (copper, silver, gold), graphite, plasma. Charge distributes rapidly across the surface.</p>
      </div>
      <div class="interactive-area" style="margin:0">
        <div class="interactive-label">Insulators</div>
        <p class="concept-text" style="font-size:.78rem;margin:0">Electrons are tightly bound to atoms. Charge stays where it is placed. Examples: rubber, glass, plastic, dry wood, air.</p>
      </div>
    </div>

    <p class="concept-text" style="margin-top:16px">
      <strong>Charging by conduction:</strong> A charged object touches a neutral one. Charge flows until equilibrium -- both objects end up with the same sign of charge.<br><br>
      <strong>Charging by induction:</strong> A charged object brought near (not touching) a conductor causes charge redistribution. Ground the conductor while the charged object is nearby, then remove the ground -- the conductor is left with the opposite sign of charge.
    </p>

    <div class="key-point">The <strong>electroscope</strong> detects charge through induction: the leaves spread apart when a charged object is brought nearby because like charges on the leaves repel each other.</div>

    <div class="practice-block">
      <div class="practice-title">Practice Problems</div>

      <div class="problem" id="p1a">
        <p><strong>1.</strong> A glass rod acquires a charge of +3.2 &times; 10<sup>-18</sup> C by rubbing with silk. How many electrons were transferred FROM the rod to the silk?</p>
        <div class="problem-input-row">
          <input type="number" id="p1aAns" placeholder="# electrons">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p1aAns',20,0,'p1aFB','p1a')">Check</button>
        </div>
        <div class="feedback" id="p1aFB"></div>
      </div>

      <div class="problem" id="p1b">
        <p><strong>2.</strong> An object has +6e of charge. Another has -4e. They touch and separate equally. What is the charge (in units of e) on each object after separation?</p>
        <div class="problem-input-row">
          <input type="number" id="p1bAns" placeholder="in units of e">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p1bAns',1,0,'p1bFB','p1b')">Check</button>
        </div>
        <div class="feedback" id="p1bFB"></div>
      </div>

      <div class="problem" id="p1c">
        <p><strong>3. (Multiple Choice)</strong> A negatively charged rod is brought near (but not touching) the left side of a neutral metal sphere. The sphere is then grounded momentarily, then the ground is removed, then the rod is removed. What is the final charge on the sphere?</p>
        <div class="mc-choices" id="p1cMC">
          <button class="mc-btn" onclick="checkMC(this,'A','p1cMC','p1cFB','p1c')">A) Negative</button>
          <button class="mc-btn" onclick="checkMC(this,'B','p1cMC','p1cFB','p1c')">B) Positive</button>
          <button class="mc-btn" onclick="checkMC(this,'C','p1cMC','p1cFB','p1c')">C) Zero</button>
          <button class="mc-btn" onclick="checkMC(this,'D','p1cMC','p1cFB','p1c')">D) Cannot be determined</button>
        </div>
        <div class="feedback" id="p1cFB"></div>
      </div>

      <div class="problem" id="p1d">
        <p><strong>4.</strong> A proton has charge +1.6 &times; 10<sup>-19</sup> C. What is the charge in Coulombs of a nucleus with 17 protons (chlorine)?  Enter your answer as a multiple of 10<sup>-19</sup> (i.e., enter 27.2 for 27.2 &times; 10<sup>-19</sup> C).</p>
        <div class="problem-input-row">
          <input type="number" id="p1dAns" placeholder="× 10⁻¹⁹ C">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p1dAns',27.2,0.1,'p1dFB','p1d')">Check</button>
        </div>
        <div class="feedback" id="p1dFB"></div>
      </div>
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 2: COULOMB'S LAW -->
<!-- ============================================================ -->
<div class="section-card" data-section="2" id="sec2">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">2</span> Coulomb's Law</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      <strong>Coulomb's Law</strong> gives the magnitude of the electrostatic force between two point charges. It has the same inverse-square form as Newton's Law of Gravitation, but can be either attractive (opposite charges) or repulsive (like charges).
    </p>

    <div class="formula-box large">F = k|q&#x2081;||q&#x2082;| / r&sup2;</div>
    <div class="formula-box green">k = 8.99 &times; 10&sup9; N&middot;m&sup2;/C&sup2; &nbsp;&nbsp; (Coulomb's constant)</div>

    <p class="concept-text">
      The force is a <strong>vector</strong> -- it acts along the line connecting the two charges. The <strong>superposition principle</strong> states that the total force on a charge from multiple other charges is the vector sum of the individual Coulomb forces. This makes problems with three or more charges manageable by handling one pair at a time.
    </p>

    <div class="key-point">Comparison to gravity: Both are inverse-square laws, but the electric force is ~10<sup>36</sup> times stronger than gravity. Gravity is always attractive; the electric force can be attractive or repulsive. Gravity cannot be shielded; electric fields can.</div>

    <div class="interactive-area">
      <div class="interactive-label">Coulomb's Law Simulator</div>
      <div class="slider-row">
        <label>q&#x2081; (nC)</label>
        <input type="range" id="clQ1" min="-10" max="10" value="4" step="0.5" oninput="updateCoulomb()">
        <span class="slider-val" id="clQ1Val">+4.0 nC</span>
      </div>
      <div class="slider-row">
        <label>q&#x2082; (nC)</label>
        <input type="range" id="clQ2" min="-10" max="10" value="-3" step="0.5" oninput="updateCoulomb()">
        <span class="slider-val" id="clQ2Val">-3.0 nC</span>
      </div>
      <div class="slider-row">
        <label>Separation r (cm)</label>
        <input type="range" id="clR" min="1" max="20" value="5" step="0.5" oninput="updateCoulomb()">
        <span class="slider-val" id="clRVal">5.0 cm</span>
      </div>
      <div class="canvas-wrap"><canvas id="coulombCanvas" width="840" height="120"></canvas></div>
      <div class="readout">
        <div class="readout-item"><div class="label">Force Magnitude</div><div class="value indigo" id="clForce">—</div></div>
        <div class="readout-item"><div class="label">Interaction</div><div class="value" id="clDirection">—</div></div>
        <div class="readout-item"><div class="label">vs. Gravity (same masses 1g)</div><div class="value amber" id="clGravRatio">—</div></div>
      </div>
    </div>

    <div class="practice-block">
      <div class="practice-title">Practice Problems</div>

      <div class="problem" id="p2a">
        <p><strong>1.</strong> Two charges of +2.0 &mu;C and -5.0 &mu;C are separated by 0.30 m. What is the magnitude of the Coulomb force in Newtons? (Round to 3 sig figs)</p>
        <div class="problem-input-row">
          <input type="number" id="p2aAns" placeholder="Newtons" step="0.01">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p2aAns',0.999,0.01,'p2aFB','p2a')">Check</button>
        </div>
        <div class="feedback" id="p2aFB"></div>
      </div>

      <div class="problem" id="p2b">
        <p><strong>2.</strong> If the separation between two charges is tripled, by what factor does the Coulomb force change? Enter the factor as a fraction (e.g., enter 0.111 for 1/9).</p>
        <div class="problem-input-row">
          <input type="number" id="p2bAns" placeholder="factor" step="0.001">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p2bAns',0.111,0.002,'p2bFB','p2b')">Check</button>
        </div>
        <div class="feedback" id="p2bFB"></div>
      </div>

      <div class="problem" id="p2c">
        <p><strong>3.</strong> Three charges on a line: q&#x2081; = +3 &mu;C at x=0, q&#x2082; = +3 &mu;C at x=0.4 m, q&#x2083; = -6 &mu;C at x=0.8 m. What is the net force (in N) on q&#x2082;? Take rightward as positive.</p>
        <div class="problem-input-row">
          <input type="number" id="p2cAns" placeholder="Newtons" step="0.01">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p2cAns',-0.843,0.05,'p2cFB','p2c')">Check</button>
        </div>
        <div class="feedback" id="p2cFB"></div>
      </div>

      <div class="problem" id="p2d">
        <p><strong>4. (Multiple Choice)</strong> A charge of +q and a charge of +4q are separated by distance d. Where on the line between them (measured from +q) is the net electric force on a test charge equal to zero?</p>
        <div class="mc-choices" id="p2dMC">
          <button class="mc-btn" onclick="checkMC(this,'A','p2dMC','p2dFB','p2d')">A) d/2 (midpoint)</button>
          <button class="mc-btn" onclick="checkMC(this,'B','p2dMC','p2dFB','p2d')">B) d/3 from the +q charge</button>
          <button class="mc-btn" onclick="checkMC(this,'C','p2dMC','p2dFB','p2d')">C) d/3 from the +4q charge</button>
          <button class="mc-btn" onclick="checkMC(this,'D','p2dMC','p2dFB','p2d')">D) 2d/3 from the +4q charge</button>
        </div>
        <div class="feedback" id="p2dFB"></div>
      </div>
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 3: ELECTRIC FIELD -->
<!-- ============================================================ -->
<div class="section-card" data-section="3" id="sec3">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">3</span> Electric Field</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      The <strong>electric field</strong> E is a vector field that describes the force per unit charge at every point in space. It is defined using a small positive <em>test charge</em> q&#x2080; placed at that point. The test charge must be small enough that it does not disturb the source charges.
    </p>

    <div class="formula-box large">E = F / q&#x2080; &nbsp;&nbsp;&nbsp; units: N/C</div>
    <div class="formula-box green">E = k|q| / r&sup2; &nbsp;&nbsp; (point charge, magnitude)</div>

    <p class="concept-text">
      <strong>Electric field lines</strong> are a visual tool. They follow these rules:<br>
      &bull; Start on positive charges; end on negative charges (or infinity)<br>
      &bull; Never cross each other<br>
      &bull; The density of lines indicates field strength<br>
      &bull; The tangent to a field line gives the field direction at that point
    </p>

    <div class="key-point">The field of a single positive point charge points radially outward. For a negative charge, radially inward. The field at any point is the vector sum (superposition) of all contributions.</div>

    <p class="concept-text">
      Between two large parallel plates with surface charge density &sigma;, the electric field is <strong>uniform</strong> (constant magnitude and direction everywhere between the plates, ignoring edge effects):
    </p>
    <div class="formula-box amber">E = &sigma; / &epsilon;&#x2080; &nbsp;&nbsp;&nbsp; &epsilon;&#x2080; = 8.85 &times; 10<sup>-12</sup> C&sup2;/(N&middot;m&sup2;)</div>

    <div class="interactive-area">
      <div class="interactive-label">Electric Field Visualizer — Click Canvas to Place Charges (max 3)</div>
      <div class="charge-legend">
        <span><div class="dot dot-pos"></div> Left-click = +charge</span>
        <span><div class="dot dot-neg"></div> Right-click = -charge</span>
        <span style="color:var(--text-dim);font-size:.68rem">Shift+click to clear all</span>
      </div>
      <div class="canvas-wrap">
        <canvas id="fieldCanvas" width="840" height="340" style="cursor:crosshair"></canvas>
      </div>
      <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap">
        <button class="btn btn-sm" onclick="clearFieldCharges()">Clear All</button>
        <span id="fieldChargeCount" style="font-size:.72rem;color:var(--text-dim);align-self:center">0 charges placed</span>
      </div>
    </div>

    <div class="practice-block">
      <div class="practice-title">Practice Problems</div>

      <div class="problem" id="p3a">
        <p><strong>1.</strong> A charge of +5.0 &mu;C creates an electric field. What is the magnitude of E (in N/C) at a distance of 0.20 m from the charge? (Express in scientific notation &mdash; enter value &times; 10<sup>3</sup>, e.g. enter 1.12 for 1.12 &times; 10<sup>3</sup>)</p>
        <div class="problem-input-row">
          <input type="number" id="p3aAns" placeholder="× 10³ N/C" step="0.01">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p3aAns',1123,5,'p3aFB','p3a')">Check</button>
        </div>
        <div class="feedback" id="p3aFB"></div>
      </div>

      <div class="problem" id="p3b">
        <p><strong>2.</strong> The electric field at a point is 600 N/C. A charge of +2.0 &mu;C is placed at that point. What force (in mN) does it experience?</p>
        <div class="problem-input-row">
          <input type="number" id="p3bAns" placeholder="mN" step="0.1">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p3bAns',1.2,0.05,'p3bFB','p3b')">Check</button>
        </div>
        <div class="feedback" id="p3bFB"></div>
      </div>

      <div class="problem" id="p3c">
        <p><strong>3. (Multiple Choice)</strong> Which statement about electric field lines is CORRECT?</p>
        <div class="mc-choices" id="p3cMC">
          <button class="mc-btn" onclick="checkMC(this,'A','p3cMC','p3cFB','p3c')">A) Field lines can cross where the field is very strong</button>
          <button class="mc-btn" onclick="checkMC(this,'B','p3cMC','p3cFB','p3c')">B) A negative test charge moves opposite to the field line direction</button>
          <button class="mc-btn" onclick="checkMC(this,'C','p3cMC','p3cFB','p3c')">C) Field lines start on negative charges and end on positive charges</button>
          <button class="mc-btn" onclick="checkMC(this,'D','p3cMC','p3cFB','p3c')">D) Widely spaced field lines indicate a strong field</button>
        </div>
        <div class="feedback" id="p3cFB"></div>
      </div>

      <div class="problem" id="p3d">
        <p><strong>4.</strong> Two parallel plates have a surface charge density &sigma; = 3.54 &times; 10<sup>-10</sup> C/m&sup2;. What is the electric field (in N/C) between them? (&epsilon;&#x2080; = 8.85 &times; 10<sup>-12</sup> C&sup2;/(N&middot;m&sup2;))</p>
        <div class="problem-input-row">
          <input type="number" id="p3dAns" placeholder="N/C" step="0.1">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p3dAns',40,1,'p3dFB','p3d')">Check</button>
        </div>
        <div class="feedback" id="p3dFB"></div>
      </div>
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 4: ELECTRIC FIELD CALCULATIONS -->
<!-- ============================================================ -->
<div class="section-card" data-section="4" id="sec4">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">4</span> Electric Field Calculations</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      For multiple point charges, the total electric field at a point is found by <strong>superposition</strong>: compute each charge's field contribution (as a vector), then add them component by component. Never add magnitudes directly unless the fields are parallel.
    </p>

    <div class="formula-box">E&#x20D7;<sub>total</sub> = E&#x20D7;<sub>1</sub> + E&#x20D7;<sub>2</sub> + E&#x20D7;<sub>3</sub> + &hellip;</div>

    <p class="concept-text">
      An <strong>electric dipole</strong> consists of two equal and opposite charges (+q and -q) separated by distance d. The dipole moment is p = qd (pointing from &minus;q to +q). Along the axis of the dipole at distance r &gg; d, the field falls as 1/r&sup3;. Dipoles are important in chemistry (polar molecules) and in dielectric materials.
    </p>

    <div class="key-point">Inside a conductor in electrostatic equilibrium, E = 0. Any excess charge resides entirely on the outer surface. This is the basis for Faraday cages.</div>

    <p class="concept-text">
      <strong>Gauss's Law</strong> (conceptual): The total electric flux through any closed surface equals the enclosed charge divided by &epsilon;&#x2080;. This is a more powerful way to find E for symmetric charge distributions (spheres, cylinders, planes) without integrating Coulomb's law directly.
    </p>

    <div class="formula-box pink">&Phi;<sub>E</sub> = Q<sub>enc</sub> / &epsilon;&#x2080; &nbsp;&nbsp;&nbsp; (&Phi;<sub>E</sub> = &oint; E&#x20D7; &middot; dA&#x20D7;)</div>

    <div class="interactive-area">
      <div class="interactive-label">Superposition — Two Charges on x-axis</div>
      <p style="font-size:.72rem;color:var(--text-dim);margin-bottom:10px">q&#x2081; at x = -0.2 m, q&#x2082; at x = +0.2 m. Find E at origin (x=0).</p>
      <div class="slider-row">
        <label>q&#x2081; (nC)</label>
        <input type="range" id="supQ1" min="-10" max="10" value="6" step="0.5" oninput="updateSuper()">
        <span class="slider-val" id="supQ1Val">+6.0 nC</span>
      </div>
      <div class="slider-row">
        <label>q&#x2082; (nC)</label>
        <input type="range" id="supQ2" min="-10" max="10" value="-6" step="0.5" oninput="updateSuper()">
        <span class="slider-val" id="supQ2Val">-6.0 nC</span>
      </div>
      <div class="readout">
        <div class="readout-item"><div class="label">E from q&#x2081; at origin</div><div class="value indigo" id="supE1">—</div></div>
        <div class="readout-item"><div class="label">E from q&#x2082; at origin</div><div class="value indigo" id="supE2">—</div></div>
        <div class="readout-item"><div class="label">E<sub>net</sub> at origin</div><div class="value amber" id="supENet">—</div></div>
      </div>
    </div>

    <div class="practice-block">
      <div class="practice-title">Practice Problems</div>

      <div class="problem" id="p4a">
        <p><strong>1.</strong> Charge q&#x2081; = +4.0 &mu;C is at the origin. Charge q&#x2082; = -4.0 &mu;C is at (0.3 m, 0). What is the magnitude of the electric field (in N/C) at the midpoint (0.15 m, 0)?</p>
        <div class="problem-input-row">
          <input type="number" id="p4aAns" placeholder="N/C" step="1000">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p4aAns',3196000,50000,'p4aFB','p4a')">Check</button>
        </div>
        <div class="feedback" id="p4aFB"></div>
      </div>

      <div class="problem" id="p4b">
        <p><strong>2. (Multiple Choice)</strong> A solid metal sphere carries a net charge of +Q. Where is the electric field ZERO?</p>
        <div class="mc-choices" id="p4bMC">
          <button class="mc-btn" onclick="checkMC(this,'A','p4bMC','p4bFB','p4b')">A) At the center only</button>
          <button class="mc-btn" onclick="checkMC(this,'B','p4bMC','p4bFB','p4b')">B) Everywhere inside the sphere</button>
          <button class="mc-btn" onclick="checkMC(this,'C','p4bMC','p4bFB','p4b')">C) On the surface of the sphere</button>
          <button class="mc-btn" onclick="checkMC(this,'D','p4bMC','p4bFB','p4b')">D) Everywhere outside the sphere</button>
        </div>
        <div class="feedback" id="p4bFB"></div>
      </div>

      <div class="problem" id="p4c">
        <p><strong>3.</strong> A Gaussian surface (sphere, radius 0.5 m) encloses a charge of +8.85 &times; 10<sup>-11</sup> C. What is the total electric flux through the surface (in N&middot;m&sup2;/C)?</p>
        <div class="problem-input-row">
          <input type="number" id="p4cAns" placeholder="N·m²/C" step="0.1">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p4cAns',10,0.5,'p4cFB','p4c')">Check</button>
        </div>
        <div class="feedback" id="p4cFB"></div>
      </div>

      <div class="problem" id="p4d">
        <p><strong>4. (Multiple Choice)</strong> An electric dipole is placed in a uniform external electric field. What happens to the dipole?</p>
        <div class="mc-choices" id="p4dMC">
          <button class="mc-btn" onclick="checkMC(this,'A','p4dMC','p4dFB','p4d')">A) It accelerates in the direction of E</button>
          <button class="mc-btn" onclick="checkMC(this,'B','p4dMC','p4dFB','p4d')">B) It experiences a net torque that tends to align it with E</button>
          <button class="mc-btn" onclick="checkMC(this,'C','p4dMC','p4dFB','p4d')">C) It experiences a net force toward the stronger end of E</button>
          <button class="mc-btn" onclick="checkMC(this,'D','p4dMC','p4dFB','p4d')">D) It is completely unaffected because net charge is zero</button>
        </div>
        <div class="feedback" id="p4dFB"></div>
      </div>
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 5: MOTION OF CHARGES IN FIELDS -->
<!-- ============================================================ -->
<div class="section-card" data-section="5" id="sec5">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">5</span> Motion of Charges in Fields</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      A charge q placed in an electric field E experiences force F = qE. By Newton's second law, this produces acceleration a = F/m = qE/m. When an electron enters a uniform field perpendicular to its initial velocity, it follows a <strong>parabolic trajectory</strong> -- exactly analogous to projectile motion in gravity.
    </p>

    <div class="formula-box">F = qE &nbsp;&nbsp;&nbsp;&nbsp; a = qE/m</div>
    <div class="formula-box green">Deflection: y = (qE/2mv&#x2080;&sup2;) x&sup2;</div>

    <p class="concept-text">
      The <strong>cathode ray tube (CRT)</strong> is the classic application. Electrons are accelerated through a potential difference, then deflected horizontally and vertically by electric fields between plates. This was how early TVs and oscilloscopes worked. The same physics governs ink-jet printers and particle accelerators.
    </p>

    <div class="key-point">An electron (q = -e, m = 9.11 &times; 10<sup>-31</sup> kg) accelerates OPPOSITE to E because its charge is negative. The acceleration is enormously large: even modest fields produce accelerations many millions of g's.</div>

    <div class="interactive-area">
      <div class="interactive-label">Charge Trajectory Simulator</div>
      <p style="font-size:.72rem;color:var(--text-dim);margin-bottom:10px">Electron enters from left with horizontal velocity v&#x2080;. Uniform E field points upward between the plates.</p>
      <div class="slider-row">
        <label>E field (kN/C)</label>
        <input type="range" id="trajE" min="1" max="50" value="10" step="1" oninput="updateTraj()">
        <span class="slider-val" id="trajEVal">10 kN/C</span>
      </div>
      <div class="slider-row">
        <label>v&#x2080; (× 10&sup7; m/s)</label>
        <input type="range" id="trajV" min="1" max="10" value="3" step="0.5" oninput="updateTraj()">
        <span class="slider-val" id="trajVVal">3.0 × 10⁷ m/s</span>
      </div>
      <div class="canvas-wrap">
        <canvas id="trajCanvas" width="840" height="260"></canvas>
      </div>
      <div class="readout">
        <div class="readout-item"><div class="label">Acceleration a</div><div class="value indigo" id="trajA">—</div></div>
        <div class="readout-item"><div class="label">Exit deflection y</div><div class="value green" id="trajY">—</div></div>
        <div class="readout-item"><div class="label">Time in field</div><div class="value amber" id="trajT">—</div></div>
      </div>
    </div>

    <div class="practice-block">
      <div class="practice-title">Practice Problems</div>

      <div class="problem" id="p5a">
        <p><strong>1.</strong> An electron is in a uniform field of 500 N/C. What is its acceleration in m/s&sup2;? (m<sub>e</sub> = 9.11 &times; 10<sup>-31</sup> kg, e = 1.6 &times; 10<sup>-19</sup> C). Enter your answer as a multiple of 10<sup>13</sup> (e.g., enter 8.78 for 8.78 &times; 10<sup>13</sup>).</p>
        <div class="problem-input-row">
          <input type="number" id="p5aAns" placeholder="× 10¹³" step="0.01">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p5aAns',8.78,0.1,'p5aFB','p5a')">Check</button>
        </div>
        <div class="feedback" id="p5aFB"></div>
      </div>

      <div class="problem" id="p5b">
        <p><strong>2.</strong> A proton (m = 1.67 &times; 10<sup>-27</sup> kg) enters a uniform electric field E = 2000 N/C with initial horizontal velocity 5.0 &times; 10<sup>5</sup> m/s. The field region is 0.10 m wide. What is the vertical deflection (in mm) as the proton exits? (Round to 2 sig figs)</p>
        <div class="problem-input-row">
          <input type="number" id="p5bAns" placeholder="mm" step="0.01">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p5bAns',3.83,0.1,'p5bFB','p5b')">Check</button>
        </div>
        <div class="feedback" id="p5bFB"></div>
      </div>

      <div class="problem" id="p5c">
        <p><strong>3. (Multiple Choice)</strong> In a CRT, an electron passes through a potential difference of 5000 V to gain kinetic energy. This is an example of:</p>
        <div class="mc-choices" id="p5cMC">
          <button class="mc-btn" onclick="checkMC(this,'A','p5cMC','p5cFB','p5c')">A) Charging by induction</button>
          <button class="mc-btn" onclick="checkMC(this,'B','p5cMC','p5cFB','p5c')">B) Work done by the electric force converting electric PE to KE</button>
          <button class="mc-btn" onclick="checkMC(this,'C','p5cMC','p5cFB','p5c')">C) The electron gaining mass from the field</button>
          <button class="mc-btn" onclick="checkMC(this,'D','p5cMC','p5cFB','p5c')">D) The Coriolis effect on charged particles</button>
        </div>
        <div class="feedback" id="p5cFB"></div>
      </div>

      <div class="problem" id="p5d">
        <p><strong>4.</strong> An electron enters perpendicular to a field of 4.0 &times; 10<sup>3</sup> N/C with speed 2.0 &times; 10<sup>7</sup> m/s. How far (in cm) does it travel horizontally in 1.0 ns before it exits? (1 ns = 10<sup>-9</sup> s)</p>
        <div class="problem-input-row">
          <input type="number" id="p5dAns" placeholder="cm" step="0.1">
          <button class="btn btn-primary btn-sm" onclick="checkNum('p5dAns',2.0,0.1,'p5dFB','p5d')">Check</button>
        </div>
        <div class="feedback" id="p5dFB"></div>
      </div>
    </div>

  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 6: QUIZ -->
<!-- ============================================================ -->
<div class="section-card" data-section="6" id="sec6">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">6</span> 10-Question Quiz</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <div class="quiz-score">
      <span class="score-text">Score: <span id="quizScore">0</span> / <span id="quizTotal">10</span></span>
      <span style="font-size:.72rem;color:var(--text-dim)" id="quizStatus">Answer all questions to complete</span>
    </div>

    <div class="quiz-q" id="qq1">
      <div class="q-num">Question 1</div>
      <div class="q-text">The elementary charge e is approximately:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq1','A','A')">A) 1.6 &times; 10<sup>-19</sup> C</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq1','B','A')">B) 9.11 &times; 10<sup>-31</sup> C</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq1','C','A')">C) 6.67 &times; 10<sup>-11</sup> C</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq1','D','A')">D) 8.99 &times; 10<sup>9</sup> C</button>
      </div>
    </div>

    <div class="quiz-q" id="qq2">
      <div class="q-num">Question 2</div>
      <div class="q-text">Two identical positive charges are moved twice as far apart. The Coulomb force between them becomes:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq2','A','C')">A) Twice as large</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq2','B','C')">B) Half as large</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq2','C','C')">C) One-quarter as large</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq2','D','C')">D) Four times as large</button>
      </div>
    </div>

    <div class="quiz-q" id="qq3">
      <div class="q-num">Question 3</div>
      <div class="q-text">Coulomb's constant k = 8.99 &times; 10<sup>9</sup> N&middot;m&sup2;/C&sup2;. The electric force between two 1 C charges 1 m apart is approximately:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq3','A','A')">A) 9 &times; 10<sup>9</sup> N</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq3','B','A')">B) 9 &times; 10<sup>3</sup> N</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq3','C','A')">C) 9 N</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq3','D','A')">D) 1 N</button>
      </div>
    </div>

    <div class="quiz-q" id="qq4">
      <div class="q-num">Question 4</div>
      <div class="q-text">The electric field E at a point is defined as:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq4','A','B')">A) The total force on any charge at that point</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq4','B','B')">B) The force per unit positive test charge at that point</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq4','C','B')">C) The charge per unit area of a conductor</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq4','D','B')">D) k times the source charge</button>
      </div>
    </div>

    <div class="quiz-q" id="qq5">
      <div class="q-num">Question 5</div>
      <div class="q-text">The electric field inside a conductor in electrostatic equilibrium is:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq5','A','D')">A) Equal to the applied external field</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq5','B','D')">B) Very large near the surface</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq5','C','D')">C) Directed radially outward</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq5','D','D')">D) Zero</button>
      </div>
    </div>

    <div class="quiz-q" id="qq6">
      <div class="q-num">Question 6</div>
      <div class="q-text">Which best describes charging by induction?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq6','A','C')">A) Rubbing two objects together to transfer electrons</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq6','B','C')">B) Touching a charged object to a neutral conductor</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq6','C','C')">C) Using a nearby charge to redistribute charge without contact, then grounding</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq6','D','C')">D) Heating a metal until electrons are released</button>
      </div>
    </div>

    <div class="quiz-q" id="qq7">
      <div class="q-num">Question 7</div>
      <div class="q-text">An electron (charge -e) is placed in a uniform field pointing to the right. The electron will:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq7','A','B')">A) Accelerate to the right</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq7','B','B')">B) Accelerate to the left</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq7','C','B')">C) Experience no force</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq7','D','B')">D) Accelerate upward</button>
      </div>
    </div>

    <div class="quiz-q" id="qq8">
      <div class="q-num">Question 8</div>
      <div class="q-text">Gauss's Law states that the total electric flux through a closed surface equals:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq8','A','D')">A) kQ</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq8','B','D')">B) Q / k</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq8','C','D')">C) &epsilon;&#x2080; Q</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq8','D','D')">D) Q / &epsilon;&#x2080;</button>
      </div>
    </div>

    <div class="quiz-q" id="qq9">
      <div class="q-num">Question 9</div>
      <div class="q-text">A proton and an electron are released from rest in the same uniform electric field. Compared to the electron, the proton will accelerate:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq9','A','C')">A) In the same direction at the same rate</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq9','B','C')">B) In the same direction at a smaller rate</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq9','C','C')">C) In the opposite direction at a much smaller rate</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq9','D','C')">D) In the opposite direction at the same rate</button>
      </div>
    </div>

    <div class="quiz-q" id="qq10">
      <div class="q-num">Question 10</div>
      <div class="q-text">Electric field lines between two oppositely charged parallel plates are:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq10','A','B')">A) Curved, pointing from negative to positive plate</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq10','B','B')">B) Straight, parallel, pointing from positive to negative plate</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq10','C','B')">C) Straight, parallel, pointing from negative to positive plate</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq10','D','B')">D) Radially outward from both plates</button>
      </div>
    </div>

  </div></div>
</div>

</div><!-- /content -->

<script>
// ============================================================
// GLOBAL STATE
// ============================================================
const TOTAL_SECTIONS = 6;
const sectionCorrect = {}; // sectionId -> Set of problem ids answered correctly
for(let i=1;i<=TOTAL_SECTIONS;i++) sectionCorrect[i]=new Set();

// Problems per section (for completion tracking, quiz auto-completes its section)
const sectionProblems = {
  1: ['p1a','p1b','p1c','p1d'],
  2: ['p2a','p2b','p2c','p2d'],
  3: ['p3a','p3b','p3c','p3d'],
  4: ['p4a','p4b','p4c','p4d'],
  5: ['p5a','p5b','p5c','p5d'],
  6: ['quiz']
};

// ============================================================
// SECTION TOGGLE
// ============================================================
function toggleSection(header){
  const card = header.closest('.section-card');
  card.classList.toggle('open');
}

// ============================================================
// PROGRESS
// ============================================================
function updateProgress(){
  let done = 0;
  for(let s=1;s<=TOTAL_SECTIONS;s++){
    const card = document.getElementById('sec'+s);
    if(card && card.classList.contains('completed')) done++;
  }
  const pct = (done/TOTAL_SECTIONS)*100;
  document.getElementById('progressFill').style.width = pct+'%';
  document.getElementById('progressLabel').textContent = done+' / '+TOTAL_SECTIONS+' sections';
}

function checkSectionComplete(sectionId){
  if(sectionId === 6) return; // quiz handled separately
  const needed = sectionProblems[sectionId];
  const got = sectionCorrect[sectionId];
  if(needed.every(id=>got.has(id))){
    const card = document.getElementById('sec'+sectionId);
    if(card) card.classList.add('completed');
    updateProgress();
  }
}

// ============================================================
// FEEDBACK HELPERS
// ============================================================
function setFeedback(id, isCorrect, msg){
  const el = document.getElementById(id);
  if(!el) return;
  el.className = 'feedback '+(isCorrect?'correct':'incorrect');
  el.textContent = msg;
  el.style.display='block';
  // animation on parent problem
  const prob = el.closest('.problem') || el.closest('.quiz-q');
  if(prob){
    prob.classList.remove('pop','shake');
    void prob.offsetWidth;
    prob.classList.add(isCorrect?'pop':'shake');
  }
}

// ============================================================
// CHECK NUMERIC
// ============================================================
function checkNum(inputId, answer, tolerance, feedbackId, problemId){
  const val = parseFloat(document.getElementById(inputId).value);
  if(isNaN(val)){
    setFeedback(feedbackId, false, 'Enter a numeric value.');
    return;
  }
  const correct = Math.abs(val - answer) <= tolerance;
  // Determine section
  const secId = getSectionForProblem(problemId);
  if(correct){
    setFeedback(feedbackId, true, 'Correct! Well done.');
    if(secId) sectionCorrect[secId].add(problemId);
    checkSectionComplete(secId);
  } else {
    setFeedback(feedbackId, false, 'Not quite. Check your units and setup. Expected ~'+answer);
  }
}

// ============================================================
// CHECK MULTIPLE CHOICE
// ============================================================
function checkMC(btn, chosen, mcGroupId, feedbackId, problemId, correct){
  // Correct answer is passed as 5th positional — extract from btn parent
  // We embed correct answer in data or rely on call signature
  // Using: onclick="checkMC(this,'A','p1cMC','p1cFB','p1c')" -- correct is determined per-problem
  const correctMap = {
    'p1cMC':'B','p2dMC':'B',
    'p3cMC':'B',
    'p4bMC':'B','p4dMC':'B',
    'p5cMC':'B'
  };
  const correctAnswer = correctMap[mcGroupId];
  const isCorrect = chosen === correctAnswer;

  const group = document.getElementById(mcGroupId);
  const allBtns = group.querySelectorAll('.mc-btn');
  allBtns.forEach(b=>b.classList.add('disabled'));

  if(isCorrect){
    btn.classList.add('correct');
    btn.classList.remove('disabled');
  } else {
    btn.classList.add('wrong');
    // Reveal correct
    allBtns.forEach(b=>{
      if(b.textContent.trim().startsWith(correctAnswer)) b.classList.add('correct');
    });
  }

  const secId = getSectionForProblem(problemId);
  const feedbackTexts = {
    'p1cFB': isCorrect ? 'Correct! The induced negative charge flows to ground; after grounding removed and rod removed, sphere is left positive.' : 'Incorrect. By induction: negative charges are attracted to the left side, positive remains on right. When grounded, electrons flow in from ground (more negative added). Wait — the rod is negative, so negative charges on rod repel electrons on sphere to ground. After grounding removed: positive net. Answer: B.',
    'p2dFB': isCorrect ? 'Correct! Setting kq/x² = k(4q)/(d-x)² gives x = d/3 from the +q charge.' : 'Incorrect. Zero-force point: kq/x² = 4kq/(d-x)². Solve: (d-x)² = 4x², d-x = 2x, x = d/3 from +q.',
    'p3cFB': isCorrect ? 'Correct! A negative test charge moves opposite to E (since F = qE with q negative).' : 'Incorrect. Field lines start on + and end on -. Lines never cross. Closer spacing = stronger field. A negative charge experiences force OPPOSITE to E.',
    'p4bFB': isCorrect ? 'Correct! Inside any conductor in electrostatic equilibrium, E = 0 everywhere (not just center).' : 'Incorrect. E = 0 everywhere inside a conductor in electrostatic equilibrium — not just at the center.',
    'p4dFB': isCorrect ? 'Correct! A dipole in a uniform field experiences zero net force but a net torque aligning it with E.' : 'Incorrect. In a uniform field, forces on +q and -q are equal and opposite (net force = 0) but create a torque.',
    'p5cFB': isCorrect ? 'Correct! The electric force does work on the electron as it moves through the potential difference, converting PE to KE.' : 'Incorrect. Work-energy theorem: W = qV. The electric force does work on the electron equal to eV, which becomes kinetic energy.'
  };

  const msg = feedbackTexts[feedbackId] || (isCorrect ? 'Correct!' : 'Incorrect — review and try again.');
  setFeedback(feedbackId, isCorrect, msg);

  if(isCorrect && secId){
    sectionCorrect[secId].add(problemId);
    checkSectionComplete(secId);
  }
}

function getSectionForProblem(pid){
  for(let s=1;s<=5;s++){
    if((sectionProblems[s]||[]).includes(pid)) return s;
  }
  return null;
}

// ============================================================
// QUIZ
// ============================================================
let quizScore = 0;
let quizAnswered = 0;
const quizAnswers = {};

function quizAnswer(btn, qId, chosen, correct){
  if(quizAnswers[qId] !== undefined) return;
  quizAnswers[qId] = chosen;

  const qEl = document.getElementById(qId);
  const allBtns = qEl.querySelectorAll('.choice-btn');
  allBtns.forEach(b=>b.classList.add('disabled'));

  const isCorrect = chosen === correct;
  if(isCorrect){
    btn.classList.add('selected-correct');
    quizScore++;
    document.getElementById('quizScore').textContent = quizScore;
  } else {
    btn.classList.add('selected-wrong');
    allBtns.forEach(b=>{
      if(b.getAttribute('onclick').includes("'"+correct+"'") || b.getAttribute('onclick').match(new RegExp("'"+correct+"'[^,]*,\\s*'"+correct+"'"))){
        // find correct btn by checking its onclick
      }
    });
    // Reveal correct answer
    allBtns.forEach(b=>{
      const oc = b.getAttribute('onclick');
      const m = oc.match(/quizAnswer\(this,'[^']+','([^']+)','([^']+)'\)/);
      if(m && m[1]===correct) b.classList.add('reveal-correct');
    });
  }

  // animation
  qEl.classList.remove('pop','shake');
  void qEl.offsetWidth;
  qEl.classList.add(isCorrect?'pop':'shake');

  quizAnswered++;
  if(quizAnswered === 10){
    const pct = Math.round((quizScore/10)*100);
    document.getElementById('quizStatus').textContent = 'Quiz complete: '+pct+'%';
    const card = document.getElementById('sec6');
    if(card) card.classList.add('completed');
    updateProgress();
  }
}

// ============================================================
// COULOMB SIMULATOR
// ============================================================
function updateCoulomb(){
  const q1 = parseFloat(document.getElementById('clQ1').value)*1e-9;
  const q2 = parseFloat(document.getElementById('clQ2').value)*1e-9;
  const r  = parseFloat(document.getElementById('clR').value)*0.01;
  const q1nC = (q1*1e9).toFixed(1);
  const q2nC = (q2*1e9).toFixed(1);
  document.getElementById('clQ1Val').textContent = (q1nC>0?'+':'')+q1nC+' nC';
  document.getElementById('clQ2Val').textContent = (q2nC>0?'+':'')+q2nC+' nC';
  document.getElementById('clRVal').textContent = (r*100).toFixed(1)+' cm';

  const k = 8.99e9;
  const F = k*Math.abs(q1)*Math.abs(q2)/(r*r);
  const attract = (q1*q2 < 0);

  // Format force
  let fStr;
  if(F >= 1e-3) fStr = F.toFixed(4)+' N';
  else if(F >= 1e-6) fStr = (F*1e3).toFixed(3)+' mN';
  else fStr = (F*1e6).toFixed(3)+' μN';

  document.getElementById('clForce').textContent = fStr;

  const dirEl = document.getElementById('clDirection');
  dirEl.textContent = attract ? 'ATTRACT' : 'REPEL';
  dirEl.className = 'value '+(attract?'green':'pink');

  // Gravity ratio (1g masses)
  const G = 6.674e-11, m = 0.001;
  const Fg = G*m*m/(r*r);
  const ratio = F/Fg;
  document.getElementById('clGravRatio').textContent = ratio.toExponential(2)+'× stronger';

  drawCoulombCanvas(q1,q2,r,attract,F);
}

function drawCoulombCanvas(q1,q2,r,attract,F){
  const c = document.getElementById('coulombCanvas');
  const ctx = c.getContext('2d');
  const W = c.width, H = c.height;
  ctx.clearRect(0,0,W,H);

  // Scale canvas display size to actual pixels
  const dpr = window.devicePixelRatio||1;

  const cx = W/2, cy = H/2;
  const maxSep = W*0.35;
  const rScale = Math.min(r*100/20, 1);
  const sep = 60 + rScale*(maxSep-60);

  // Charge circles
  const r1x = cx - sep/2, r2x = cx + sep/2;
  const radius = 22;

  // Arrow length based on force
  const maxF_display = 5e-3;
  const arrowLen = Math.min(F/maxF_display, 1)*60;

  // Draw connecting line
  ctx.strokeStyle = 'rgba(99,102,241,0.2)';
  ctx.lineWidth = 1;
  ctx.setLineDash([4,4]);
  ctx.beginPath();ctx.moveTo(r1x+radius,cy);ctx.lineTo(r2x-radius,cy);ctx.stroke();
  ctx.setLineDash([]);

  // Draw force arrows
  const arrowColor = attract ? '#22c55e' : '#ec4899';
  if(attract){
    drawArrow(ctx, r1x-10, cy, r1x-10+arrowLen, cy, arrowColor);
    drawArrow(ctx, r2x+10, cy, r2x+10-arrowLen, cy, arrowColor);
  } else {
    drawArrow(ctx, r1x-10, cy, r1x-10-arrowLen, cy, arrowColor);
    drawArrow(ctx, r2x+10, cy, r2x+10+arrowLen, cy, arrowColor);
  }

  // q1 circle
  const c1 = q1>=0 ? '#ec4899':'#6366f1';
  ctx.beginPath();ctx.arc(r1x,cy,radius,0,Math.PI*2);
  ctx.fillStyle=c1.replace(')',',0.25)').replace('rgb','rgba').replace('#','');
  ctx.fill();
  ctx.beginPath();ctx.arc(r1x,cy,radius,0,Math.PI*2);
  ctx.strokeStyle=c1;ctx.lineWidth=2;ctx.stroke();
  ctx.fillStyle='#fff';ctx.font='bold 13px JetBrains Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(q1>=0?'q₁+':'q₁−',r1x,cy);

  // q2 circle
  const c2 = q2>=0 ? '#ec4899':'#6366f1';
  ctx.beginPath();ctx.arc(r2x,cy,radius,0,Math.PI*2);
  ctx.fillStyle=c2.replace(')',',0.25)').replace('rgb','rgba').replace('#','');
  ctx.fill();
  ctx.beginPath();ctx.arc(r2x,cy,radius,0,Math.PI*2);
  ctx.strokeStyle=c2;ctx.lineWidth=2;ctx.stroke();
  ctx.fillStyle='#fff';ctx.font='bold 13px JetBrains Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(q2>=0?'q₂+':'q₂−',r2x,cy);

  // Distance label
  ctx.fillStyle='#9ca3af';ctx.font='11px JetBrains Mono,monospace';ctx.textAlign='center';
  ctx.fillText('r = '+(r*100).toFixed(1)+' cm', cx, cy+38);
}

function drawArrow(ctx,x1,y1,x2,y2,color){
  const angle = Math.atan2(y2-y1,x2-x1);
  const len = Math.hypot(x2-x1,y2-y1);
  if(len < 5) return;
  ctx.strokeStyle=color;ctx.lineWidth=2.5;ctx.fillStyle=color;
  ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();
  const hLen=10, hAngle=0.4;
  ctx.beginPath();
  ctx.moveTo(x2,y2);
  ctx.lineTo(x2-hLen*Math.cos(angle-hAngle),y2-hLen*Math.sin(angle-hAngle));
  ctx.lineTo(x2-hLen*Math.cos(angle+hAngle),y2-hLen*Math.sin(angle+hAngle));
  ctx.closePath();ctx.fill();
}

// ============================================================
// ELECTRIC FIELD VISUALIZER
// ============================================================
const fieldCharges = [];
const CANVAS_W = 840, CANVAS_H = 340;

function initFieldCanvas(){
  const c = document.getElementById('fieldCanvas');
  c.addEventListener('click', function(e){
    if(e.shiftKey){ clearFieldCharges(); return; }
    if(fieldCharges.length >= 3) return;
    const rect = c.getBoundingClientRect();
    const scaleX = CANVAS_W/rect.width;
    const scaleY = CANVAS_H/rect.height;
    const x = (e.clientX - rect.left)*scaleX;
    const y = (e.clientY - rect.top)*scaleY;
    fieldCharges.push({x, y, q: +1});
    updateFieldCount();
    drawFieldCanvas();
  });
  c.addEventListener('contextmenu', function(e){
    e.preventDefault();
    if(fieldCharges.length >= 3) return;
    const rect = c.getBoundingClientRect();
    const scaleX = CANVAS_W/rect.width;
    const scaleY = CANVAS_H/rect.height;
    const x = (e.clientX - rect.left)*scaleX;
    const y = (e.clientY - rect.top)*scaleY;
    fieldCharges.push({x, y, q: -1});
    updateFieldCount();
    drawFieldCanvas();
  });
  drawFieldCanvas();
}

function clearFieldCharges(){
  fieldCharges.length=0;
  updateFieldCount();
  drawFieldCanvas();
}

function updateFieldCount(){
  document.getElementById('fieldChargeCount').textContent =
    fieldCharges.length+' charge'+(fieldCharges.length===1?'':'s')+' placed (max 3)';
}

function getField(x,y){
  let ex=0,ey=0;
  for(const c of fieldCharges){
    const dx=x-c.x, dy=y-c.y;
    const r2=dx*dx+dy*dy;
    if(r2<200) continue;
    const r=Math.sqrt(r2);
    const mag=c.q/(r2);
    ex+=mag*(dx/r);ey+=mag*(dy/r);
  }
  return {ex,ey};
}

function drawFieldCanvas(){
  const c = document.getElementById('fieldCanvas');
  const ctx = c.getContext('2d');
  ctx.clearRect(0,0,CANVAS_W,CANVAS_H);

  // Background
  ctx.fillStyle='#1a1d24';
  ctx.fillRect(0,0,CANVAS_W,CANVAS_H);

  if(fieldCharges.length === 0){
    ctx.fillStyle='#9ca3af';ctx.font='14px JetBrains Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText('Left-click to place + charge  |  Right-click to place − charge',CANVAS_W/2,CANVAS_H/2);
    return;
  }

  // Draw field lines from each positive charge
  const numLines = 16;
  for(const charge of fieldCharges){
    const startCharge = charge.q > 0 ? charge : null;
    if(!startCharge) continue;
    for(let i=0;i<numLines;i++){
      const angle = (i/numLines)*Math.PI*2;
      const startR = 18;
      let x = charge.x + Math.cos(angle)*startR;
      let y = charge.y + Math.sin(angle)*startR;

      ctx.beginPath();
      ctx.moveTo(x,y);
      const steps = 300;
      const stepSize = 3;
      let prevX=x, prevY=y;
      let drawn=false;
      for(let s=0;s<steps;s++){
        const {ex,ey} = getField(x,y);
        const mag = Math.sqrt(ex*ex+ey*ey);
        if(mag<1e-10) break;
        const nx = x + (ex/mag)*stepSize;
        const ny = y + (ey/mag)*stepSize;
        if(nx<0||nx>CANVAS_W||ny<0||ny>CANVAS_H) break;
        // Check if near a negative charge
        let nearNeg=false;
        for(const c2 of fieldCharges){
          if(c2.q<0 && Math.hypot(nx-c2.x,ny-c2.y)<16){nearNeg=true;break;}
        }
        ctx.lineTo(nx,ny);
        drawn=true;
        if(nearNeg) break;
        // Check if circling (too close to source)
        let nearSrc=false;
        for(const c2 of fieldCharges){
          if(c2===charge) continue;
          if(Math.hypot(nx-c2.x,ny-c2.y)<16){nearSrc=true;break;}
        }
        if(nearSrc) break;
        prevX=x;prevY=y;x=nx;y=ny;
      }
      if(drawn){
        ctx.strokeStyle='rgba(99,102,241,0.55)';ctx.lineWidth=1.2;ctx.stroke();
        // Draw arrowhead near midpoint
        drawFieldArrow(ctx,prevX,prevY,x,y);
      }
    }
  }

  // Draw negative charge field lines (incoming)
  for(const charge of fieldCharges){
    if(charge.q > 0) continue;
    for(let i=0;i<numLines;i++){
      const angle = (i/numLines)*Math.PI*2;
      // Start far from charge, trace toward it
      const startR = 90;
      let x = charge.x + Math.cos(angle)*startR;
      let y = charge.y + Math.sin(angle)*startR;
      if(x<0||x>CANVAS_W||y<0||y>CANVAS_H) continue;

      // Check if there's a positive charge nearby — those lines already handled
      let hasPosSource=false;
      for(const c2 of fieldCharges){
        if(c2.q>0) {hasPosSource=true; break;}
      }
      if(hasPosSource) continue; // lines already drawn from positive

      ctx.beginPath();ctx.moveTo(x,y);
      const steps=200, stepSize=3;
      let prevX=x,prevY=y;let drawn2=false;
      for(let s=0;s<steps;s++){
        const {ex,ey}=getField(x,y);
        const mag=Math.sqrt(ex*ex+ey*ey);
        if(mag<1e-10) break;
        // Trace BACKWARD (toward negative charge = follow field reversed)
        const nx=x-(ex/mag)*stepSize, ny=y-(ey/mag)*stepSize;
        if(nx<0||nx>CANVAS_W||ny<0||ny>CANVAS_H) break;
        if(Math.hypot(nx-charge.x,ny-charge.y)<16) break;
        ctx.lineTo(nx,ny);drawn2=true;
        prevX=x;prevY=y;x=nx;y=ny;
      }
      if(drawn2){
        ctx.strokeStyle='rgba(99,102,241,0.45)';ctx.lineWidth=1.2;ctx.stroke();
      }
    }
  }

  // Draw charges as circles
  for(const charge of fieldCharges){
    const col = charge.q>0 ? '#ec4899' : '#6366f1';
    ctx.beginPath();ctx.arc(charge.x,charge.y,14,0,Math.PI*2);
    ctx.fillStyle=col+'33';ctx.fill();
    ctx.beginPath();ctx.arc(charge.x,charge.y,14,0,Math.PI*2);
    ctx.strokeStyle=col;ctx.lineWidth=2;ctx.stroke();
    ctx.fillStyle='#fff';ctx.font='bold 14px JetBrains Mono,monospace';
    ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText(charge.q>0?'+':'−',charge.x,charge.y);
  }
}

function drawFieldArrow(ctx,x1,y1,x2,y2){
  const dx=x2-x1,dy=y2-y1;
  const len=Math.hypot(dx,dy);
  if(len<2) return;
  const angle=Math.atan2(dy,dx);
  const hLen=7,hAngle=0.45;
  ctx.fillStyle='rgba(99,102,241,0.7)';
  ctx.beginPath();
  ctx.moveTo(x2,y2);
  ctx.lineTo(x2-hLen*Math.cos(angle-hAngle),y2-hLen*Math.sin(angle-hAngle));
  ctx.lineTo(x2-hLen*Math.cos(angle+hAngle),y2-hLen*Math.sin(angle+hAngle));
  ctx.closePath();ctx.fill();
}

// ============================================================
// SUPERPOSITION CALCULATOR
// ============================================================
function updateSuper(){
  const q1 = parseFloat(document.getElementById('supQ1').value)*1e-9;
  const q2 = parseFloat(document.getElementById('supQ2').value)*1e-9;
  const q1nC = (q1*1e9).toFixed(1), q2nC = (q2*1e9).toFixed(1);
  document.getElementById('supQ1Val').textContent=(q1nC>0?'+':'')+q1nC+' nC';
  document.getElementById('supQ2Val').textContent=(q2nC>0?'+':'')+q2nC+' nC';

  const k=8.99e9;
  const r=0.2; // 0.2 m from origin to each charge
  // E from q1 (at x=-0.2) at origin: direction is +x if q1>0, -x if q1<0
  const E1mag = k*Math.abs(q1)/(r*r);
  const E1x = q1>0 ? E1mag : -E1mag; // +x means rightward from q1 at origin

  // E from q2 (at x=+0.2) at origin: direction is -x if q2>0, +x if q2<0
  const E2mag = k*Math.abs(q2)/(r*r);
  const E2x = q2>0 ? -E2mag : E2mag;

  const EnetX = E1x + E2x;

  function fmtE(val){
    const s=val>=0?'+':'-';
    const v=Math.abs(val);
    if(v>=1000) return s+(v/1000).toFixed(1)+' kN/C';
    return s+v.toFixed(0)+' N/C';
  }

  document.getElementById('supE1').textContent = fmtE(E1x)+' (x-dir)';
  document.getElementById('supE2').textContent = fmtE(E2x)+' (x-dir)';
  document.getElementById('supENet').textContent = fmtE(EnetX)+' (x-dir)';
}

// ============================================================
// TRAJECTORY SIMULATOR
// ============================================================
function updateTraj(){
  const E = parseFloat(document.getElementById('trajE').value)*1e3; // N/C
  const v0 = parseFloat(document.getElementById('trajV').value)*1e7; // m/s
  document.getElementById('trajEVal').textContent=(E/1e3).toFixed(0)+' kN/C';
  document.getElementById('trajVVal').textContent=(v0/1e7).toFixed(1)+' × 10⁷ m/s';

  const me = 9.11e-31, e = 1.6e-19;
  const a = e*E/me;
  const L = 0.06; // plate length 6 cm
  const t = L/v0;
  const y = 0.5*a*t*t;

  // Format
  function fmtSci(v,u){
    const exp = Math.floor(Math.log10(Math.abs(v)));
    return (v/Math.pow(10,exp)).toFixed(2)+'×10^'+exp+' '+u;
  }

  document.getElementById('trajA').textContent = fmtSci(a,'m/s²');
  document.getElementById('trajY').textContent = (y*1000).toFixed(2)+' mm';
  document.getElementById('trajT').textContent = (t*1e9).toFixed(2)+' ns';

  drawTrajCanvas(E,v0,a,L,t,y);
}

function drawTrajCanvas(E,v0,a,L,t_exit,y_exit){
  const c = document.getElementById('trajCanvas');
  const ctx = c.getContext('2d');
  const W=c.width, H=c.height;
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle='#1a1d24';ctx.fillRect(0,0,W,H);

  const plateLx=80, plateRx=80+580;
  const plateTop=50, plateBot=H-50;
  const midY=(plateTop+plateBot)/2;
  const plateH=plateBot-plateTop;

  // Plates
  ctx.fillStyle='rgba(245,158,11,0.15)';
  ctx.fillRect(plateLx,plateTop,plateRx-plateLx,8);
  ctx.fillRect(plateLx,plateBot-8,plateRx-plateLx,8);
  ctx.strokeStyle='#f59e0b';ctx.lineWidth=2;
  ctx.strokeRect(plateLx,plateTop,plateRx-plateLx,8);
  ctx.strokeRect(plateLx,plateBot-8,plateRx-plateLx,8);

  // + - labels
  ctx.fillStyle='#ec4899';ctx.font='bold 14px JetBrains Mono,monospace';ctx.textAlign='center';
  ctx.fillText('+',plateLx-20,plateTop+10);
  ctx.fillStyle='#6366f1';ctx.fillText('−',plateLx-20,plateBot);

  // E field arrows between plates
  ctx.strokeStyle='rgba(245,158,11,0.3)';ctx.lineWidth=1;
  for(let xx=plateLx+40;xx<plateRx-20;xx+=60){
    drawArrow(ctx,xx,plateTop+20,xx,plateBot-20,'rgba(245,158,11,0.3)');
  }
  ctx.fillStyle='#f59e0b';ctx.font='11px JetBrains Mono,monospace';ctx.textAlign='left';
  ctx.fillText('E field',plateRx-70,midY);

  // Scale: plate length L maps to (plateRx-plateLx) pixels
  const pxPerMeter = (plateRx-plateLx)/L;
  const pxPerMeterY = plateH * 0.8; // scale y so max deflection fits
  const maxY = plateH*0.35;
  const yScale = Math.min(maxY/Math.max(y_exit*1000,0.001), pxPerMeterY);

  // Trajectory (parabola inside)
  ctx.beginPath();
  ctx.strokeStyle='#22c55e';ctx.lineWidth=2.5;
  const steps=80;
  for(let i=0;i<=steps;i++){
    const xi = (i/steps)*L;
    const ti = xi/v0;
    const yi = 0.5*a*ti*ti;
    const px = plateLx + xi*pxPerMeter;
    const py = midY - yi*yScale*500;
    if(i===0) ctx.moveTo(px,py);
    else ctx.lineTo(px,py);
  }
  ctx.stroke();

  // Continue straight after exit
  const exitX = plateRx;
  const exitY_px = midY - y_exit*yScale*500;
  const exitVy = a*t_exit;
  const slope = -exitVy/v0;
  ctx.beginPath();ctx.strokeStyle='rgba(34,197,94,0.4)';ctx.lineWidth=1.5;ctx.setLineDash([6,4]);
  ctx.moveTo(exitX,exitY_px);
  ctx.lineTo(exitX+120,exitY_px+slope*120);
  ctx.stroke();ctx.setLineDash([]);

  // Electron dot entering
  ctx.beginPath();ctx.arc(plateLx,midY,7,0,Math.PI*2);
  ctx.fillStyle='#6366f1';ctx.fill();
  ctx.strokeStyle='#818cf8';ctx.lineWidth=1.5;ctx.stroke();
  ctx.fillStyle='#fff';ctx.font='bold 9px JetBrains Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText('e⁻',plateLx,midY);

  // Velocity arrow
  drawArrow(ctx,plateLx+10,midY,plateLx+50,midY,'#6366f1');
  ctx.fillStyle='#9ca3af';ctx.font='10px JetBrains Mono,monospace';ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText('v₀',plateLx+30,midY-14);

  // Labels
  ctx.fillStyle='#9ca3af';ctx.font='10px JetBrains Mono,monospace';ctx.textAlign='center';ctx.textBaseline='top';
  ctx.fillText('L = 6 cm (plate region)',plateLx+(plateRx-plateLx)/2,H-22);
}

// ============================================================
// RESIZE HANDLING FOR CANVASES
// ============================================================
function resizeCanvases(){
  ['coulombCanvas','trajCanvas','fieldCanvas'].forEach(id=>{
    const c=document.getElementById(id);
    if(!c) return;
    const wrap=c.parentElement;
    const ww=wrap.clientWidth;
    c.style.width=ww+'px';
    c.style.height=(c.getAttribute('height')/c.getAttribute('width')*ww)+'px';
  });
}

// ============================================================
// INIT
// ============================================================
window.addEventListener('DOMContentLoaded',()=>{
  resizeCanvases();
  updateCoulomb();
  updateSuper();
  updateTraj();
  initFieldCanvas();
  updateProgress();
});
window.addEventListener('resize', ()=>{
  resizeCanvases();
  updateCoulomb();
  updateTraj();
  drawFieldCanvas();
});
</script>
</body>
</html>
