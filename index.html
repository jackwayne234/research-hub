<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Riner Research Hub ‚Äî Prime Gravity</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#0a0a1a;--card:#111128;--card-border:#1a1a3a;--text:#e0e0f0;--text-dim:#8888aa;
--accent1:#6366f1;--accent2:#a855f7;--accent3:#ec4899;--green:#22c55e;--orange:#f59e0b;
/* Chalkboard palette */
--chalk:#d4cfc4;--chalk-dim:rgba(212,207,196,.35);--chalk-faint:rgba(212,207,196,.15);
--board:#2b2f3a;--board-light:#343a46;--board-dark:#1e2128;
}
html,body{width:100%;height:100%;overflow:hidden;font-family:'JetBrains Mono',monospace;background:var(--board-dark);color:var(--text)}

/* ‚îÄ‚îÄ SVG noise filter (referenced by chalkboard) ‚îÄ‚îÄ */
#chalk-noise{position:absolute;width:0;height:0}

/* ‚îÄ‚îÄ Chalkboard Background (fallback behind video) ‚îÄ‚îÄ */
#chalkboard{
  position:fixed;inset:0;z-index:0;
  background-color: var(--board);
}

/* Leaflet Map Background */
#map-bg{position:fixed;inset:0;z-index:0;display:none}
#map-bg .leaflet-control-zoom{display:none}
#map-bg .leaflet-control-attribution{font-size:9px;opacity:.3}
@keyframes locPulse{0%,100%{box-shadow:0 0 0 0 rgba(59,130,246,.6)}50%{box-shadow:0 0 0 12px rgba(59,130,246,0)}}
.user-loc{width:14px;height:14px;background:#3b82f6;border:2px solid #fff;border-radius:50%;animation:locPulse 2s ease-in-out infinite}
.iss-label{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--chalk);background:rgba(30,33,40,.8);padding:2px 6px;border-radius:3px;border:1px solid rgba(212,207,196,.2);white-space:nowrap}

/* YouTube Background */
#yt-bg{position:fixed;inset:0;z-index:0;overflow:hidden;background:transparent}
#yt-bg iframe{position:absolute;top:50%;left:50%;min-width:200vh;min-height:60vw;width:200vh;height:120vh;transform:translate(-50%,-50%);pointer-events:none}

/* Overlays */
#scanlines{position:fixed;inset:0;z-index:1;pointer-events:none;
background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.04) 2px,rgba(0,0,0,.04) 4px)}
#vignette{position:fixed;inset:0;z-index:1;pointer-events:none;
background:radial-gradient(ellipse at center,transparent 40%,rgba(0,0,0,.5) 100%)}

/* Status Bar */
#status-bar{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;justify-content:space-between;align-items:center;
padding:8px 20px;background:rgba(30,33,40,.88);backdrop-filter:blur(8px);border-bottom:1px solid rgba(212,207,196,.12);font-size:12px;letter-spacing:1px}
#status-bar .left{display:flex;align-items:center;gap:8px;color:var(--chalk);font-weight:700;text-transform:uppercase}
#status-bar .right{display:flex;align-items:center;gap:16px;color:rgba(212,207,196,.5);font-size:11px}
.pulse-dot{width:8px;height:8px;border-radius:50%;background:var(--green);animation:pulse 2s ease-in-out infinite;display:inline-block}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 4px var(--green)}50%{opacity:.4;box-shadow:0 0 8px var(--green)}}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
#sidebar{
  position:fixed;left:0;top:36px;bottom:0;z-index:50;
  width:56px;
  background:rgba(30,33,40,.65);
  backdrop-filter:blur(6px);
  border-right:1px solid rgba(212,207,196,.08);
  display:flex;flex-direction:column;align-items:center;
  padding:12px 0;gap:4px;
  transition:width .3s ease;
  overflow:hidden;
}
/* Chalk-dust edge on the right border */
#sidebar::after{
  content:'';position:absolute;right:-1px;top:0;bottom:0;width:3px;
  background:linear-gradient(180deg,
    transparent 0%,
    rgba(212,207,196,.06) 10%,
    rgba(212,207,196,.1) 25%,
    rgba(212,207,196,.04) 40%,
    rgba(212,207,196,.08) 55%,
    rgba(212,207,196,.03) 70%,
    rgba(212,207,196,.07) 85%,
    transparent 100%
  );
  pointer-events:none;
}
#sidebar:hover{width:200px}
#sidebar:hover .nav-label{opacity:1}

.nav-item{
  display:flex;align-items:center;gap:10px;
  width:calc(100% - 12px);padding:8px 12px;margin:0 6px;
  border-radius:8px;cursor:pointer;
  text-decoration:none;color:rgba(212,207,196,.5);
  transition:all .2s;white-space:nowrap;overflow:hidden;
  font-size:13px;
}
.nav-item:hover{
  background:rgba(212,207,196,.08);color:var(--chalk);
}
.nav-item .nav-icon{
  font-size:20px;flex-shrink:0;width:28px;text-align:center;
}
.nav-label{
  opacity:0;transition:opacity .2s;font-size:11px;font-weight:500;
  color:rgba(212,207,196,.7);
}
.nav-item:hover .nav-label{color:var(--chalk)}

.nav-divider{
  width:30px;height:1px;background:rgba(212,207,196,.1);margin:6px 0;
}

/* ‚îÄ‚îÄ Floating Windows ‚îÄ‚îÄ */
.float-win{
  position:fixed;z-index:200;
  background:rgba(10,10,26,.95);
  border:1px solid var(--accent1);
  border-radius:10px;
  box-shadow:0 8px 32px rgba(0,0,0,.6);
  display:flex;flex-direction:column;
  min-width:320px;min-height:240px;
  overflow:hidden;
  backdrop-filter:blur(12px);
}
.float-win .win-titlebar{
  display:flex;align-items:center;justify-content:space-between;
  padding:6px 10px;
  background:rgba(17,17,40,.9);
  border-bottom:1px solid var(--card-border);
  cursor:grab;user-select:none;
  flex-shrink:0;
}
.float-win .win-titlebar:active{cursor:grabbing}
.float-win .win-title{font-size:11px;color:var(--text-dim);letter-spacing:1px;text-transform:uppercase}
.float-win .win-btns{display:flex;gap:4px}
.float-win .win-btn{
  width:24px;height:24px;border-radius:4px;border:1px solid var(--card-border);
  background:rgba(17,17,40,.8);color:var(--text-dim);font-size:12px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .15s;
}
.float-win .win-btn:hover{border-color:var(--accent1);color:var(--text)}
.float-win .win-btn.close:hover{border-color:var(--accent3);color:var(--accent3)}
.float-win iframe{flex:1;border:none;width:100%;height:100%;border-radius:0 0 9px 9px}
.float-win .win-resize{
  position:absolute;bottom:0;right:0;width:16px;height:16px;cursor:nwse-resize;
}
.float-win .win-resize::after{
  content:'';position:absolute;bottom:3px;right:3px;
  width:8px;height:8px;
  border-right:2px solid var(--text-dim);border-bottom:2px solid var(--text-dim);
  opacity:.4;
}

/* ‚îÄ‚îÄ Controls ‚îÄ‚îÄ */
#controls{position:fixed;bottom:14px;right:14px;z-index:100;display:flex;gap:8px;align-items:flex-end}
.ctrl-btn{width:36px;height:36px;border-radius:6px;background:rgba(30,33,40,.85);border:1px solid rgba(212,207,196,.12);
color:rgba(212,207,196,.5);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;
backdrop-filter:blur(6px);transition:all .2s}
.ctrl-btn:hover{border-color:rgba(212,207,196,.3);color:var(--chalk)}

#scene-list,#radio-list{position:absolute;bottom:44px;right:0;background:rgba(30,33,40,.92);border:1px solid rgba(212,207,196,.12);
border-radius:6px;padding:6px 0;display:none;min-width:220px;backdrop-filter:blur(10px)}
#scene-list.open,#radio-list.open{display:block}
.scene-item,.radio-item{padding:8px 14px;font-size:11px;cursor:pointer;color:rgba(212,207,196,.5);transition:all .15s;white-space:nowrap}
.scene-item:hover,.scene-item.active,.radio-item:hover,.radio-item.active{color:var(--chalk);background:rgba(212,207,196,.08)}
.radio-item .radio-sub{font-size:9px;color:rgba(212,207,196,.35);margin-top:2px}
.radio-item.playing{color:var(--green)}
.radio-item.playing::before{content:'‚ñ∂ ';color:var(--green)}

/* ‚îÄ‚îÄ Welcome Panel ‚îÄ‚îÄ */
#welcome-panel{
  position:fixed;z-index:300;
  top:50%;left:50%;transform:translate(-50%,-50%);
  width:min(580px,90vw);
  background:rgba(10,10,26,.97);
  border:1px solid var(--accent1);
  border-radius:10px;
  box-shadow:0 8px 48px rgba(99,102,241,.25),0 0 80px rgba(99,102,241,.08);
  backdrop-filter:blur(14px);
  display:none;flex-direction:column;
  overflow:hidden;
  animation:welcomeFadeIn .5s ease forwards;
}
@keyframes welcomeFadeIn{from{opacity:0;transform:translate(-50%,-50%) scale(.96)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}
#welcome-panel .win-titlebar{
  display:flex;align-items:center;justify-content:space-between;
  padding:8px 12px;
  background:rgba(17,17,40,.9);
  border-bottom:1px solid var(--card-border);
  cursor:grab;user-select:none;
}
#welcome-panel .win-title{font-size:11px;color:var(--accent1);letter-spacing:1px;text-transform:uppercase;font-weight:700}
#welcome-panel .welcome-body{padding:24px 28px;overflow-y:auto;max-height:70vh}
#welcome-panel .welcome-body h2{font-size:16px;color:var(--text);margin-bottom:8px;line-height:1.4}
#welcome-panel .welcome-body .subtitle{font-size:12px;color:var(--text-dim);margin-bottom:16px;line-height:1.5}
#welcome-panel .welcome-body .equation{
  font-size:14px;color:var(--accent2);text-align:center;
  padding:12px;margin:14px 0;
  background:rgba(168,85,247,.08);border:1px solid rgba(168,85,247,.2);border-radius:6px;
  font-weight:500;letter-spacing:.5px;
}
#welcome-panel .welcome-body ul{list-style:none;padding:0;margin:14px 0}
#welcome-panel .welcome-body ul li{
  font-size:12px;color:var(--text-dim);padding:5px 0;padding-left:18px;position:relative;line-height:1.5;
}
#welcome-panel .welcome-body ul li::before{content:'‚ñ∏';position:absolute;left:0;color:var(--accent1)}
#welcome-panel .welcome-body .welcome-actions{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap}
#welcome-panel .welcome-body .welcome-btn{
  padding:8px 18px;border-radius:6px;font-size:12px;font-family:inherit;
  cursor:pointer;border:1px solid var(--accent1);transition:all .2s;
  text-decoration:none;display:inline-flex;align-items:center;gap:6px;
}
#welcome-panel .welcome-body .welcome-btn.primary{
  background:var(--accent1);color:#fff;border-color:var(--accent1);
}
#welcome-panel .welcome-body .welcome-btn.primary:hover{background:#4f46e5}
#welcome-panel .welcome-body .welcome-btn.secondary{
  background:transparent;color:var(--accent1);
}
#welcome-panel .welcome-body .welcome-btn.secondary:hover{background:rgba(99,102,241,.12)}
#welcome-panel .welcome-body .doi{font-size:10px;color:var(--text-dim);margin-top:12px;opacity:.7}

/* ‚îÄ‚îÄ Paper Ticker ‚îÄ‚îÄ */
#paper-ticker{display:inline-block;overflow:hidden;max-width:320px;white-space:nowrap;vertical-align:middle}
#paper-ticker .ticker-track{
  display:inline-block;white-space:nowrap;
  animation:tickerScroll 40s linear infinite;
}
@keyframes tickerScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
#paper-ticker .ticker-track span{color:var(--green);margin-right:6px}

/* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
@media(max-width:600px){
  #sidebar{width:48px}
  #sidebar:hover{width:180px}
  .nav-item .nav-icon{font-size:18px}
  #status-bar{font-size:10px;padding:6px 10px}
  #status-bar .right span:not(:last-child){display:none}
}
</style>
</head>
<body>

<!-- SVG filter for chalkboard grain texture -->
<svg id="chalk-noise" xmlns="http://www.w3.org/2000/svg">
  <filter id="chalkGrain">
    <feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch" result="noise"/>
    <feColorMatrix type="saturate" values="0" in="noise" result="gray"/>
    <feBlend in="SourceGraphic" in2="gray" mode="multiply"/>
  </filter>
</svg>

<!-- Chalkboard Background -->
<div id="chalkboard"></div>

<!-- Leaflet Map Background -->
<div id="map-bg"></div>

<!-- YouTube Background (hidden, JS still functional) -->
<div id="yt-bg"><div id="yt-player"></div></div>
<div id="scanlines"></div>
<div id="vignette"></div>

<!-- Status Bar -->
<div id="status-bar">
<div class="left">‚óÜ RINER RESEARCH HUB</div>
<div class="right">
<span><span class="pulse-dot"></span> SYSTEMS NOMINAL</span>
<span id="day-count">DAY 0</span>
<span>PAPERS 8</span>
<span id="paper-ticker"></span>
<span id="utc-clock">00:00:00 UTC</span>
</div>
</div>

<!-- Sidebar -->
<nav id="sidebar"></nav>

<!-- Floating windows container -->
<div id="windows"></div>

<!-- Welcome Panel -->
<div id="welcome-panel">
<div class="win-titlebar">
<span class="win-title"><span class="pulse-dot" style="margin-right:6px"></span> Paper 8 ‚Äî Now Live</span>
<div class="win-btns">
<button class="win-btn close" onclick="document.getElementById('welcome-panel').style.display='none'" title="Close">&times;</button>
</div>
</div>
<div class="welcome-body">
<h2>Defining Information: Order from the Prime Number Structure of the Riemann Zeta Function</h2>
<p class="subtitle">Information is order &mdash; the integer structure generated by the prime numbers through multiplication, measured by the Benford deviation &delta;<sub>B</sub>.</p>
<div class="equation">&prod;<sub>p</sub> (1 &minus; p<sup>&minus;s</sup>)<sup>&minus;1</sup> = &sum;<sub>n</sub> n<sup>&minus;s</sup> &nbsp;&rarr;&nbsp; foundation &rarr; information</div>
<ul>
<li>Benford's Law derived from scale invariance + maximum entropy (least action)</li>
<li>&delta;<sub>B</sub> tracks quantum-to-classical transitions continuously</li>
<li>Shannon, Landauer, Englert, Wheeler all emerge as consequences</li>
<li>Falsifiable: &delta;<sub>B</sub> must correlate with quantum character in new experiments</li>
</ul>
<div class="welcome-actions">
<a href="https://zenodo.org/records/18782869" target="_blank" class="welcome-btn primary">Read the Paper</a>
<a href="simulators/metric.html" class="welcome-btn secondary" onclick="event.preventDefault();document.getElementById('welcome-panel').style.display='none';openWindow('simulators/metric.html','Prime Metric')">Explore the Metric</a>
</div>
<p class="doi">DOI: 10.5281/zenodo.18782869</p>
</div>
</div>

<!-- Controls -->
<div id="controls">
<button class="ctrl-btn" onclick="openWindow('tools/graphing-calc.html','Graphing Calculator')" title="Graphing Calculator">üìà</button>
<button class="ctrl-btn" onclick="openWindow('tools/calculator.html','Calculator')" title="Scientific Calculator">üßÆ</button>
<div style="position:relative">
<button class="ctrl-btn" id="radio-btn" onclick="toggleRadioList()" title="Space Radio">üìª</button>
<div id="radio-list"></div>
</div>
<button class="ctrl-btn" id="audio-btn" onclick="toggleAudio()" title="Toggle Video Audio">üîá</button>
<div style="position:relative">
<button class="ctrl-btn" onclick="toggleSceneList()" title="Change Scene">üé¨</button>
<div id="scene-list"></div>
</div>
</div>
<audio id="radio-player" crossorigin="anonymous"></audio>

<script>
const SCENES=[
{id:'map',name:'World Map',type:'map'},
{id:'jTCf8eZyZFg',name:'Chalkboard Ambience'},
{id:'Dvwaq1rwioQ',name:'Enceladus Outpost'},
{id:'WjY0s0ALnRU',name:'Space Ambience I'},
{id:'1fDP9T9Cagg',name:'Space Ambience II'},
{id:'hSwcHHPcw2o',name:'Winter Mission Outpost'},
{id:'9wGczUUnczc',name:'Lofi Vibes'},
{id:'ACdxsbGVeNE',name:'Lofi Vibes II'},
{id:'lmFZ42AR_2E',name:'Lofi Vibes III'}
];

const NAV=[
{icon:'üåå',label:'GR from Primes',href:'https://zenodo.org/records/18751909'},
{icon:'üìê',label:'Prime Metric',href:'simulators/metric.html'},
{icon:'üï≥Ô∏è',label:'Black Hole Primes',href:'simulators/blackhole-simulator.html'},
{icon:'üìÑ',label:'Publications',href:'pages/publications.html'},
{divider:true},
{icon:'üåÄ',label:'Big Picture',href:'pages/big-picture.html'},
{icon:'üì°',label:'Research Feed',href:'pages/research-feed.html'},
{icon:'üé®',label:'Visualizations',href:'pages/visualizations.html'},
{icon:'üìà',label:'Function Explorer',href:'simulators/jsxgraph-explorer.html'},
{divider:true},
{icon:'üîß',label:'Projects',href:'pages/projects.html'},
{icon:'üßÆ',label:'Daily Practice',href:'pages/daily-practice.html'},
{icon:'üìä',label:'Math Journey',href:'pages/math-journey.html'},
{icon:'üìä',label:'Data Plotter',href:'tools/data-plotter.html'},
{icon:'üìâ',label:'Desmos',href:'tools/desmos.html'},
{divider:true},
{icon:'üìö',label:'VPT Courses',href:'pages/vpt-courses.html'},
{icon:'üèõÔ∏è',label:'Formula Palace',href:'pages/formula-palace.html'},
{icon:'üí°',label:'Speculative',href:'pages/speculative.html'},
{icon:'üó∫Ô∏è',label:'Log & Roadmap',href:'pages/log-roadmap.html'},
{icon:'üìù',label:'Paper Editor',href:'tools/editor.html'},
{icon:'ü™ê',label:'Expedition',href:'simulators/expedition.html'},
];

let player,currentScene=1,isMuted=true;
let winZ=200,winCount=0,winOffset=0;

// ‚îÄ‚îÄ LEAFLET MAP ‚îÄ‚îÄ
let leafletMap=null,issMarker=null,issInterval=null,userLocMarker=null;

function initMap(){
  if(leafletMap)return;
  leafletMap=L.map('map-bg',{
    zoomControl:false,
    attributionControl:true,
    scrollWheelZoom:true,
    doubleClickZoom:true,
    dragging:true
  }).setView([30,0],3);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',{
    attribution:'&copy; <a href="https://carto.com/">CARTO</a>',
    subdomains:'abcd',maxZoom:19
  }).addTo(leafletMap);

  // Geolocate user
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const ll=[pos.coords.latitude,pos.coords.longitude];
      leafletMap.setView(ll,6);
      userLocMarker=L.marker(ll,{
        icon:L.divIcon({className:'user-loc',iconSize:[14,14],iconAnchor:[7,7]})
      }).addTo(leafletMap).bindTooltip('You',{direction:'top',offset:[0,-10],className:'iss-label'});
    },()=>{/* denied ‚Äî keep default world view */});
  }

  // ISS tracker
  const issIcon=L.divIcon({
    html:'<span style="font-size:22px">üõ∞Ô∏è</span>',
    className:'',iconSize:[22,22],iconAnchor:[11,11]
  });
  issMarker=L.marker([0,0],{icon:issIcon}).addTo(leafletMap)
    .bindTooltip('ISS',{permanent:true,direction:'right',offset:[14,0],className:'iss-label'});

  function fetchISS(){
    fetch('https://api.open-notify.org/iss-now.json')
      .then(r=>r.json())
      .then(d=>{
        const lat=parseFloat(d.iss_position.latitude);
        const lng=parseFloat(d.iss_position.longitude);
        issMarker.setLatLng([lat,lng]);
      }).catch(()=>{});
  }
  fetchISS();
  issInterval=setInterval(fetchISS,10000);

  // Force Leaflet to recalculate after display:none‚Üíblock transition
  setTimeout(()=>leafletMap.invalidateSize(),100);
}

function showMap(){
  document.getElementById('map-bg').style.display='block';
  document.getElementById('yt-bg').style.display='none';
  initMap();
  setTimeout(()=>leafletMap.invalidateSize(),50);
  // Pause YouTube when map is active
  if(player&&player.pauseVideo)try{player.pauseVideo()}catch(e){}
}

function hideMap(){
  document.getElementById('map-bg').style.display='none';
  document.getElementById('yt-bg').style.display='block';
}

// YouTube API
const tag=document.createElement('script');
tag.src='https://www.youtube.com/iframe_api';
document.head.appendChild(tag);

window.onYouTubeIframeAPIReady=function(){
player=new YT.Player('yt-player',{
videoId:SCENES[1].id,
playerVars:{autoplay:1,mute:1,controls:0,showinfo:0,modestbranding:1,rel:0,
loop:1,playlist:SCENES[1].id,playsinline:1,disablekb:1,fs:0,iv_load_policy:3,
origin:window.location.origin},
events:{onReady:function(e){e.target.playVideo()},
onStateChange:function(e){
// If video pauses unexpectedly (e.g. from iframe focus), resume it
if(e.data===YT.PlayerState.PAUSED&&SCENES[currentScene].type!=='map'){
setTimeout(()=>{try{e.target.playVideo()}catch(ex){}},200);
}
}}
});
};
// Keep video playing even when iframes steal focus (but not during map scene)
setInterval(()=>{
if(player&&player.getPlayerState&&player.getPlayerState()===YT.PlayerState.PAUSED&&SCENES[currentScene].type!=='map'){
try{player.playVideo()}catch(e){}
}
},2000);

function switchScene(i){
currentScene=i;
const scene=SCENES[i];
if(scene.type==='map'){
  showMap();
}else{
  hideMap();
  if(player&&player.loadVideoById){
    player.loadVideoById({videoId:scene.id,suggestedQuality:'hd1080'});
    setTimeout(()=>{try{player.setLoop(true)}catch(e){}},1000);
  }
}
document.querySelectorAll('.scene-item').forEach((el,j)=>el.classList.toggle('active',j===i));
}

function toggleAudio(){
if(!player)return;
isMuted=!isMuted;
if(isMuted){player.mute()}else{player.unMute()}
document.getElementById('audio-btn').textContent=isMuted?'üîá':'üîä';
}

function toggleSceneList(){document.getElementById('scene-list').classList.toggle('open')}

// Build scene list
const sl=document.getElementById('scene-list');
SCENES.forEach((s,i)=>{
const d=document.createElement('div');
d.className='scene-item'+(i===currentScene?' active':'');
d.textContent=s.name;
d.onclick=()=>{switchScene(i);toggleSceneList()};
sl.appendChild(d);
});

// Build sidebar
const sidebar=document.getElementById('sidebar');
NAV.forEach(item=>{
if(item.divider){
const d=document.createElement('div');
d.className='nav-divider';
sidebar.appendChild(d);
return;
}
const a=document.createElement('div');
a.className='nav-item';
a.innerHTML=`<span class="nav-icon">${item.icon}</span><span class="nav-label">${item.label}</span>`;
a.onclick=()=>{
if(item.href.startsWith('http')){window.open(item.href,'_blank')}
else{openWindow(item.href,item.label)}
};
sidebar.appendChild(a);
});

// Floating windows
const winsEl=document.getElementById('windows');

function openWindow(href,title){
href+=(href.includes('?')?'&':'?')+'_t='+Date.now();
winCount++;winZ++;winOffset=(winOffset+30)%150;
const w=Math.min(560,window.innerWidth-200);
const h=Math.min(420,window.innerHeight-160);
const x=Math.max(70,120+winOffset);
const y=Math.max(50,80+winOffset);
const win=document.createElement('div');
win.className='float-win';
win.id='win-'+winCount;
win.style.cssText=`left:${x}px;top:${y}px;width:${w}px;height:${h}px;z-index:${winZ}`;
const iframeId='iframe-'+winCount;
win.innerHTML=`
<div class="win-titlebar" data-win="${win.id}">
<span class="win-title">${title}</span>
<div class="win-btns">
<button class="win-btn" onclick="maxWin('${win.id}')" title="Maximize">&#9633;</button>
<button class="win-btn close" onclick="closeWin('${win.id}')" title="Close">&times;</button>
</div>
</div>
<iframe id="${iframeId}" src="${href}"></iframe>
<div class="win-resize" data-win="${win.id}"></div>`;
winsEl.appendChild(win);
// Hide "Back to Hub" links inside iframe to prevent loading index.html in the window
const ifr=document.getElementById(iframeId);
ifr.addEventListener('load',()=>{
try{
const s=ifr.contentDocument.createElement('style');
s.textContent='.back-link{display:none!important}';
ifr.contentDocument.head.appendChild(s);
// Prevent links to index.html from navigating inside the iframe
ifr.contentDocument.querySelectorAll('a[href*="index.html"]').forEach(a=>{
a.style.display='none';
});
}catch(e){}
});
win.addEventListener('mousedown',()=>{winZ++;win.style.zIndex=winZ});
initDrag(win);
initResize(win);
}

function closeWin(id){
const w=document.getElementById(id);
if(w)w.remove();
}

function maxWin(id){
const w=document.getElementById(id);
if(!w)return;
if(w.dataset.maximized==='1'){
w.style.left=w.dataset.ox;w.style.top=w.dataset.oy;
w.style.width=w.dataset.ow;w.style.height=w.dataset.oh;
w.style.borderRadius='10px';
w.dataset.maximized='0';
}else{
w.dataset.ox=w.style.left;w.dataset.oy=w.style.top;
w.dataset.ow=w.style.width;w.dataset.oh=w.style.height;
w.style.left='56px';w.style.top='36px';
w.style.width='calc(100vw - 56px)';w.style.height='calc(100vh - 36px)';
w.style.borderRadius='0';
w.dataset.maximized='1';
}
}

function initDrag(win){
const bar=win.querySelector('.win-titlebar');
let dx,dy,dragging=false;
function startDrag(cx,cy,e){
if(e.target.closest('.win-btn'))return;
dragging=true;dx=cx-win.offsetLeft;dy=cy-win.offsetTop;
win.dataset.maximized='0';win.style.borderRadius='10px';
e.preventDefault();
}
function moveDrag(cx,cy){
if(!dragging)return;
win.style.left=Math.max(0,cx-dx)+'px';
win.style.top=Math.max(0,cy-dy)+'px';
}
function endDrag(){dragging=false}
bar.addEventListener('mousedown',e=>startDrag(e.clientX,e.clientY,e));
document.addEventListener('mousemove',e=>moveDrag(e.clientX,e.clientY));
document.addEventListener('mouseup',endDrag);
bar.addEventListener('touchstart',e=>{
const t=e.touches[0];startDrag(t.clientX,t.clientY,e);
},{passive:false});
document.addEventListener('touchmove',e=>{
if(!dragging)return;
const t=e.touches[0];moveDrag(t.clientX,t.clientY);
e.preventDefault();
},{passive:false});
document.addEventListener('touchend',endDrag);
}

function initResize(win){
const handle=win.querySelector('.win-resize');
let rx,ry,rw,rh,resizing=false;
function startResize(cx,cy,e){
resizing=true;rx=cx;ry=cy;
rw=win.offsetWidth;rh=win.offsetHeight;
e.preventDefault();e.stopPropagation();
}
function moveResize(cx,cy){
if(!resizing)return;
win.style.width=Math.max(280,rw+(cx-rx))+'px';
win.style.height=Math.max(200,rh+(cy-ry))+'px';
}
function endResize(){resizing=false}
handle.addEventListener('mousedown',e=>startResize(e.clientX,e.clientY,e));
document.addEventListener('mousemove',e=>moveResize(e.clientX,e.clientY));
document.addEventListener('mouseup',endResize);
handle.addEventListener('touchstart',e=>{
const t=e.touches[0];startResize(t.clientX,t.clientY,e);
},{passive:false});
document.addEventListener('touchmove',e=>{
if(!resizing)return;
const t=e.touches[0];moveResize(t.clientX,t.clientY);
e.preventDefault();
},{passive:false});
document.addEventListener('touchend',endResize);
}

document.addEventListener('keydown',e=>{
if(e.key==='Escape'){
const wins=winsEl.querySelectorAll('.float-win');
if(wins.length)wins[wins.length-1].remove();
}
});

// Clock & Day Counter
function updateClock(){
const now=new Date();
document.getElementById('utc-clock').textContent=now.toISOString().slice(11,19)+' UTC';
const epoch=new Date('2026-01-22T00:00:00Z');
const day=Math.floor((now-epoch)/864e5);
document.getElementById('day-count').textContent='DAY '+(day>0?day:0);
}
updateClock();setInterval(updateClock,1000);

// ‚îÄ‚îÄ SPACE RADIO ‚îÄ‚îÄ
const RADIO_STATIONS=[
{name:'Mission Control',sub:'NASA audio + ambient music',url:'https://ice5.somafm.com/missioncontrol-128-mp3'},
{name:'Deep Space One',sub:'Deep ambient space music',url:'https://ice5.somafm.com/deepspaceone-128-mp3'},
{name:'Space Station Soma',sub:'Spaced-out ambient & electronica',url:'https://ice5.somafm.com/spacestation-128-mp3'},
{name:'Drone Zone',sub:'Atmospheric textures & drones',url:'https://ice5.somafm.com/dronezone-128-mp3'},
{name:'Off',sub:'Stop radio',url:null},
];

let radioPlaying=-1;
const radioPlayer=document.getElementById('radio-player');

const rl=document.getElementById('radio-list');
RADIO_STATIONS.forEach((s,i)=>{
const d=document.createElement('div');
d.className='radio-item';
d.innerHTML=`<div>${s.name}</div>${s.sub?'<div class="radio-sub">'+s.sub+'</div>':''}`;
d.onclick=()=>{playRadio(i);toggleRadioList()};
rl.appendChild(d);
});

function playRadio(i){
document.querySelectorAll('.radio-item').forEach((el,j)=>{
  el.classList.remove('active','playing');
});
if(RADIO_STATIONS[i].url===null||radioPlaying===i){
  radioPlayer.pause();radioPlayer.src='';
  radioPlaying=-1;
  document.getElementById('radio-btn').textContent='üìª';
  return;
}
radioPlayer.src=RADIO_STATIONS[i].url;
radioPlayer.volume=0.5;
radioPlayer.play().catch(()=>{});
radioPlaying=i;
document.querySelectorAll('.radio-item')[i].classList.add('active','playing');
document.getElementById('radio-btn').textContent='üìª';
document.getElementById('radio-btn').style.borderColor='var(--green)';
setTimeout(()=>{document.getElementById('radio-btn').style.borderColor=''},2000);
}

function toggleRadioList(){
document.getElementById('radio-list').classList.toggle('open');
document.getElementById('scene-list').classList.remove('open');
}

document.addEventListener('click',e=>{
if(!e.target.closest('#controls')){
  document.getElementById('scene-list').classList.remove('open');
  document.getElementById('radio-list').classList.remove('open');
}
});

// ‚îÄ‚îÄ WELCOME PANEL AUTO-OPEN ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded',()=>{
  setTimeout(()=>{
    document.getElementById('welcome-panel').style.display='flex';
  },800);
});

// ‚îÄ‚îÄ PAPER TICKER ‚îÄ‚îÄ
(function(){
const papers=[
  '#8 Defining Information',
  '#7 GR from Primes',
  '#6 Causal Set Theory',
  '#5 River Velocity GPS',
  '#4 Optical AI Accelerator',
  '#3 Ternary Logic',
  '#2 BEC + Benford\'s Law',
  '#1 Modified Schwarzschild'
];
const tickerEl=document.getElementById('paper-ticker');
const sep=' \u00b7 ';
const full=papers.join(sep)+sep;
tickerEl.innerHTML='<span class="ticker-track"><span>\u25c6</span> '+full+'<span>\u25c6</span> '+full+'</span>';
})();
</script>
</body>
</html>
