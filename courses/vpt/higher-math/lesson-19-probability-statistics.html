<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lesson 19: Probability &amp; Statistics</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#1e2128;--bg-card:#262a33;--bg-card-hover:#2c313c;--bg-input:#1a1d24;--border:#363b47;--text:#e2e4e9;--text-dim:#9ca3af;--text-bright:#fff;--indigo:#6366f1;--indigo-dim:rgba(99,102,241,.15);--green:#22c55e;--green-dim:rgba(34,197,94,.15);--pink:#ec4899;--pink-dim:rgba(236,72,153,.15);--amber:#f59e0b;--amber-dim:rgba(245,158,11,.15);--radius:10px;--transition:0.3s cubic-bezier(.4,0,.2,1)}
html{scroll-behavior:smooth}
body{font-family:'JetBrains Mono',monospace;background:var(--bg);color:var(--text);line-height:1.7;min-height:100vh;padding:0}
.top-bar{position:sticky;top:0;z-index:100;background:rgba(30,33,40,.92);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:16px 24px}
.top-bar h1{font-size:1.1rem;font-weight:600;color:var(--text-bright);margin-bottom:10px;letter-spacing:-.02em}
.top-bar h1 span{color:var(--indigo)}
.progress-track{width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--indigo),#818cf8);border-radius:3px;transition:width .5s ease}
.progress-label{font-size:.7rem;color:var(--text-dim);margin-top:6px;text-align:right}
.content{max-width:900px;margin:0 auto;padding:24px}
.section-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:20px;overflow:hidden;transition:border-color var(--transition)}
.section-card.completed{border-color:var(--green)}
.section-header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;cursor:pointer;user-select:none;transition:background var(--transition)}
.section-header:hover{background:var(--bg-card-hover)}
.section-header h2{font-size:.95rem;font-weight:600;color:var(--text-bright);display:flex;align-items:center;gap:10px}
.section-num{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;background:var(--indigo-dim);color:var(--indigo);font-size:.75rem;font-weight:700;flex-shrink:0}
.chevron{width:20px;height:20px;color:var(--text-dim);transition:transform .4s cubic-bezier(.34,1.56,.64,1);flex-shrink:0}
.section-card.open .chevron{transform:rotate(180deg)}
.section-body{max-height:0;overflow:hidden;transition:max-height .5s cubic-bezier(.4,0,.2,1)}
.section-card.open .section-body{max-height:80000px}
.section-inner{padding:0 22px 22px}
.concept-text{font-size:.82rem;color:var(--text);margin-bottom:16px;line-height:1.8}
.concept-text strong{color:var(--text-bright)}
.formula-box{background:var(--indigo-dim);border:1px solid rgba(99,102,241,.3);border-radius:var(--radius);padding:16px 20px;margin:16px 0;text-align:center;font-size:1rem;color:var(--indigo);font-weight:600}
.formula-box.large{font-size:1.15rem;padding:20px 24px}
.formula-box.green{background:var(--green-dim);border-color:rgba(34,197,94,.3);color:var(--green)}
.formula-box.pink{background:var(--pink-dim);border-color:rgba(236,72,153,.3);color:var(--pink)}
.formula-box.amber{background:var(--amber-dim);border-color:rgba(245,158,11,.3);color:var(--amber)}
.key-point{background:var(--amber-dim);border-left:3px solid var(--amber);border-radius:0 var(--radius) var(--radius) 0;padding:12px 16px;margin:14px 0;font-size:.78rem;color:var(--amber)}
.interactive-area{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin:16px 0;position:relative}
.interactive-label{font-size:.7rem;color:var(--indigo);text-transform:uppercase;letter-spacing:.08em;margin-bottom:12px;font-weight:600}
.readout{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
.readout-item{background:var(--bg-card);border:1px solid var(--border);border-radius:6px;padding:8px 14px;font-size:.75rem}
.readout-item .label{color:var(--text-dim);font-size:.65rem}
.readout-item .value{color:var(--text-bright);font-weight:600}
.readout-item .value.green{color:var(--green)}
.readout-item .value.pink{color:var(--pink)}
.readout-item .value.amber{color:var(--amber)}
.readout-item .value.indigo{color:var(--indigo)}
svg text{font-family:'JetBrains Mono',monospace}
.practice-block{margin-top:20px;border-top:1px solid var(--border);padding-top:16px}
.practice-title{font-size:.8rem;font-weight:600;color:var(--amber);margin-bottom:14px}
.problem{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:12px}
.problem p{font-size:.78rem;margin-bottom:10px;line-height:1.7}
.problem-input-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.problem input[type="text"],.problem input[type="number"]{background:var(--bg-card);border:1px solid var(--border);border-radius:6px;padding:8px 12px;color:var(--text-bright);font-family:'JetBrains Mono',monospace;font-size:.78rem;width:120px;outline:none;transition:border-color var(--transition)}
.problem input:focus{border-color:var(--indigo)}
.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.72rem;cursor:pointer;transition:var(--transition);user-select:none}
.btn:hover{background:var(--bg-card-hover);border-color:var(--indigo);color:var(--text-bright)}
.btn-primary{background:var(--indigo);border-color:var(--indigo);color:#fff}
.btn-primary:hover{background:#5558e6}
.btn-sm{padding:6px 12px;font-size:.68rem}
.feedback{font-size:.75rem;margin-top:8px;padding:8px 12px;border-radius:6px;display:none}
.feedback.correct{display:block;background:var(--green-dim);color:var(--green);border:1px solid rgba(34,197,94,.3)}
.feedback.incorrect{display:block;background:var(--pink-dim);color:var(--pink);border:1px solid rgba(236,72,153,.3)}
.slider-row{display:flex;align-items:center;gap:12px;margin:8px 0}
.slider-row label{font-size:.7rem;color:var(--text-dim);min-width:110px;flex-shrink:0}
.slider-row input[type="range"]{flex:1}
.slider-row .slider-val{font-size:.75rem;color:var(--text-bright);font-weight:600;min-width:60px;text-align:right}
input[type="range"]{-webkit-appearance:none;width:100%;height:6px;background:var(--border);border-radius:3px;outline:none;margin:10px 0}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;border-radius:50%;background:var(--indigo);cursor:pointer;border:2px solid var(--text-bright)}
.controls-row{display:flex;flex-wrap:wrap;gap:12px;align-items:center;margin:12px 0}
.mc-choices{display:flex;flex-direction:column;gap:8px;margin-top:8px}
.mc-btn{text-align:left;padding:8px 12px;font-size:.74rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);cursor:pointer;transition:var(--transition);font-family:'JetBrains Mono',monospace}
.mc-btn:hover{border-color:var(--indigo);background:var(--bg-card-hover)}
.mc-btn.correct{border-color:var(--green);background:var(--green-dim);color:var(--green);pointer-events:none}
.mc-btn.wrong{border-color:var(--pink);background:var(--pink-dim);color:var(--pink);pointer-events:none}
.mc-btn.disabled{pointer-events:none;opacity:.6}
.sub-label{font-size:.7rem;color:var(--text-dim);margin:10px 0 4px}
.navy-context{background:rgba(99,102,241,.08);border:1px solid rgba(99,102,241,.2);border-radius:var(--radius);padding:12px 16px;margin:14px 0;font-size:.76rem;color:var(--text-dim)}
.navy-context strong{color:var(--indigo)}
.step-box{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin:12px 0}
.step-box .step-label{font-size:.68rem;color:var(--green);font-weight:600;text-transform:uppercase;letter-spacing:.06em;margin-bottom:6px}
.step-box .step-content{font-size:.78rem;line-height:1.8}
.step-box .step-content strong{color:var(--text-bright)}
.quiz-score{background:var(--indigo-dim);border:1px solid rgba(99,102,241,.3);border-radius:var(--radius);padding:14px 20px;display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.quiz-score .score-text{font-size:.85rem;color:var(--text-bright);font-weight:600}
.quiz-q{background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px}
.quiz-q .q-num{font-size:.65rem;color:var(--indigo);font-weight:600;text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px}
.quiz-q .q-text{font-size:.78rem;margin-bottom:12px;line-height:1.7}
.quiz-q .choices{display:flex;flex-direction:column;gap:8px}
.quiz-q .choice-btn{text-align:left;padding:10px 14px;font-size:.76rem;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text);cursor:pointer;transition:var(--transition);font-family:'JetBrains Mono',monospace;width:100%}
.quiz-q .choice-btn:hover{border-color:var(--indigo);background:var(--bg-card-hover)}
.quiz-q .choice-btn.selected-correct{border-color:var(--green);background:var(--green-dim);color:var(--green)}
.quiz-q .choice-btn.selected-wrong{border-color:var(--pink);background:var(--pink-dim);color:var(--pink)}
.quiz-q .choice-btn.reveal-correct{border-color:var(--green);background:var(--green-dim);color:var(--green)}
.quiz-q .choice-btn.disabled{pointer-events:none;opacity:.7}
@keyframes popCorrect{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
@keyframes shakeWrong{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
.pop{animation:popCorrect .35s cubic-bezier(.34,1.56,.64,1)}
.shake{animation:shakeWrong .4s ease}
canvas{display:block;width:100%;border-radius:6px;border:1px solid var(--border)}
@media(max-width:640px){.content{padding:16px}.section-header{padding:14px 16px}.section-inner{padding:0 16px 16px}.slider-row label{min-width:80px}.readout{gap:8px}.readout-item{padding:6px 10px;font-size:.7rem}}
</style>
</head>
<body>

<div class="top-bar">
  <h1><span>19</span> Probability &amp; Statistics</h1>
  <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
  <div class="progress-label" id="progressLabel">0 / 5 sections</div>
</div>

<div class="content" id="contentArea">

<!-- ============================================================ -->
<!-- SECTION 1: PROBABILITY FUNDAMENTALS -->
<!-- ============================================================ -->
<div class="section-card open" data-section="1">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">1</span> Probability Fundamentals</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      A <strong>sample space</strong> S is the set of all possible outcomes of an experiment. An <strong>event</strong> A is any subset of S. The <strong>probability</strong> of an event is the proportion of outcomes that belong to it -- for equally likely outcomes:
    </p>

    <div class="formula-box large">P(A) = |A| / |S| = (favorable outcomes) / (total outcomes)</div>

    <p class="concept-text">
      The <strong>complement rule</strong> says the probability of A not happening equals one minus the probability it does. The <strong>addition rule</strong> handles overlapping events using inclusion-exclusion:
    </p>

    <div class="formula-box green">P(A') = 1 - P(A) &nbsp;&nbsp;&nbsp; P(A &cup; B) = P(A) + P(B) - P(A &cap; B)</div>

    <p class="concept-text">
      Two events are <strong>mutually exclusive</strong> (disjoint) if A &cap; B = &empty;, so P(A &cup; B) = P(A) + P(B). The most powerful concept in applied probability is <strong>conditional probability</strong> -- the probability of A given that B has already occurred:
    </p>

    <div class="formula-box pink large">P(A | B) = P(A &cap; B) / P(B) &nbsp;&nbsp; (assuming P(B) &gt; 0)</div>

    <div class="key-point"><strong>Intuition:</strong> Conditioning on B means we restrict the sample space to B. P(A|B) asks: within the world where B happened, what fraction of those outcomes also satisfy A? This shrinks the denominator from |S| to |B|.</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Venn Diagram Probability Calculator</div>
      <p style="font-size:.72rem;color:var(--text-dim);margin-bottom:10px">Set P(A), P(B), and P(A&cap;B) to see all derived probabilities. The Venn diagram updates live.</p>
      <canvas id="vennCanvas" height="180"></canvas>
      <div style="margin-top:12px">
        <div class="slider-row">
          <label>P(A)</label>
          <input type="range" id="venn_pA" min="0.05" max="0.95" step="0.01" value="0.50" oninput="updateVenn()">
          <span class="slider-val" id="venn_pA_val">0.50</span>
        </div>
        <div class="slider-row">
          <label>P(B)</label>
          <input type="range" id="venn_pB" min="0.05" max="0.95" step="0.01" value="0.40" oninput="updateVenn()">
          <span class="slider-val" id="venn_pB_val">0.40</span>
        </div>
        <div class="slider-row">
          <label>P(A&cap;B)</label>
          <input type="range" id="venn_pAB" min="0.00" max="0.50" step="0.01" value="0.15" oninput="updateVenn()">
          <span class="slider-val" id="venn_pAB_val">0.15</span>
        </div>
      </div>
      <div class="readout">
        <div class="readout-item"><span class="label">P(A&cup;B)</span><br><span class="value indigo" id="v_union">0.75</span></div>
        <div class="readout-item"><span class="label">P(A')</span><br><span class="value green" id="v_compA">0.50</span></div>
        <div class="readout-item"><span class="label">P(B')</span><br><span class="value green" id="v_compB">0.60</span></div>
        <div class="readout-item"><span class="label">P(A|B)</span><br><span class="value pink" id="v_AgivenB">0.375</span></div>
        <div class="readout-item"><span class="label">P(B|A)</span><br><span class="value amber" id="v_BgivenA">0.300</span></div>
        <div class="readout-item"><span class="label">Mutually exclusive?</span><br><span class="value" id="v_mutex">No</span></div>
      </div>
    </div>

    <div class="navy-context">
      <strong>Navy context:</strong> Probability is the foundation of <strong>reliability engineering</strong> used in every shipboard system. P(system failure) = 1 - P(all components working). For redundant (parallel) systems, P(at least one works) = 1 - P(all fail). Navigation uses conditional probability constantly: P(on correct course | GPS reading) incorporates sensor error rates. Electronic warfare uses P(detection | signal present) and P(false alarm | no signal) -- the core of ROC curve analysis.
    </div>

    <div class="practice-block"><div class="practice-title">Practice Problems</div>
      <div class="problem">
        <p><strong>1.</strong> A standard deck has 52 cards. You draw one card. What is P(Ace or Heart)? (There are 4 aces and 13 hearts; Ace of Hearts is in both. Enter as decimal rounded to 4 places.)</p>
        <div class="problem-input-row">
          <input type="number" id="s1p1_in" placeholder="P" step="0.0001">
          <button class="btn btn-sm" onclick="checkNum('s1p1_in','s1p1_fb',0.3077,0.001)">Check</button>
        </div>
        <div class="feedback" id="s1p1_fb"></div>
      </div>
      <div class="problem">
        <p><strong>2.</strong> P(A) = 0.6, P(B) = 0.5, P(A&cap;B) = 0.3. Are A and B mutually exclusive?</p>
        <div class="mc-choices">
          <button class="mc-btn" onclick="checkMC(this,'no','s1p2_grp')">A) Yes, they are mutually exclusive</button>
          <button class="mc-btn" onclick="checkMC(this,'yes','s1p2_grp')">B) No, P(A&cap;B) = 0.3 &ne; 0, so they overlap</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s1p2_grp')">C) Cannot determine without more information</button>
        </div>
      </div>
      <div class="problem">
        <p><strong>3.</strong> Using P(A)=0.6, P(B)=0.5, P(A&cap;B)=0.3, compute P(A|B). Enter as decimal.</p>
        <div class="problem-input-row">
          <input type="number" id="s1p3_in" placeholder="P(A|B)" step="0.01">
          <button class="btn btn-sm" onclick="checkNum('s1p3_in','s1p3_fb',0.6,0.01)">Check</button>
        </div>
        <div class="feedback" id="s1p3_fb"></div>
      </div>
      <div class="problem">
        <p><strong>4.</strong> A bag has 3 red, 4 blue, 5 green balls. You pick one. What is P(not green)?</p>
        <div class="problem-input-row">
          <input type="number" id="s1p4_in" placeholder="P" step="0.001">
          <button class="btn btn-sm" onclick="checkNum('s1p4_in','s1p4_fb',0.5833,0.005)">Check</button>
        </div>
        <div class="feedback" id="s1p4_fb"></div>
      </div>
    </div>
  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 2: INDEPENDENCE & BAYES' THEOREM -->
<!-- ============================================================ -->
<div class="section-card" data-section="2">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">2</span> Independence &amp; Bayes' Theorem</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      Events A and B are <strong>independent</strong> if knowing B happened gives no information about A. Mathematically, P(A|B) = P(A), which leads to the <strong>multiplication rule for independent events</strong>:
    </p>

    <div class="formula-box large">P(A &cap; B) = P(A) &middot; P(B) &nbsp;&nbsp; (independent events)</div>

    <p class="concept-text">
      For dependent events the <strong>general multiplication rule</strong> uses conditional probability: P(A &cap; B) = P(A|B) &middot; P(B). This is how <strong>tree diagrams</strong> work -- multiply along branches to get joint probabilities, then add across branches for marginal probabilities.
    </p>

    <p class="concept-text">
      <strong>Bayes' Theorem</strong> is the most important result in applied probability. It lets us "flip" conditional probabilities -- given a test result, what is the probability of the disease? Starting from P(B|A) and P(A), we can find P(A|B):
    </p>

    <div class="formula-box pink large">P(A | B) = P(B | A) &middot; P(A) / P(B)</div>

    <p class="concept-text">
      Expanding P(B) using the <strong>law of total probability</strong>: P(B) = P(B|A)P(A) + P(B|A')P(A'). This full form is essential when P(B) isn't given directly. Consider a medical test: a disease affects 1% of the population. The test is 99% sensitive (detects disease when present) and 95% specific (negative when no disease). What is P(disease | positive test)?
    </p>

    <div class="step-box">
      <div class="step-label">Bayes Worked Example -- Medical Test</div>
      <div class="step-content">
        <strong>Prior:</strong> P(D) = 0.01, P(D') = 0.99<br>
        <strong>Likelihoods:</strong> P(+|D) = 0.99, P(+|D') = 0.05<br>
        <strong>Total P(+):</strong> 0.99(0.01) + 0.05(0.99) = 0.0099 + 0.0495 = 0.0594<br>
        <strong>Posterior:</strong> P(D|+) = (0.99 &times; 0.01) / 0.0594 &approx; <span style="color:var(--pink)">0.167</span><br>
        <span style="color:var(--amber)">Only 16.7% chance of disease even with a positive test -- base rate dominates!</span>
      </div>
    </div>

    <div class="key-point"><strong>False positive paradox:</strong> When a disease is rare (low prior), even a very accurate test yields many false positives. This is why screening programs use high-specificity tests and require confirmatory testing. Bayes' theorem quantifies exactly how much the prior matters.</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Probability Tree Builder</div>
      <p style="font-size:.72rem;color:var(--text-dim);margin-bottom:10px">Set two-stage experiment probabilities. The tree draws joint probabilities and computes marginal/conditional results.</p>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px">
        <div>
          <div class="sub-label">Stage 1</div>
          <div class="slider-row">
            <label>P(A)</label>
            <input type="range" id="tree_pA" min="0.05" max="0.95" step="0.01" value="0.30" oninput="updateTree()">
            <span class="slider-val" id="tree_pA_val">0.30</span>
          </div>
        </div>
        <div>
          <div class="sub-label">Stage 2 Conditionals</div>
          <div class="slider-row">
            <label>P(B|A)</label>
            <input type="range" id="tree_pBgA" min="0.01" max="0.99" step="0.01" value="0.80" oninput="updateTree()">
            <span class="slider-val" id="tree_pBgA_val">0.80</span>
          </div>
          <div class="slider-row">
            <label>P(B|A')</label>
            <input type="range" id="tree_pBgAc" min="0.01" max="0.99" step="0.01" value="0.20" oninput="updateTree()">
            <span class="slider-val" id="tree_pBgAc_val">0.20</span>
          </div>
        </div>
      </div>
      <canvas id="treeCanvas" height="220"></canvas>
      <div class="readout">
        <div class="readout-item"><span class="label">P(A&cap;B)</span><br><span class="value indigo" id="tree_pAB">0.240</span></div>
        <div class="readout-item"><span class="label">P(A&cap;B')</span><br><span class="value green" id="tree_pABc">0.060</span></div>
        <div class="readout-item"><span class="label">P(A'&cap;B)</span><br><span class="value pink" id="tree_pAcB">0.140</span></div>
        <div class="readout-item"><span class="label">P(A'&cap;B')</span><br><span class="value amber" id="tree_pAcBc">0.560</span></div>
        <div class="readout-item"><span class="label">P(B) marginal</span><br><span class="value" id="tree_pB">0.380</span></div>
        <div class="readout-item"><span class="label">P(A|B) Bayes</span><br><span class="value" id="tree_pAgB">0.632</span></div>
      </div>
    </div>

    <div class="navy-context">
      <strong>Navy context:</strong> Bayes' theorem drives <strong>sonar contact classification</strong>. Given a sonar contact, P(submarine | signature) = P(signature | submarine) &times; P(submarine) / P(signature). The prior P(submarine) reflects threat environment intelligence. Bayesian tracking filters (like Kalman) continuously update position estimates as new sensor data arrives -- this is the mathematical core of every fire control system.
    </div>

    <div class="practice-block"><div class="practice-title">Practice Problems</div>
      <div class="problem">
        <p><strong>1.</strong> Two fair coins flipped. P(both heads) = ? (Independent events.)</p>
        <div class="problem-input-row">
          <input type="number" id="s2p1_in" placeholder="P" step="0.01">
          <button class="btn btn-sm" onclick="checkNum('s2p1_in','s2p1_fb',0.25,0.01)">Check</button>
        </div>
        <div class="feedback" id="s2p1_fb"></div>
      </div>
      <div class="problem">
        <p><strong>2.</strong> A factory has two machines. Machine A produces 60% of parts, machine B produces 40%. Defect rate: A = 2%, B = 5%. A part is defective. What is P(from machine B)? Round to 4 decimal places.</p>
        <div class="problem-input-row">
          <input type="number" id="s2p2_in" placeholder="P(B|defect)" step="0.0001">
          <button class="btn btn-sm" onclick="checkNum('s2p2_in','s2p2_fb',0.5263,0.005)">Check</button>
        </div>
        <div class="feedback" id="s2p2_fb"></div>
      </div>
      <div class="problem">
        <p><strong>3.</strong> P(rain today) = 0.3. P(wet ground | rain) = 0.95. P(wet ground | no rain) = 0.10. Ground is wet. What is P(it rained)?</p>
        <div class="problem-input-row">
          <input type="number" id="s2p3_in" placeholder="P(rain|wet)" step="0.001">
          <button class="btn btn-sm" onclick="checkNum('s2p3_in','s2p3_fb',0.8025,0.005)">Check</button>
        </div>
        <div class="feedback" id="s2p3_fb"></div>
      </div>
      <div class="problem">
        <p><strong>4.</strong> Are these events independent? P(A)=0.4, P(B)=0.5, P(A&cap;B)=0.2.</p>
        <div class="mc-choices">
          <button class="mc-btn" onclick="checkMC(this,'yes','s2p4_grp')">A) Yes -- P(A&cap;B) = P(A)&middot;P(B) = 0.2 exactly</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s2p4_grp')">B) No -- we would need P(A&cap;B) = 0.0</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s2p4_grp')">C) Cannot tell from this information</button>
        </div>
      </div>
    </div>
  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 3: DISCRETE DISTRIBUTIONS -->
<!-- ============================================================ -->
<div class="section-card" data-section="3">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">3</span> Discrete Distributions</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      A <strong>random variable</strong> X maps outcomes to numbers. For discrete X, the <strong>probability mass function</strong> (PMF) P(X=x) gives the probability of each value. Key summary statistics are <strong>expected value</strong> (mean) and <strong>variance</strong>:
    </p>

    <div class="formula-box large">E[X] = &Sigma; x &middot; P(X = x) &nbsp;&nbsp;&nbsp; &sigma;&sup2; = E[X&sup2;] - (E[X])&sup2;</div>

    <p class="concept-text">
      The <strong>binomial distribution</strong> B(n, p) models the number of successes in n independent trials where each trial succeeds with probability p. Using the binomial coefficient C(n,k) = n! / (k!(n-k)!):
    </p>

    <div class="formula-box green large">P(X = k) = C(n,k) &middot; p<sup>k</sup> &middot; (1-p)<sup>n-k</sup></div>

    <div class="formula-box amber">E[X] = np &nbsp;&nbsp;&nbsp; Var(X) = np(1-p) &nbsp;&nbsp;&nbsp; SD = &radic;(np(1-p))</div>

    <p class="concept-text">
      The <strong>Poisson distribution</strong> models counts of rare events over a fixed interval. If events occur at average rate &lambda; (lambda), then the number k occurring follows:
    </p>

    <div class="formula-box pink">P(X = k) = &lambda;<sup>k</sup> e<sup>-&lambda;</sup> / k! &nbsp;&nbsp;&nbsp; E[X] = Var(X) = &lambda;</div>

    <div class="key-point"><strong>When to use which:</strong> Binomial -- fixed n trials, each success/fail, constant p. Poisson -- counting events in time/space with known average rate, no fixed n. Poisson approximates Binomial when n is large and p is small (rare events), with &lambda; = np.</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Binomial Distribution Plotter</div>
      <p style="font-size:.72rem;color:var(--text-dim);margin-bottom:10px">Adjust n and p to shape the PMF. Select k to highlight P(X=k).</p>
      <div class="slider-row">
        <label>n (trials)</label>
        <input type="range" id="binom_n" min="2" max="30" step="1" value="10" oninput="updateBinom()">
        <span class="slider-val" id="binom_n_val">10</span>
      </div>
      <div class="slider-row">
        <label>p (success prob)</label>
        <input type="range" id="binom_p" min="0.05" max="0.95" step="0.01" value="0.40" oninput="updateBinom()">
        <span class="slider-val" id="binom_p_val">0.40</span>
      </div>
      <div class="slider-row">
        <label>highlight k</label>
        <input type="range" id="binom_k" min="0" max="30" step="1" value="4" oninput="updateBinom()">
        <span class="slider-val" id="binom_k_val">4</span>
      </div>
      <canvas id="binomCanvas" height="200"></canvas>
      <div class="readout">
        <div class="readout-item"><span class="label">Mean np</span><br><span class="value indigo" id="binom_mean">4.00</span></div>
        <div class="readout-item"><span class="label">SD &radic;(np(1-p))</span><br><span class="value green" id="binom_sd">1.549</span></div>
        <div class="readout-item"><span class="label">P(X = k)</span><br><span class="value pink" id="binom_pk">0.2508</span></div>
        <div class="readout-item"><span class="label">P(X &le; k)</span><br><span class="value amber" id="binom_cdf">0.6331</span></div>
      </div>
    </div>

    <div class="navy-context">
      <strong>Navy context:</strong> Binomial distribution governs <strong>weapons system reliability</strong>. If a missile has 0.85 hit probability and you fire 4, P(X &ge; 3 hits) = P(3) + P(4). Damage control uses Poisson to model flooding incidents per watch. Radio communications use binomial to model bit error rates -- if BER = 10<sup>-3</sup> and a packet has 1000 bits, P(error-free) = (0.999)<sup>1000</sup> &approx; 0.368.
    </div>

    <div class="practice-block"><div class="practice-title">Practice Problems</div>
      <div class="problem">
        <p><strong>1.</strong> X ~ B(8, 0.3). Compute P(X = 2). Use C(8,2)&times;0.3&sup2;&times;0.7&sup6;. Round to 4 places.</p>
        <div class="problem-input-row">
          <input type="number" id="s3p1_in" placeholder="P(X=2)" step="0.0001">
          <button class="btn btn-sm" onclick="checkNum('s3p1_in','s3p1_fb',0.2965,0.005)">Check</button>
        </div>
        <div class="feedback" id="s3p1_fb"></div>
      </div>
      <div class="problem">
        <p><strong>2.</strong> X ~ Poisson(&lambda;=3). Compute P(X=2) = 3&sup2;e&sup3;/2! Round to 4 places.</p>
        <div class="problem-input-row">
          <input type="number" id="s3p2_in" placeholder="P(X=2)" step="0.0001">
          <button class="btn btn-sm" onclick="checkNum('s3p2_in','s3p2_fb',0.2240,0.005)">Check</button>
        </div>
        <div class="feedback" id="s3p2_fb"></div>
      </div>
      <div class="problem">
        <p><strong>3.</strong> A discrete RV has P(X=0)=0.2, P(X=1)=0.5, P(X=2)=0.3. Compute E[X].</p>
        <div class="problem-input-row">
          <input type="number" id="s3p3_in" placeholder="E[X]" step="0.01">
          <button class="btn btn-sm" onclick="checkNum('s3p3_in','s3p3_fb',1.1,0.01)">Check</button>
        </div>
        <div class="feedback" id="s3p3_fb"></div>
      </div>
      <div class="problem">
        <p><strong>4.</strong> For X ~ B(20, 0.5), what is the variance?</p>
        <div class="problem-input-row">
          <input type="number" id="s3p4_in" placeholder="Var(X)" step="0.01">
          <button class="btn btn-sm" onclick="checkNum('s3p4_in','s3p4_fb',5.0,0.01)">Check</button>
        </div>
        <div class="feedback" id="s3p4_fb"></div>
      </div>
    </div>
  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 4: CONTINUOUS DISTRIBUTIONS -->
<!-- ============================================================ -->
<div class="section-card" data-section="4">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">4</span> Continuous Distributions</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      For continuous random variables, the <strong>probability density function</strong> (PDF) f(x) satisfies P(a &le; X &le; b) = &int;<sub>a</sub><sup>b</sup> f(x)dx. Individual points have zero probability -- only intervals matter. The <strong>CDF</strong> F(x) = P(X &le; x) = &int;<sub>-&infin;</sub><sup>x</sup> f(t)dt.
    </p>

    <p class="concept-text">
      The <strong>normal distribution</strong> N(&mu;, &sigma;&sup2;) is the most important distribution in statistics. Its bell-shaped PDF is symmetric around &mu; with spread controlled by &sigma;:
    </p>

    <div class="formula-box large">f(x) = (1/(&sigma;&radic;(2&pi;))) &middot; e<sup>-(x-&mu;)&sup2; / (2&sigma;&sup2;)</sup></div>

    <p class="concept-text">
      <strong>Standardization</strong> converts any normal to the standard normal N(0,1) using the Z-score. Then a Z-table gives probabilities:
    </p>

    <div class="formula-box green large">Z = (X - &mu;) / &sigma; &nbsp;&nbsp;&nbsp; X ~ N(&mu;, &sigma;&sup2;) &nbsp;&Rightarrow; &nbsp; Z ~ N(0, 1)</div>

    <p class="concept-text">
      The <strong>68-95-99.7 empirical rule</strong>: P(&mu; - &sigma; &lt; X &lt; &mu; + &sigma;) &approx; 0.6827, P(&mu; - 2&sigma; &lt; X &lt; &mu; + 2&sigma;) &approx; 0.9545, P(&mu; - 3&sigma; &lt; X &lt; &mu; + 3&sigma;) &approx; 0.9973.
    </p>

    <div class="key-point"><strong>Z-table reminder:</strong> &Phi;(z) = P(Z &le; z). For P(a &lt; Z &lt; b) = &Phi;(b) - &Phi;(a). For P(Z &gt; z) = 1 - &Phi;(z). Common values: &Phi;(1.645) &approx; 0.95, &Phi;(1.96) &approx; 0.975, &Phi;(2.576) &approx; 0.995.</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Normal Distribution Visualizer</div>
      <p style="font-size:.72rem;color:var(--text-dim);margin-bottom:10px">Adjust &mu;, &sigma;, and the shaded Z-range to see the probability of an interval.</p>
      <div class="slider-row">
        <label>&mu; (mean)</label>
        <input type="range" id="norm_mu" min="-5" max="5" step="0.1" value="0" oninput="updateNorm()">
        <span class="slider-val" id="norm_mu_val">0.0</span>
      </div>
      <div class="slider-row">
        <label>&sigma; (std dev)</label>
        <input type="range" id="norm_sigma" min="0.3" max="3" step="0.1" value="1.0" oninput="updateNorm()">
        <span class="slider-val" id="norm_sigma_val">1.0</span>
      </div>
      <div class="slider-row">
        <label>Z&#8321; (lower)</label>
        <input type="range" id="norm_z1" min="-4" max="4" step="0.05" value="-1.96" oninput="updateNorm()">
        <span class="slider-val" id="norm_z1_val">-1.96</span>
      </div>
      <div class="slider-row">
        <label>Z&#8322; (upper)</label>
        <input type="range" id="norm_z2" min="-4" max="4" step="0.05" value="1.96" oninput="updateNorm()">
        <span class="slider-val" id="norm_z2_val">1.96</span>
      </div>
      <canvas id="normCanvas" height="200"></canvas>
      <div class="readout">
        <div class="readout-item"><span class="label">x&#8321; (lower)</span><br><span class="value indigo" id="norm_x1_val">-1.96</span></div>
        <div class="readout-item"><span class="label">x&#8322; (upper)</span><br><span class="value indigo" id="norm_x2_val">1.96</span></div>
        <div class="readout-item"><span class="label">P(Z&#8321; &lt; Z &lt; Z&#8322;)</span><br><span class="value green" id="norm_prob">0.9500</span></div>
        <div class="readout-item"><span class="label">P(Z &lt; Z&#8321;)</span><br><span class="value pink" id="norm_left">0.0250</span></div>
        <div class="readout-item"><span class="label">P(Z &gt; Z&#8322;)</span><br><span class="value amber" id="norm_right">0.0250</span></div>
      </div>
    </div>

    <div class="navy-context">
      <strong>Navy context:</strong> Normal distribution is fundamental to <strong>targeting and weapons accuracy</strong>. Circular Error Probable (CEP) describes where 50% of rounds land -- derived from 2D normal distributions. Radar measurements, sonar bearings, and navigation fixes all carry Gaussian errors described by &mu; (systematic bias) and &sigma; (random scatter). The Z-score transforms any measurement into standard deviations from expected, which enables comparison across sensors and environments.
    </div>

    <div class="practice-block"><div class="practice-title">Practice Problems</div>
      <div class="problem">
        <p><strong>1.</strong> X ~ N(100, 225) (mean=100, variance=225, so &sigma;=15). Find Z for X=130.</p>
        <div class="problem-input-row">
          <input type="number" id="s4p1_in" placeholder="Z" step="0.01">
          <button class="btn btn-sm" onclick="checkNum('s4p1_in','s4p1_fb',2.0,0.01)">Check</button>
        </div>
        <div class="feedback" id="s4p1_fb"></div>
      </div>
      <div class="problem">
        <p><strong>2.</strong> X ~ N(50, 100) (&sigma;=10). What is P(X &lt; 60)? Use Z = (60-50)/10 = 1, &Phi;(1) &approx; 0.8413.</p>
        <div class="problem-input-row">
          <input type="number" id="s4p2_in" placeholder="P(X<60)" step="0.0001">
          <button class="btn btn-sm" onclick="checkNum('s4p2_in','s4p2_fb',0.8413,0.005)">Check</button>
        </div>
        <div class="feedback" id="s4p2_fb"></div>
      </div>
      <div class="problem">
        <p><strong>3.</strong> X ~ N(0, 1). Using the 68-95-99.7 rule, what is P(-2 &lt; X &lt; 2)?</p>
        <div class="mc-choices">
          <button class="mc-btn" onclick="checkMC(this,'no','s4p3_grp')">A) approximately 0.6827</button>
          <button class="mc-btn" onclick="checkMC(this,'yes','s4p3_grp')">B) approximately 0.9545</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s4p3_grp')">C) approximately 0.9973</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s4p3_grp')">D) exactly 1.0000</button>
        </div>
      </div>
      <div class="problem">
        <p><strong>4.</strong> Heights are N(70, 9) inches. What fraction of people are between 67 and 73 inches? (That's &mu; &plusmn; 1&sigma;.)</p>
        <div class="problem-input-row">
          <input type="number" id="s4p4_in" placeholder="fraction" step="0.0001">
          <button class="btn btn-sm" onclick="checkNum('s4p4_in','s4p4_fb',0.6827,0.005)">Check</button>
        </div>
        <div class="feedback" id="s4p4_fb"></div>
      </div>
    </div>
  </div></div>
</div>

<!-- ============================================================ -->
<!-- SECTION 5: STATISTICS & INFERENCE -->
<!-- ============================================================ -->
<div class="section-card" data-section="5">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num">5</span> Statistics &amp; Inference</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">

    <p class="concept-text">
      <strong>Descriptive statistics</strong> summarize data. For a sample x&#8321;,...,x&#8345; the <strong>sample mean</strong> x&#772; and <strong>sample variance</strong> s&sup2; estimate the population parameters &mu; and &sigma;&sup2;:
    </p>

    <div class="formula-box large">x&#772; = (1/n)&Sigma;x&#7522; &nbsp;&nbsp;&nbsp; s&sup2; = (1/(n-1))&Sigma;(x&#7522; - x&#772;)&sup2;</div>

    <p class="concept-text">
      The <strong>Central Limit Theorem</strong> (CLT) is arguably the most profound result in statistics: regardless of the population distribution shape, the sampling distribution of x&#772; is approximately normal for large n, with mean &mu; and standard error &sigma;/&radic;n:
    </p>

    <div class="formula-box green large">x&#772; ~ N(&mu;, &sigma;&sup2;/n) &nbsp;&nbsp; (approximately, for large n)</div>

    <p class="concept-text">
      A <strong>confidence interval</strong> (CI) for the population mean gives a range likely to contain &mu;. For a 95% CI with known &sigma;:
    </p>

    <div class="formula-box pink">x&#772; &plusmn; z* &middot; (&sigma;/&radic;n) &nbsp;&nbsp;&nbsp; 95% CI: z* = 1.96</div>

    <p class="concept-text">
      <strong>Hypothesis testing</strong> uses data to assess a claim. The <strong>null hypothesis</strong> H&#8320; is the default assumption (e.g., no effect). A <strong>test statistic</strong> measures how extreme the data are under H&#8320;. The <strong>p-value</strong> is P(seeing data this extreme | H&#8320; true). We reject H&#8320; when p-value &lt; &alpha; (significance level, typically 0.05).
    </p>

    <div class="step-box">
      <div class="step-label">Hypothesis Testing Steps</div>
      <div class="step-content">
        <strong>1. State:</strong> H&#8320;: &mu; = &mu;&#8320; vs H&#8321;: &mu; &ne; &mu;&#8320; (two-tailed)<br>
        <strong>2. Compute:</strong> Z = (x&#772; - &mu;&#8320;) / (&sigma;/&radic;n)<br>
        <strong>3. Find p-value:</strong> p = 2P(Z &gt; |z|) for two-tailed<br>
        <strong>4. Decide:</strong> Reject H&#8320; if p &lt; &alpha; = 0.05<br>
        <span style="color:var(--amber)">Note: "Fail to reject H&#8320;" is NOT the same as "H&#8320; is true".</span>
      </div>
    </div>

    <div class="key-point"><strong>Common misconception:</strong> The p-value is NOT the probability that H&#8320; is true. It is the probability of the observed data (or more extreme) assuming H&#8320; is true. A small p-value means the data are unlikely under H&#8320;, which is evidence against H&#8320;.</div>

    <div class="interactive-area">
      <div class="interactive-label">Interactive: Central Limit Theorem Demo</div>
      <p style="font-size:.72rem;color:var(--text-dim);margin-bottom:10px">Increase sample size n. Watch how the distribution of sample means converges to a normal bell curve, regardless of the (skewed) population shape shown on the left.</p>
      <div class="slider-row">
        <label>Sample size n</label>
        <input type="range" id="clt_n" min="1" max="100" step="1" value="5" oninput="updateCLT()">
        <span class="slider-val" id="clt_n_val">5</span>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px">
        <div>
          <div class="sub-label">Population (exponential, skewed)</div>
          <canvas id="cltPopCanvas" height="160"></canvas>
        </div>
        <div>
          <div class="sub-label" id="clt_sampling_label">Sampling dist. of x&#772; (n=5)</div>
          <canvas id="cltSampCanvas" height="160"></canvas>
        </div>
      </div>
      <div class="readout">
        <div class="readout-item"><span class="label">Pop. mean &mu;</span><br><span class="value indigo">1.000</span></div>
        <div class="readout-item"><span class="label">Pop. SD &sigma;</span><br><span class="value green">1.000</span></div>
        <div class="readout-item"><span class="label">SE = &sigma;/&radic;n</span><br><span class="value pink" id="clt_se">0.447</span></div>
        <div class="readout-item"><span class="label">Normality (n)</span><br><span class="value amber" id="clt_norm_note">Somewhat normal</span></div>
      </div>
    </div>

    <div class="navy-context">
      <strong>Navy context:</strong> The CLT justifies using normal-based confidence intervals for navigation fix errors, sonar bearing estimates, and maintenance timing. Hypothesis testing is used in <strong>operational testing</strong>: H&#8320; = weapon meets spec, H&#8321; = it does not. Setting &alpha; = 0.05 controls the Type I error rate (false alarm). Type II error (missing a real deficiency) is controlled by sample size n -- a tradeoff between testing cost and operational risk that naval acquisitions balance continuously.
    </div>

    <div class="practice-block"><div class="practice-title">Practice Problems</div>
      <div class="problem">
        <p><strong>1.</strong> A sample of n=25 has x&#772; = 48, &sigma; = 10 (known). Compute the 95% CI lower bound. (x&#772; - 1.96&sigma;/&radic;n)</p>
        <div class="problem-input-row">
          <input type="number" id="s5p1_in" placeholder="lower bound" step="0.01">
          <button class="btn btn-sm" onclick="checkNum('s5p1_in','s5p1_fb',44.08,0.1)">Check</button>
        </div>
        <div class="feedback" id="s5p1_fb"></div>
      </div>
      <div class="problem">
        <p><strong>2.</strong> The CLT says the standard error of x&#772; is:</p>
        <div class="mc-choices">
          <button class="mc-btn" onclick="checkMC(this,'no','s5p2_grp')">A) &sigma;</button>
          <button class="mc-btn" onclick="checkMC(this,'yes','s5p2_grp')">B) &sigma; / &radic;n</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s5p2_grp')">C) &sigma;&sup2; / n</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s5p2_grp')">D) &sigma; &middot; n</button>
        </div>
      </div>
      <div class="problem">
        <p><strong>3.</strong> H&#8320;: &mu; = 50, &sigma; = 10, n = 100, x&#772; = 52. Compute the Z test statistic.</p>
        <div class="problem-input-row">
          <input type="number" id="s5p3_in" placeholder="Z" step="0.01">
          <button class="btn btn-sm" onclick="checkNum('s5p3_in','s5p3_fb',2.0,0.05)">Check</button>
        </div>
        <div class="feedback" id="s5p3_fb"></div>
      </div>
      <div class="problem">
        <p><strong>4.</strong> A p-value of 0.03 at &alpha;=0.05 means:</p>
        <div class="mc-choices">
          <button class="mc-btn" onclick="checkMC(this,'yes','s5p4_grp')">A) Reject H&#8320; -- evidence is significant at 5% level</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s5p4_grp')">B) Fail to reject H&#8320; -- not enough evidence</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s5p4_grp')">C) H&#8320; is definitely false</button>
          <button class="mc-btn" onclick="checkMC(this,'no','s5p4_grp')">D) P(H&#8320; true) = 0.03</button>
        </div>
      </div>
    </div>
  </div></div>
</div>

<!-- ============================================================ -->
<!-- QUIZ -->
<!-- ============================================================ -->
<div class="section-card" data-section="quiz">
  <div class="section-header" onclick="toggleSection(this)">
    <h2><span class="section-num" style="background:var(--amber-dim);color:var(--amber)">Q</span> Final Quiz &mdash; 10 Questions</h2>
    <svg class="chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
  </div>
  <div class="section-body"><div class="section-inner">
    <div class="quiz-score">
      <span class="score-text">Score: <span id="quizScore">0</span> / <span id="quizTotal">10</span></span>
      <span style="font-size:.72rem;color:var(--text-dim)" id="quizPct">0%</span>
    </div>

    <!-- Q1 -->
    <div class="quiz-q" id="qq1">
      <div class="q-num">Question 1 of 10</div>
      <div class="q-text">P(A) = 0.4, P(B) = 0.6, P(A &cup; B) = 0.76. What is P(A &cap; B)?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq1','wrong')">A) 0.00</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq1','wrong')">B) 0.10</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq1','correct')">C) 0.24</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq1','wrong')">D) 0.76</button>
      </div>
    </div>

    <!-- Q2 -->
    <div class="quiz-q" id="qq2">
      <div class="q-num">Question 2 of 10</div>
      <div class="q-text">Which condition defines two events A and B as independent?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq2','wrong')">A) P(A &cap; B) = 0</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq2','correct')">B) P(A &cap; B) = P(A) &middot; P(B)</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq2','wrong')">C) P(A | B) = P(B)</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq2','wrong')">D) P(A &cup; B) = 1</button>
      </div>
    </div>

    <!-- Q3 -->
    <div class="quiz-q" id="qq3">
      <div class="q-num">Question 3 of 10</div>
      <div class="q-text">Bayes' theorem: P(A|B) = ?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq3','wrong')">A) P(A) &middot; P(B)</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq3','wrong')">B) P(B|A) / P(A)</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq3','correct')">C) P(B|A) &middot; P(A) / P(B)</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq3','wrong')">D) P(A &cup; B) / P(B)</button>
      </div>
    </div>

    <!-- Q4 -->
    <div class="quiz-q" id="qq4">
      <div class="q-num">Question 4 of 10</div>
      <div class="q-text">X ~ B(5, 0.5). What is E[X]?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq4','wrong')">A) 1.0</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq4','wrong')">B) 2.0</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq4','correct')">C) 2.5</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq4','wrong')">D) 5.0</button>
      </div>
    </div>

    <!-- Q5 -->
    <div class="quiz-q" id="qq5">
      <div class="q-num">Question 5 of 10</div>
      <div class="q-text">X ~ Poisson(4). What is Var(X)?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq5','wrong')">A) 2</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq5','correct')">B) 4</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq5','wrong')">C) 16</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq5','wrong')">D) &radic;4 = 2</button>
      </div>
    </div>

    <!-- Q6 -->
    <div class="quiz-q" id="qq6">
      <div class="q-num">Question 6 of 10</div>
      <div class="q-text">X ~ N(20, 16) (&sigma; = 4). What is Z for X = 12?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq6','wrong')">A) +2</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq6','correct')">B) -2</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq6','wrong')">C) -0.5</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq6','wrong')">D) +0.5</button>
      </div>
    </div>

    <!-- Q7 -->
    <div class="quiz-q" id="qq7">
      <div class="q-num">Question 7 of 10</div>
      <div class="q-text">The 68-95-99.7 rule says P(&mu;-3&sigma; &lt; X &lt; &mu;+3&sigma;) &approx;?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq7','wrong')">A) 0.6827</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq7','wrong')">B) 0.9545</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq7','correct')">C) 0.9973</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq7','wrong')">D) 1.0000</button>
      </div>
    </div>

    <!-- Q8 -->
    <div class="quiz-q" id="qq8">
      <div class="q-num">Question 8 of 10</div>
      <div class="q-text">The Central Limit Theorem guarantees that x&#772; is approximately normal when:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq8','wrong')">A) The population is already normal</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq8','wrong')">B) n &lt; 30 always</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq8','correct')">C) n is sufficiently large (regardless of population shape)</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq8','wrong')">D) &sigma; is known</button>
      </div>
    </div>

    <!-- Q9 -->
    <div class="quiz-q" id="qq9">
      <div class="q-num">Question 9 of 10</div>
      <div class="q-text">For a 95% confidence interval, the standard error is &sigma;/&radic;n. If &sigma; = 20 and n = 100, what is the margin of error (z* = 1.96)?</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq9','wrong')">A) 1.96</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq9','wrong')">B) 2.92</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq9','correct')">C) 3.92</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq9','wrong')">D) 39.2</button>
      </div>
    </div>

    <!-- Q10 -->
    <div class="quiz-q" id="qq10">
      <div class="q-num">Question 10 of 10</div>
      <div class="q-text">A p-value of 0.001 at significance level &alpha; = 0.05 means:</div>
      <div class="choices">
        <button class="choice-btn" onclick="quizAnswer(this,'qq10','correct')">A) Reject H&#8320; -- strong evidence against the null</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq10','wrong')">B) Fail to reject H&#8320;</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq10','wrong')">C) There is a 0.1% chance H&#8320; is true</button>
        <button class="choice-btn" onclick="quizAnswer(this,'qq10','wrong')">D) The result is not statistically significant</button>
      </div>
    </div>

  </div></div>
</div>

</div><!-- .content -->

<script>
// ============================================================
// SECTION TOGGLE & PROGRESS
// ============================================================
let completedSections = new Set();
const TOTAL_SECTIONS = 5;

function toggleSection(header) {
  const card = header.closest('.section-card');
  const wasOpen = card.classList.contains('open');
  card.classList.toggle('open', !wasOpen);
  if (!wasOpen) {
    const sec = card.dataset.section;
    if (sec !== 'quiz') {
      completedSections.add(sec);
      card.classList.add('completed');
      updateProgress();
    }
  }
}

function updateProgress() {
  const pct = (completedSections.size / TOTAL_SECTIONS) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressLabel').textContent = completedSections.size + ' / ' + TOTAL_SECTIONS + ' sections';
}

// ============================================================
// PRACTICE HELPERS
// ============================================================
function checkNum(inputId, fbId, answer, tol) {
  const val = parseFloat(document.getElementById(inputId).value);
  const fb = document.getElementById(fbId);
  const input = document.getElementById(inputId);
  if (isNaN(val)) { fb.className = 'feedback incorrect'; fb.textContent = 'Enter a number.'; return; }
  if (Math.abs(val - answer) <= tol) {
    fb.className = 'feedback correct'; fb.textContent = 'Correct! Answer: ' + answer;
    springPop(input);
  } else {
    fb.className = 'feedback incorrect'; fb.textContent = 'Not quite. Expected ~' + answer + '. Got ' + val.toFixed(4);
    shake(input);
  }
}

function checkMC(btn, correctVal, group) {
  const parent = btn.closest('.mc-choices') || btn.parentElement;
  parent.querySelectorAll('.mc-btn').forEach(b => {
    b.classList.remove('correct','wrong');
    b.classList.add('disabled');
  });
  if (correctVal === 'yes') {
    btn.classList.remove('disabled');
    btn.classList.add('correct');
    springPop(btn);
  } else {
    btn.classList.remove('disabled');
    btn.classList.add('wrong');
    shake(btn);
    parent.querySelectorAll('.mc-btn').forEach(b => {
      if (b !== btn && b.getAttribute('onclick') && b.getAttribute('onclick').includes("'yes'")) {
        b.classList.remove('disabled');
        b.classList.add('correct');
      }
    });
  }
}

function springPop(el) {
  el.classList.remove('pop');
  void el.offsetWidth;
  el.classList.add('pop');
}
function shake(el) {
  el.classList.remove('shake');
  void el.offsetWidth;
  el.classList.add('shake');
}

// ============================================================
// QUIZ
// ============================================================
let quizScore = 0;
let quizAnswered = new Set();

function quizAnswer(btn, qId, result) {
  if (quizAnswered.has(qId)) return;
  quizAnswered.add(qId);
  const qEl = document.getElementById(qId);
  qEl.querySelectorAll('.choice-btn').forEach(b => b.classList.add('disabled'));
  if (result === 'correct') {
    btn.classList.add('selected-correct');
    springPop(btn);
    quizScore++;
  } else {
    btn.classList.add('selected-wrong');
    shake(btn);
    qEl.querySelectorAll('.choice-btn').forEach(b => {
      if (b.getAttribute('onclick') && b.getAttribute('onclick').includes("'correct'")) {
        b.classList.add('reveal-correct');
      }
    });
  }
  document.getElementById('quizScore').textContent = quizScore;
  document.getElementById('quizPct').textContent = Math.round(quizScore / quizAnswered.size * 100) + '% (' + quizAnswered.size + ' answered)';
}

// ============================================================
// VENN DIAGRAM
// ============================================================
function updateVenn() {
  const pA = parseFloat(document.getElementById('venn_pA').value);
  const pB = parseFloat(document.getElementById('venn_pB').value);
  let pAB = parseFloat(document.getElementById('venn_pAB').value);
  pAB = Math.min(pAB, pA, pB);

  document.getElementById('venn_pA_val').textContent = pA.toFixed(2);
  document.getElementById('venn_pB_val').textContent = pB.toFixed(2);
  document.getElementById('venn_pAB_val').textContent = pAB.toFixed(2);

  const union = pA + pB - pAB;
  const compA = 1 - pA;
  const compB = 1 - pB;
  const AgivenB = pAB / pB;
  const BgivenA = pAB / pA;
  const mutex = pAB < 0.001 ? 'Yes' : 'No';

  document.getElementById('v_union').textContent = union.toFixed(3);
  document.getElementById('v_compA').textContent = compA.toFixed(3);
  document.getElementById('v_compB').textContent = compB.toFixed(3);
  document.getElementById('v_AgivenB').textContent = AgivenB.toFixed(3);
  document.getElementById('v_BgivenA').textContent = BgivenA.toFixed(3);
  document.getElementById('v_mutex').textContent = mutex;

  drawVenn(pA, pB, pAB);
}

function drawVenn(pA, pB, pAB) {
  const canvas = document.getElementById('vennCanvas');
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.clientWidth || 600;
  const H = 180;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  ctx.clearRect(0, 0, W, H);

  // Background
  ctx.fillStyle = '#1a1d24';
  ctx.fillRect(0, 0, W, H);

  const cx = W / 2, cy = H / 2;
  const r = Math.min(W * 0.22, H * 0.38);
  const overlap = pAB / Math.min(pA, pB);
  const separation = r * (1.2 - overlap * 0.9);

  const ax = cx - separation * 0.5;
  const bx = cx + separation * 0.5;

  // Circle A fill
  ctx.beginPath();
  ctx.arc(ax, cy, r, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(99,102,241,0.25)';
  ctx.fill();
  ctx.strokeStyle = '#6366f1';
  ctx.lineWidth = 1.5;
  ctx.stroke();

  // Circle B fill
  ctx.beginPath();
  ctx.arc(bx, cy, r, 0, Math.PI * 2);
  ctx.fillStyle = 'rgba(236,72,153,0.20)';
  ctx.fill();
  ctx.strokeStyle = '#ec4899';
  ctx.lineWidth = 1.5;
  ctx.stroke();

  // Labels
  ctx.font = '600 12px JetBrains Mono, monospace';
  ctx.fillStyle = '#6366f1';
  ctx.textAlign = 'center';
  ctx.fillText('A', ax - r * 0.45, cy);
  ctx.fillStyle = '#ec4899';
  ctx.fillText('B', bx + r * 0.45, cy);

  // P(A), P(B) values
  ctx.font = '11px JetBrains Mono, monospace';
  ctx.fillStyle = 'rgba(226,228,233,0.7)';
  ctx.fillText(pA.toFixed(2), ax - r * 0.45, cy + 18);
  ctx.fillText(pB.toFixed(2), bx + r * 0.45, cy + 18);

  // Intersection label
  ctx.fillStyle = '#f59e0b';
  ctx.fillText(pAB.toFixed(2), cx, cy + 5);
}

// ============================================================
// PROBABILITY TREE
// ============================================================
function updateTree() {
  const pA = parseFloat(document.getElementById('tree_pA').value);
  const pAc = 1 - pA;
  const pBgA = parseFloat(document.getElementById('tree_pBgA').value);
  const pBcgA = 1 - pBgA;
  const pBgAc = parseFloat(document.getElementById('tree_pBgAc').value);
  const pBcgAc = 1 - pBgAc;

  document.getElementById('tree_pA_val').textContent = pA.toFixed(2);
  document.getElementById('tree_pBgA_val').textContent = pBgA.toFixed(2);
  document.getElementById('tree_pBgAc_val').textContent = pBgAc.toFixed(2);

  const pAB = pA * pBgA;
  const pABc = pA * pBcgA;
  const pAcB = pAc * pBgAc;
  const pAcBc = pAc * pBcgAc;
  const pB = pAB + pAcB;
  const pAgB = pAB / pB;

  document.getElementById('tree_pAB').textContent = pAB.toFixed(3);
  document.getElementById('tree_pABc').textContent = pABc.toFixed(3);
  document.getElementById('tree_pAcB').textContent = pAcB.toFixed(3);
  document.getElementById('tree_pAcBc').textContent = pAcBc.toFixed(3);
  document.getElementById('tree_pB').textContent = pB.toFixed(3);
  document.getElementById('tree_pAgB').textContent = pAgB.toFixed(3);

  drawTree(pA, pAc, pBgA, pBcgA, pBgAc, pBcgAc, pAB, pABc, pAcB, pAcBc);
}

function drawTree(pA, pAc, pBgA, pBcgA, pBgAc, pBcgAc, pAB, pABc, pAcB, pAcBc) {
  const canvas = document.getElementById('treeCanvas');
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.clientWidth || 600;
  const H = 220;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  ctx.clearRect(0, 0, W, H);
  ctx.fillStyle = '#1a1d24';
  ctx.fillRect(0, 0, W, H);

  const m = 32;
  const x0 = m + 30;
  const x1 = W * 0.42;
  const x2 = W - m - 10;
  const yA = H * 0.28, yAc = H * 0.72;
  const yAB = H * 0.12, yABc = H * 0.38, yAcB = H * 0.62, yAcBc = H * 0.88;
  const ym = H / 2;

  function line(x1, y1, x2, y2, col, w) {
    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2);
    ctx.strokeStyle = col; ctx.lineWidth = w || 1.5; ctx.stroke();
  }
  function dot(x, y, col, r) {
    ctx.beginPath(); ctx.arc(x, y, r || 5, 0, Math.PI*2);
    ctx.fillStyle = col; ctx.fill();
  }
  function label(x, y, text, col, align) {
    ctx.fillStyle = col; ctx.font = '600 11px JetBrains Mono, monospace';
    ctx.textAlign = align || 'center'; ctx.fillText(text, x, y);
  }

  // Root
  dot(x0, ym, '#9ca3af', 4);

  // Stage 1 branches
  line(x0, ym, x1, yA, '#6366f1', 2);
  line(x0, ym, x1, yAc, '#ec4899', 2);

  // Stage 2 branches from A
  line(x1, yA, x2, yAB, '#22c55e', 1.5);
  line(x1, yA, x2, yABc, '#f59e0b', 1.5);

  // Stage 2 branches from A'
  line(x1, yAc, x2, yAcB, '#22c55e', 1.5);
  line(x1, yAc, x2, yAcBc, '#f59e0b', 1.5);

  // Stage 1 nodes
  dot(x1, yA, '#6366f1', 6);
  dot(x1, yAc, '#ec4899', 6);

  // Stage 2 nodes
  [yAB, yABc, yAcB, yAcBc].forEach(y => dot(x2, y, '#9ca3af', 4));

  // Stage 1 labels
  label(x1 - 2, yA - 10, 'A', '#6366f1');
  label(x1 - 2, yAc + 18, "A'", '#ec4899');

  // Branch probability labels
  const mx1 = (x0 + x1) / 2;
  label(mx1, (ym + yA) / 2 - 6, pA.toFixed(2), '#6366f1');
  label(mx1, (ym + yAc) / 2 + 14, pAc.toFixed(2), '#ec4899');

  const mx2a = (x1 + x2) / 2;
  label(mx2a, (yA + yAB) / 2 - 5, pBgA.toFixed(2), '#22c55e');
  label(mx2a, (yA + yABc) / 2 + 12, pBcgA.toFixed(2), '#f59e0b');
  label(mx2a, (yAc + yAcB) / 2 - 5, pBgAc.toFixed(2), '#22c55e');
  label(mx2a, (yAc + yAcBc) / 2 + 12, pBcgAc.toFixed(2), '#f59e0b');

  // Joint probability labels at end
  ctx.font = '500 10px JetBrains Mono, monospace'; ctx.textAlign = 'left';
  const jx = x2 + 6;
  ctx.fillStyle = '#22c55e'; ctx.fillText('P(AB)=' + pAB.toFixed(3), jx, yAB + 4);
  ctx.fillStyle = '#f59e0b'; ctx.fillText("P(AB')=" + pABc.toFixed(3), jx, yABc + 4);
  ctx.fillStyle = '#22c55e'; ctx.fillText("P(A'B)=" + pAcB.toFixed(3), jx, yAcB + 4);
  ctx.fillStyle = '#f59e0b'; ctx.fillText("P(A'B')=" + pAcBc.toFixed(3), jx, yAcBc + 4);
}

// ============================================================
// BINOMIAL PLOTTER
// ============================================================
function binom(n, k) {
  if (k < 0 || k > n) return 0;
  let res = 1;
  for (let i = 0; i < k; i++) {
    res = res * (n - i) / (i + 1);
  }
  return res;
}

function binomPMF(n, p, k) {
  return binom(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);
}

function updateBinom() {
  const n = parseInt(document.getElementById('binom_n').value);
  const p = parseFloat(document.getElementById('binom_p').value);
  let k = parseInt(document.getElementById('binom_k').value);
  k = Math.min(k, n);
  document.getElementById('binom_k').max = n;

  document.getElementById('binom_n_val').textContent = n;
  document.getElementById('binom_p_val').textContent = p.toFixed(2);
  document.getElementById('binom_k_val').textContent = k;

  const mean = n * p;
  const sd = Math.sqrt(n * p * (1 - p));
  document.getElementById('binom_mean').textContent = mean.toFixed(2);
  document.getElementById('binom_sd').textContent = sd.toFixed(3);

  const probs = [];
  for (let i = 0; i <= n; i++) probs.push(binomPMF(n, p, i));

  const pk = probs[k];
  const cdf = probs.slice(0, k + 1).reduce((a, b) => a + b, 0);
  document.getElementById('binom_pk').textContent = pk.toFixed(4);
  document.getElementById('binom_cdf').textContent = cdf.toFixed(4);

  drawBinom(probs, k, n);
}

function drawBinom(probs, k, n) {
  const canvas = document.getElementById('binomCanvas');
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.clientWidth || 600;
  const H = 200;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  ctx.clearRect(0, 0, W, H);
  ctx.fillStyle = '#1a1d24';
  ctx.fillRect(0, 0, W, H);

  const pad = {l:36, r:12, t:16, b:32};
  const gW = W - pad.l - pad.r;
  const gH = H - pad.t - pad.b;
  const maxP = Math.max(...probs) * 1.1 || 0.01;
  const barW = Math.max(2, gW / probs.length - 2);

  // Y axis
  ctx.strokeStyle = '#363b47'; ctx.lineWidth = 1;
  ctx.beginPath(); ctx.moveTo(pad.l, pad.t); ctx.lineTo(pad.l, pad.t + gH); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(pad.l, pad.t + gH); ctx.lineTo(pad.l + gW, pad.t + gH); ctx.stroke();

  // Y ticks
  ctx.fillStyle = '#9ca3af'; ctx.font = '9px JetBrains Mono, monospace'; ctx.textAlign = 'right';
  for (let i = 0; i <= 4; i++) {
    const v = maxP * i / 4;
    const y = pad.t + gH - (v / maxP) * gH;
    ctx.fillText(v.toFixed(2), pad.l - 4, y + 3);
    ctx.strokeStyle = '#2c313c'; ctx.lineWidth = 0.5;
    ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(pad.l + gW, y); ctx.stroke();
  }

  // Bars
  probs.forEach((p, i) => {
    const x = pad.l + (i / probs.length) * gW + (gW / probs.length - barW) / 2;
    const bH = (p / maxP) * gH;
    const y = pad.t + gH - bH;
    ctx.fillStyle = i === k ? '#ec4899' : 'rgba(99,102,241,0.6)';
    ctx.fillRect(x, y, barW, bH);
    if (i === k) {
      ctx.strokeStyle = '#ec4899'; ctx.lineWidth = 1.5;
      ctx.strokeRect(x, y, barW, bH);
    }
  });

  // X labels
  ctx.fillStyle = '#9ca3af'; ctx.font = '9px JetBrains Mono, monospace'; ctx.textAlign = 'center';
  const step = Math.ceil(probs.length / 12);
  probs.forEach((_, i) => {
    if (i % step === 0 || i === k) {
      const x = pad.l + (i / probs.length) * gW + gW / probs.length / 2;
      ctx.fillStyle = i === k ? '#ec4899' : '#9ca3af';
      ctx.fillText(i, x, pad.t + gH + 14);
    }
  });
}

// ============================================================
// NORMAL DISTRIBUTION
// ============================================================
function phi(z) {
  // Abramowitz & Stegun approximation
  const t = 1 / (1 + 0.2316419 * Math.abs(z));
  const d = 0.3989422820 * Math.exp(-z * z / 2);
  const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.7814779 + t * (-1.8212560 + t * 1.3302744))));
  return z >= 0 ? 1 - p : p;
}

function normalPDF(x, mu, sigma) {
  return (1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - mu) / sigma, 2));
}

function updateNorm() {
  const mu = parseFloat(document.getElementById('norm_mu').value);
  const sigma = parseFloat(document.getElementById('norm_sigma').value);
  const z1 = parseFloat(document.getElementById('norm_z1').value);
  const z2 = parseFloat(document.getElementById('norm_z2').value);

  document.getElementById('norm_mu_val').textContent = mu.toFixed(1);
  document.getElementById('norm_sigma_val').textContent = sigma.toFixed(1);
  document.getElementById('norm_z1_val').textContent = z1.toFixed(2);
  document.getElementById('norm_z2_val').textContent = z2.toFixed(2);

  const x1 = mu + z1 * sigma;
  const x2 = mu + z2 * sigma;
  document.getElementById('norm_x1_val').textContent = x1.toFixed(2);
  document.getElementById('norm_x2_val').textContent = x2.toFixed(2);

  const zLow = Math.min(z1, z2);
  const zHigh = Math.max(z1, z2);
  const probMid = phi(zHigh) - phi(zLow);
  const probLeft = phi(zLow);
  const probRight = 1 - phi(zHigh);

  document.getElementById('norm_prob').textContent = probMid.toFixed(4);
  document.getElementById('norm_left').textContent = probLeft.toFixed(4);
  document.getElementById('norm_right').textContent = probRight.toFixed(4);

  drawNorm(mu, sigma, z1, z2);
}

function drawNorm(mu, sigma, z1, z2) {
  const canvas = document.getElementById('normCanvas');
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.clientWidth || 600;
  const H = 200;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  ctx.clearRect(0, 0, W, H);
  ctx.fillStyle = '#1a1d24';
  ctx.fillRect(0, 0, W, H);

  const pad = {l:36, r:16, t:20, b:32};
  const gW = W - pad.l - pad.r;
  const gH = H - pad.t - pad.b;

  const xMin = mu - 4 * sigma;
  const xMax = mu + 4 * sigma;
  const xRange = xMax - xMin;
  const maxY = normalPDF(mu, mu, sigma);

  function xToCanvas(x) { return pad.l + ((x - xMin) / xRange) * gW; }
  function yToCanvas(y) { return pad.t + gH - (y / (maxY * 1.1)) * gH; }

  // Grid lines
  ctx.strokeStyle = '#363b47'; ctx.lineWidth = 0.5;
  for (let z = -4; z <= 4; z++) {
    const x = mu + z * sigma;
    const cx = xToCanvas(x);
    ctx.beginPath(); ctx.moveTo(cx, pad.t); ctx.lineTo(cx, pad.t + gH); ctx.stroke();
  }

  // Shade left tail
  ctx.beginPath();
  const zLow = Math.min(z1, z2);
  const xShadeLow = mu + zLow * sigma;
  ctx.moveTo(xToCanvas(xMin), yToCanvas(0));
  for (let i = 0; i <= 200; i++) {
    const xv = xMin + (i / 200) * (xShadeLow - xMin);
    ctx.lineTo(xToCanvas(xv), yToCanvas(normalPDF(xv, mu, sigma)));
  }
  ctx.lineTo(xToCanvas(xShadeLow), yToCanvas(0));
  ctx.closePath();
  ctx.fillStyle = 'rgba(236,72,153,0.25)'; ctx.fill();

  // Shade middle
  const zHigh = Math.max(z1, z2);
  const xShadeHigh = mu + zHigh * sigma;
  ctx.beginPath();
  ctx.moveTo(xToCanvas(xShadeLow), yToCanvas(0));
  for (let i = 0; i <= 300; i++) {
    const xv = xShadeLow + (i / 300) * (xShadeHigh - xShadeLow);
    ctx.lineTo(xToCanvas(xv), yToCanvas(normalPDF(xv, mu, sigma)));
  }
  ctx.lineTo(xToCanvas(xShadeHigh), yToCanvas(0));
  ctx.closePath();
  ctx.fillStyle = 'rgba(99,102,241,0.30)'; ctx.fill();

  // Shade right tail
  ctx.beginPath();
  ctx.moveTo(xToCanvas(xShadeHigh), yToCanvas(0));
  for (let i = 0; i <= 200; i++) {
    const xv = xShadeHigh + (i / 200) * (xMax - xShadeHigh);
    ctx.lineTo(xToCanvas(xv), yToCanvas(normalPDF(xv, mu, sigma)));
  }
  ctx.lineTo(xToCanvas(xMax), yToCanvas(0));
  ctx.closePath();
  ctx.fillStyle = 'rgba(245,158,11,0.20)'; ctx.fill();

  // Bell curve
  ctx.beginPath();
  for (let i = 0; i <= 400; i++) {
    const xv = xMin + (i / 400) * xRange;
    const yv = normalPDF(xv, mu, sigma);
    i === 0 ? ctx.moveTo(xToCanvas(xv), yToCanvas(yv)) : ctx.lineTo(xToCanvas(xv), yToCanvas(yv));
  }
  ctx.strokeStyle = '#e2e4e9'; ctx.lineWidth = 2; ctx.stroke();

  // Baseline
  ctx.beginPath();
  ctx.moveTo(pad.l, pad.t + gH); ctx.lineTo(pad.l + gW, pad.t + gH);
  ctx.strokeStyle = '#363b47'; ctx.lineWidth = 1; ctx.stroke();

  // X axis labels (z scores)
  ctx.fillStyle = '#9ca3af'; ctx.font = '9px JetBrains Mono, monospace'; ctx.textAlign = 'center';
  for (let z = -3; z <= 3; z++) {
    const xv = mu + z * sigma;
    ctx.fillText('z=' + z, xToCanvas(xv), pad.t + gH + 14);
  }

  // Vertical lines at z1, z2
  [xShadeLow, xShadeHigh].forEach((xv, idx) => {
    const col = idx === 0 ? '#ec4899' : '#f59e0b';
    ctx.beginPath();
    ctx.moveTo(xToCanvas(xv), pad.t);
    ctx.lineTo(xToCanvas(xv), pad.t + gH);
    ctx.strokeStyle = col; ctx.lineWidth = 1.5;
    ctx.setLineDash([4, 3]); ctx.stroke(); ctx.setLineDash([]);
  });
}

// ============================================================
// CENTRAL LIMIT THEOREM DEMO
// ============================================================
function expoPDF(x, lambda) {
  return x >= 0 ? lambda * Math.exp(-lambda * x) : 0;
}

function updateCLT() {
  const n = parseInt(document.getElementById('clt_n').value);
  document.getElementById('clt_n_val').textContent = n;
  document.getElementById('clt_sampling_label').textContent = 'Sampling dist. of x\u0305 (n=' + n + ')';

  const se = (1 / Math.sqrt(n)).toFixed(3);
  document.getElementById('clt_se').textContent = se;

  let note;
  if (n >= 30) note = 'Approx. normal';
  else if (n >= 10) note = 'Somewhat normal';
  else note = 'Still skewed';
  document.getElementById('clt_norm_note').textContent = note;

  drawCLTPop();
  drawCLTSamp(n);
}

function drawCLTPop() {
  const canvas = document.getElementById('cltPopCanvas');
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.clientWidth || 280;
  const H = 160;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  ctx.clearRect(0, 0, W, H);
  ctx.fillStyle = '#1a1d24';
  ctx.fillRect(0, 0, W, H);

  const pad = {l:20, r:10, t:14, b:24};
  const gW = W - pad.l - pad.r;
  const gH = H - pad.t - pad.b;
  const lambda = 1;
  const xMax = 5;
  const maxPDF = lambda;

  function xToC(x) { return pad.l + (x / xMax) * gW; }
  function yToC(y) { return pad.t + gH - (y / (maxPDF * 1.1)) * gH; }

  // Fill
  ctx.beginPath();
  ctx.moveTo(xToC(0), yToC(0));
  for (let i = 0; i <= 300; i++) {
    const xv = (i / 300) * xMax;
    ctx.lineTo(xToC(xv), yToC(expoPDF(xv, lambda)));
  }
  ctx.lineTo(xToC(xMax), yToC(0));
  ctx.closePath();
  ctx.fillStyle = 'rgba(245,158,11,0.2)'; ctx.fill();

  ctx.beginPath();
  ctx.moveTo(xToC(0), yToC(expoPDF(0, lambda)));
  for (let i = 1; i <= 300; i++) {
    const xv = (i / 300) * xMax;
    ctx.lineTo(xToC(xv), yToC(expoPDF(xv, lambda)));
  }
  ctx.strokeStyle = '#f59e0b'; ctx.lineWidth = 2; ctx.stroke();

  // Baseline
  ctx.beginPath();
  ctx.moveTo(pad.l, pad.t + gH); ctx.lineTo(pad.l + gW, pad.t + gH);
  ctx.strokeStyle = '#363b47'; ctx.lineWidth = 1; ctx.stroke();

  // Mean line
  const muX = 1 / lambda;
  ctx.beginPath();
  ctx.moveTo(xToC(muX), pad.t);
  ctx.lineTo(xToC(muX), pad.t + gH);
  ctx.strokeStyle = '#22c55e'; ctx.lineWidth = 1.5; ctx.setLineDash([3,3]); ctx.stroke(); ctx.setLineDash([]);

  ctx.fillStyle = '#9ca3af'; ctx.font = '9px JetBrains Mono, monospace'; ctx.textAlign = 'center';
  ctx.fillText('Exp(1) skewed', W / 2, pad.t - 2);
  ctx.fillStyle = '#22c55e';
  ctx.fillText('\u03bc=1', xToC(muX) + 16, pad.t + 12);
}

function drawCLTSamp(n) {
  const canvas = document.getElementById('cltSampCanvas');
  const dpr = window.devicePixelRatio || 1;
  const W = canvas.clientWidth || 280;
  const H = 160;
  canvas.width = W * dpr;
  canvas.height = H * dpr;
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  ctx.clearRect(0, 0, W, H);
  ctx.fillStyle = '#1a1d24';
  ctx.fillRect(0, 0, W, H);

  const pad = {l:20, r:10, t:14, b:24};
  const gW = W - pad.l - pad.r;
  const gH = H - pad.t - pad.b;

  // The sampling distribution of mean of Exp(1) with sample size n:
  // N(mu=1, sigma^2=1/n)
  const mu = 1;
  const sigma = 1 / Math.sqrt(n);
  const xMin = Math.max(0, mu - 4 * sigma);
  const xMax = mu + 4 * sigma;
  const xRange = xMax - xMin;
  const maxPDF = normalPDF(mu, mu, sigma);

  function xToC(x) { return pad.l + ((x - xMin) / xRange) * gW; }
  function yToC(y) { return pad.t + gH - (y / (maxPDF * 1.1)) * gH; }

  // Fill
  ctx.beginPath();
  ctx.moveTo(xToC(xMin), yToC(0));
  for (let i = 0; i <= 300; i++) {
    const xv = xMin + (i / 300) * xRange;
    ctx.lineTo(xToC(xv), yToC(normalPDF(xv, mu, sigma)));
  }
  ctx.lineTo(xToC(xMax), yToC(0));
  ctx.closePath();
  ctx.fillStyle = 'rgba(99,102,241,0.2)'; ctx.fill();

  ctx.beginPath();
  for (let i = 0; i <= 300; i++) {
    const xv = xMin + (i / 300) * xRange;
    i === 0 ? ctx.moveTo(xToC(xv), yToC(normalPDF(xv, mu, sigma))) : ctx.lineTo(xToC(xv), yToC(normalPDF(xv, mu, sigma)));
  }
  ctx.strokeStyle = '#6366f1'; ctx.lineWidth = 2; ctx.stroke();

  // Baseline
  ctx.beginPath();
  ctx.moveTo(pad.l, pad.t + gH); ctx.lineTo(pad.l + gW, pad.t + gH);
  ctx.strokeStyle = '#363b47'; ctx.lineWidth = 1; ctx.stroke();

  // Mean line
  ctx.beginPath();
  ctx.moveTo(xToC(mu), pad.t); ctx.lineTo(xToC(mu), pad.t + gH);
  ctx.strokeStyle = '#22c55e'; ctx.lineWidth = 1.5; ctx.setLineDash([3,3]); ctx.stroke(); ctx.setLineDash([]);

  ctx.fillStyle = '#9ca3af'; ctx.font = '9px JetBrains Mono, monospace'; ctx.textAlign = 'center';
  ctx.fillText('x\u0305 ~ N(1, 1/n)', W / 2, pad.t - 2);

  // SE annotation
  ctx.fillStyle = '#6366f1'; ctx.font = '9px JetBrains Mono, monospace'; ctx.textAlign = 'left';
  ctx.fillText('SE=' + sigma.toFixed(3), pad.l + 2, pad.t + 14);
}

// ============================================================
// INIT
// ============================================================
function initAll() {
  updateVenn();
  updateTree();
  updateBinom();
  updateNorm();
  updateCLT();
}

// Redraw canvases on resize
let resizeTimer;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimer);
  resizeTimer = setTimeout(initAll, 150);
});

window.addEventListener('load', initAll);
</script>
</body>
</html>
